# MLæœåŠ¡å®å¡”éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨å®å¡”é¢æ¿ä¸Šéƒ¨ç½² ML æ—¶åºé¢„æµ‹æœåŠ¡ã€‚

## ğŸ“‹ ç›®å½•

1. [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
2. [ä¼ è¾“æ–‡ä»¶åˆ°æœåŠ¡å™¨](#ä¼ è¾“æ–‡ä»¶åˆ°æœåŠ¡å™¨)
3. [å®‰è£…Pythonç¯å¢ƒ](#å®‰è£…pythonç¯å¢ƒ)
4. [éƒ¨ç½²MLæœåŠ¡](#éƒ¨ç½²mlæœåŠ¡)
5. [ä½¿ç”¨å®å¡”Pythoné¡¹ç›®ç®¡ç†å™¨ï¼ˆæ¨èï¼‰](#ä½¿ç”¨å®å¡”pythoné¡¹ç›®ç®¡ç†å™¨æ¨è)
6. [ä½¿ç”¨PM2éƒ¨ç½²ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰](#ä½¿ç”¨pm2éƒ¨ç½²å¤‡é€‰æ–¹æ¡ˆ)
7. [é…ç½®ç¯å¢ƒå˜é‡](#é…ç½®ç¯å¢ƒå˜é‡)
8. [é…ç½®åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰](#é…ç½®åå‘ä»£ç†å¯é€‰)
9. [éªŒè¯éƒ¨ç½²](#éªŒè¯éƒ¨ç½²)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å‰ç½®å‡†å¤‡

### 1. æœåŠ¡å™¨è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šCentOS 7+ / Ubuntu 18.04+ / Debian 9+
- **å®å¡”é¢æ¿**ï¼šå·²å®‰è£…å®å¡”é¢æ¿ï¼ˆLinuxç‰ˆï¼‰
- **Pythonç‰ˆæœ¬**ï¼šPython 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ¨è Python 3.9+ï¼Œå› ä¸º Flask 3.0.0 éœ€è¦ Python 3.9+ï¼‰
- **å†…å­˜**ï¼šå»ºè®®è‡³å°‘ 2GBï¼ˆTensorFlow éœ€è¦è¾ƒå¤šå†…å­˜ï¼‰
- **ç£ç›˜ç©ºé—´**ï¼šå»ºè®®è‡³å°‘ 5GB å¯ç”¨ç©ºé—´ï¼ˆç”¨äºå®‰è£…ä¾èµ–åŒ…ï¼‰

### 2. å®å¡”é¢æ¿å‡†å¤‡

ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼ˆå¯åœ¨å®å¡”é¢æ¿"è½¯ä»¶å•†åº—"ä¸­å®‰è£…ï¼‰ï¼š
- **Pythoné¡¹ç›®ç®¡ç†å™¨**ï¼ˆæ¨èä½¿ç”¨ï¼‰
- **PM2ç®¡ç†å™¨**ï¼ˆå¦‚æœä½¿ç”¨PM2éƒ¨ç½²ï¼‰
- **Nginx**ï¼ˆå¦‚æœéœ€è¦åå‘ä»£ç†ï¼‰

---

## ä¼ è¾“æ–‡ä»¶åˆ°æœåŠ¡å™¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥"æ–‡ä»¶"ç®¡ç†
3. æ‰¾åˆ°æ‚¨çš„ç½‘ç«™ç›®å½•ï¼ˆå¦‚ `/www/wwwroot/your-domain.com`ï¼‰
4. åˆ›å»ºé¡¹ç›®ç›®å½•ï¼ˆå¦‚ `sdk-platform`ï¼‰
5. ä¸Šä¼  `ml-service` æ–‡ä»¶å¤¹åˆ°æœåŠ¡å™¨

### æ–¹å¼äºŒï¼šä½¿ç”¨FTP/SFTP

1. ä½¿ç”¨ FileZillaã€WinSCP ç­‰FTPå·¥å…·
2. è¿æ¥åˆ°æœåŠ¡å™¨
3. å°†æœ¬åœ° `ml-service` æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰

å¦‚æœæœåŠ¡å™¨å·²å®‰è£…Gitï¼š

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh root@your-server-ip

# è¿›å…¥ç½‘ç«™ç›®å½•
cd /www/wwwroot/your-domain.com

# å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœæœ‰Gitä»“åº“ï¼‰
git clone https://your-repo-url.git

# æˆ–æ‹‰å–æœ€æ–°ä»£ç 
git pull
```

### æ–¹å¼å››ï¼šä½¿ç”¨å®å¡”ç»ˆç«¯

```bash
# åœ¨å®å¡”é¢æ¿ä¸­æ‰“å¼€"ç»ˆç«¯"

# è¿›å…¥ç½‘ç«™ç›®å½•
cd /www/wwwroot/your-domain.com

# ä½¿ç”¨wgetä¸‹è½½ï¼ˆå¦‚æœæœ‰ä¸‹è½½é“¾æ¥ï¼‰
# æˆ–ä½¿ç”¨scpä»æœ¬åœ°ä¼ è¾“
```

---

## å®‰è£…Pythonç¯å¢ƒ

### 1. æ£€æŸ¥Pythonç‰ˆæœ¬

åœ¨å®å¡”ç»ˆç«¯ä¸­æ‰§è¡Œï¼š

```bash
python3 --version
```

å¦‚æœæ˜¾ç¤º Python 3.8+ï¼Œå¯ä»¥è·³è¿‡å®‰è£…æ­¥éª¤ã€‚

**æ³¨æ„**ï¼šè™½ç„¶ Python 3.8 ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ¨èä½¿ç”¨ Python 3.9+ï¼Œå› ä¸º Flask 3.0.0 éœ€è¦ Python 3.9+ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨ Python 3.8ï¼Œè¯·ä½¿ç”¨ `requirements-py38.txt` ä½œä¸ºä¾èµ–æ–‡ä»¶ã€‚

### 2. å®‰è£…Python 3.8+ï¼ˆå¦‚æœéœ€è¦ï¼‰

#### CentOSç³»ç»Ÿï¼š

**æ³¨æ„**ï¼šCentOS 7 é»˜è®¤åªæ”¯æŒåˆ° Python 3.6ï¼Œå®‰è£… Python 3.8 éœ€è¦ä½¿ç”¨é¢å¤–çš„è½¯ä»¶æºã€‚

##### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ IUS ä»“åº“ï¼ˆæ¨èï¼‰

IUS ä»“åº“æä¾›äº†æœ€æ–°çš„ Python ç‰ˆæœ¬ï¼š

```bash
# å®‰è£…EPELæºï¼ˆå¿…é¡»å…ˆå®‰è£…ï¼‰
yum install -y epel-release

# å®‰è£…IUSä»“åº“
yum install -y https://repo.ius.io/ius-release-el7.rpm

# å®‰è£…Python 3.8åŠç›¸å…³å·¥å…·
yum install -y python38u python38u-pip python38u-devel

# åˆ›å»ºè½¯é“¾æ¥ï¼ˆå¦‚æœç³»ç»Ÿé»˜è®¤Python3ç‰ˆæœ¬è¾ƒä½ï¼‰
ln -sf /usr/bin/python3.8 /usr/bin/python3
ln -sf /usr/bin/pip3.8 /usr/bin/pip3

# éªŒè¯å®‰è£…
python3.8 --version
pip3.8 --version
```

##### æ–¹æ³•äºŒï¼šä½¿ç”¨ Software Collections (SCL)

SCL æä¾›äº†è¾ƒæ–°çš„è½¯ä»¶åŒ…ç‰ˆæœ¬ï¼š

```bash
# å®‰è£…EPELæº
yum install -y epel-release

# å®‰è£…SCLä»“åº“
yum install -y centos-release-scl

# å®‰è£…Python 3.8ï¼ˆåœ¨SCLä¸­å¯èƒ½æ˜¯python38æˆ–python36ï¼‰
yum install -y rh-python38 rh-python38-python-pip rh-python38-python-devel

# å¯ç”¨Python 3.8ç¯å¢ƒ
scl enable rh-python38 bash

# éªŒè¯å®‰è£…
python3.8 --version
```

**ä½¿ç”¨SCLæ—¶çš„æ³¨æ„äº‹é¡¹**ï¼š
- SCLä¸­çš„Pythonéœ€è¦ä½¿ç”¨ `scl enable` å‘½ä»¤æ¿€æ´»ï¼Œæˆ–åœ¨å¯åŠ¨è„šæœ¬ä¸­æ¿€æ´»
- è·¯å¾„é€šå¸¸åœ¨ `/opt/rh/rh-python38/root/usr/bin/`
- åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶éœ€è¦ä½¿ç”¨å®Œæ•´è·¯å¾„

##### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ pyenvï¼ˆé€‚åˆå¤šç‰ˆæœ¬ç®¡ç†ï¼‰

å¦‚æœéœ€è¦åœ¨åŒä¸€æœåŠ¡å™¨ä¸Šç®¡ç†å¤šä¸ªPythonç‰ˆæœ¬ï¼š

```bash
# å®‰è£…ç¼–è¯‘ä¾èµ–
yum install -y gcc openssl-devel bzip2-devel libffi-devel zlib-devel readline-devel sqlite-devel

# å®‰è£…pyenv
curl https://pyenv.run | bash

# é…ç½®ç¯å¢ƒå˜é‡ï¼ˆæ·»åŠ åˆ° ~/.bashrc æˆ– ~/.bash_profileï¼‰
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
echo 'command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc

# é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc

# å®‰è£…Python 3.8
pyenv install 3.8.18

# è®¾ç½®ä¸ºå…¨å±€é»˜è®¤ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰
pyenv global 3.8.18

# éªŒè¯å®‰è£…
python3.8 --version
```

##### æ–¹æ³•å››ï¼šä»æºä»£ç ç¼–è¯‘å®‰è£…ï¼ˆæœ€åå¤‡é€‰ï¼‰

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½ä¸è¡Œï¼Œå¯ä»¥ä»æºä»£ç ç¼–è¯‘ï¼š

```bash
# å®‰è£…ç¼–è¯‘ä¾èµ–
yum groupinstall -y "Development Tools"
yum install -y openssl-devel bzip2-devel libffi-devel zlib-devel readline-devel sqlite-devel

# ä¸‹è½½Python 3.8æºç 
cd /usr/src
wget https://www.python.org/ftp/python/3.8.18/Python-3.8.18.tgz
tar xzf Python-3.8.18.tgz
cd Python-3.8.18

# é…ç½®ã€ç¼–è¯‘å’Œå®‰è£…
./configure --enable-optimizations --prefix=/usr/local
make altinstall  # ä½¿ç”¨altinstallé¿å…è¦†ç›–ç³»ç»ŸPython

# åˆ›å»ºè½¯é“¾æ¥
ln -sf /usr/local/bin/python3.8 /usr/bin/python3.8
ln -sf /usr/local/bin/pip3.8 /usr/bin/pip3.8

# éªŒè¯å®‰è£…
python3.8 --version
```

**ç¼–è¯‘å®‰è£…æ³¨æ„äº‹é¡¹**ï¼š
- ç¼–è¯‘è¿‡ç¨‹å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆ10-30åˆ†é’Ÿï¼‰
- éœ€è¦è‡³å°‘2GBå¯ç”¨å†…å­˜
- å¦‚æœå†…å­˜ä¸è¶³ï¼Œç¼–è¯‘å¯èƒ½ä¼šå¤±è´¥

#### Ubuntu/Debianç³»ç»Ÿï¼š

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update

# å®‰è£…Python 3.8
apt install -y python3.8 python3.8-venv python3.8-dev python3-pip

# éªŒè¯å®‰è£…
python3.8 --version
```

### 3. å®‰è£…pipå’Œä¾èµ–ç®¡ç†å·¥å…·

```bash
# ç¡®ä¿pipæ˜¯æœ€æ–°ç‰ˆæœ¬
python3 -m pip install --upgrade pip

# å®‰è£…è™šæ‹Ÿç¯å¢ƒå·¥å…·ï¼ˆé€šå¸¸å·²åŒ…å«ï¼‰
python3 -m pip install virtualenv
```

---

## éƒ¨ç½²MLæœåŠ¡

### 1. è¿›å…¥é¡¹ç›®ç›®å½•

```bash
# å‡è®¾é¡¹ç›®åœ¨ /www/wwwroot/your-domain.com/sdk-platform/ml-service
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service

# æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦å®Œæ•´
ls -la
```

åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š
- `app.py`
- `requirements.txt`
- `README.md`
- `doc/` ç›®å½•

### 2. åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ

**é‡è¦**ï¼šè¯·ç¡®ä¿ä½¿ç”¨ Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬æ¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚

**âš ï¸ å¸¸è§é”™è¯¯**ï¼šä¸è¦ä½¿ç”¨ `python` å‘½ä»¤ï¼ˆå¯èƒ½æ˜¯ Python 2.7ï¼‰ï¼Œè¦ä½¿ç”¨ `python3` æˆ– `python3.8`ã€‚

```bash
# é¦–å…ˆæ£€æŸ¥ç³»ç»Ÿä¸­å¯ç”¨çš„ Python ç‰ˆæœ¬
python --version    # å¯èƒ½æ˜¯ Python 2.7ï¼ˆä¸è¦ç”¨è¿™ä¸ªï¼‰
python3 --version   # æ£€æŸ¥ Python 3 ç‰ˆæœ¬
python3.8 --version # æ£€æŸ¥ Python 3.8ï¼ˆå¦‚æœå®‰è£…äº†ï¼‰
python3.9 --version # æ£€æŸ¥ Python 3.9ï¼ˆå¦‚æœå®‰è£…äº†ï¼‰

# å¦‚æœå‘ç°è™šæ‹Ÿç¯å¢ƒä½¿ç”¨äº†é”™è¯¯çš„ Python ç‰ˆæœ¬ï¼Œå…ˆåˆ é™¤æ—§ç¯å¢ƒ
# å¦‚æœå·²ç»æ¿€æ´»äº†è™šæ‹Ÿç¯å¢ƒï¼Œå…ˆé€€å‡º
deactivate 2>/dev/null || true

# åˆ é™¤æ—§çš„è™šæ‹Ÿç¯å¢ƒ
rm -rf venv

# ä½¿ç”¨æ­£ç¡®çš„ Python 3 ç‰ˆæœ¬åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
# æ–¹æ³•1ï¼šå¦‚æœç³»ç»Ÿå·²å®‰è£… Python 3.8
python3.8 -m venv venv

# æ–¹æ³•2ï¼šå¦‚æœç³»ç»Ÿå·²å®‰è£… Python 3.9ï¼ˆæ¨èï¼Œæ”¯æŒ Flask 3.0.0ï¼‰
python3.9 -m venv venv

# æ–¹æ³•3ï¼šå¦‚æœ python3 æŒ‡å‘ 3.8+ ç‰ˆæœ¬
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# âš ï¸ éªŒè¯è™šæ‹Ÿç¯å¢ƒçš„Pythonç‰ˆæœ¬ï¼ˆéå¸¸é‡è¦ï¼ï¼‰
python --version  # åº”è¯¥æ˜¾ç¤º Python 3.8.x æˆ–æ›´é«˜ï¼Œç»å¯¹ä¸èƒ½æ˜¯ 2.7.x
which python      # åº”è¯¥æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒä¸­çš„pythonè·¯å¾„

# å¦‚æœä»ç„¶æ˜¾ç¤º Python 2.7ï¼Œè¯´æ˜è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå¤±è´¥ï¼Œéœ€è¦é‡æ–°åˆ›å»º
```

**æ³¨æ„ç‰ˆæœ¬è¦æ±‚**ï¼š
- **Flask 3.0.0** éœ€è¦ Python 3.9+
- **Flask 2.3.x** æ”¯æŒ Python 3.8+
- å¦‚æœä½¿ç”¨ Python 3.8ï¼Œè¯·ä½¿ç”¨ `requirements-py38.txt`ï¼ˆè§ä¸‹æ–¹ï¼‰

### 3. å‡çº§pip

```bash
pip install --upgrade pip
```

### 4. å®‰è£…ä¾èµ–åŒ…

**æ³¨æ„**ï¼š
1. TensorFlow ä½“ç§¯è¾ƒå¤§ï¼ˆçº¦500MBï¼‰ï¼Œå®‰è£…å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
2. **ç‰ˆæœ¬å…¼å®¹æ€§**ï¼šFlask 3.0.0 éœ€è¦ Python 3.9+ï¼Œå¦‚æœä½¿ç”¨ Python 3.8ï¼Œè¯·ä½¿ç”¨ `requirements-py38.txt`

**æ£€æŸ¥Pythonç‰ˆæœ¬å¹¶é€‰æ‹©å¯¹åº”çš„ä¾èµ–æ–‡ä»¶**ï¼š

```bash
# é¦–å…ˆæ£€æŸ¥è™šæ‹Ÿç¯å¢ƒçš„Pythonç‰ˆæœ¬
python --version

# å¦‚æœç‰ˆæœ¬æ˜¯ 3.9 æˆ–æ›´é«˜ï¼Œä½¿ç”¨æ ‡å‡†requirements.txt
pip install -r requirements.txt

# å¦‚æœç‰ˆæœ¬æ˜¯ 3.8ï¼Œä½¿ç”¨å…¼å®¹ç‰ˆæœ¬çš„ä¾èµ–æ–‡ä»¶
pip install -r requirements-py38.txt
```

**æˆ–è€…æ‰‹åŠ¨æŒ‡å®šä¾èµ–æ–‡ä»¶**ï¼š

```bash
# Python 3.9+ ä½¿ç”¨æ ‡å‡†ç‰ˆæœ¬
pip install -r requirements.txt

# Python 3.8 ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬
pip install -r requirements-py38.txt
```

**å¦‚æœé‡åˆ°TensorFlowå®‰è£…é—®é¢˜**ï¼Œå¯ä»¥ä½¿ç”¨CPUç‰ˆæœ¬ï¼š

```bash
# å…ˆå®‰è£…CPUç‰ˆæœ¬çš„TensorFlowï¼ˆæ›´è½»é‡ï¼Œé€‚åˆæœåŠ¡å™¨ï¼‰
pip install tensorflow-cpu==2.13.0

# ç„¶åå®‰è£…å…¶ä»–ä¾èµ–ï¼ˆæ’é™¤tensorflowï¼‰
pip install flask==3.0.0 flask-cors==4.0.0 numpy==1.24.3 pandas==2.0.3 scikit-learn==1.3.0 python-dotenv==1.0.0 requests==2.31.0
```

**å¦‚æœå†…å­˜ä¸è¶³**ï¼Œå¯ä»¥åˆ†æ­¥å®‰è£…ï¼š

```bash
# å…ˆå®‰è£…åŸºç¡€ä¾èµ–
pip install flask==3.0.0 flask-cors==4.0.0 python-dotenv==1.0.0 requests==2.31.0

# å†å®‰è£…ç§‘å­¦è®¡ç®—åº“
pip install numpy==1.24.3 pandas==2.0.3 scikit-learn==1.3.0

# æœ€åå®‰è£…TensorFlowï¼ˆå¯é€‰ï¼Œå¦‚æœä¸éœ€è¦æ·±åº¦å­¦ä¹ åŠŸèƒ½ï¼‰
pip install tensorflow-cpu==2.13.0
```

### 5. éªŒè¯å®‰è£…

```bash
# æµ‹è¯•å¯¼å…¥å…³é”®æ¨¡å—
python -c "import flask; import numpy; import pandas; print('ä¾èµ–å®‰è£…æˆåŠŸ')"

# å¦‚æœæœ‰TensorFlow
python -c "import tensorflow; print(f'TensorFlowç‰ˆæœ¬: {tensorflow.__version__}')"
```

---

## ä½¿ç”¨å®å¡”Pythoné¡¹ç›®ç®¡ç†å™¨ï¼ˆæ¨èï¼‰

å®å¡”çš„Pythoné¡¹ç›®ç®¡ç†å™¨æ˜¯æœ€ç®€å•çš„éƒ¨ç½²æ–¹å¼ï¼Œæ”¯æŒè‡ªåŠ¨ç®¡ç†è¿›ç¨‹å’Œæ—¥å¿—ã€‚

### 1. å®‰è£…Pythoné¡¹ç›®ç®¡ç†å™¨

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥"è½¯ä»¶å•†åº—"
3. æœç´¢"Pythoné¡¹ç›®ç®¡ç†å™¨"
4. ç‚¹å‡»"å®‰è£…"

### 2. åˆ›å»ºPythoné¡¹ç›®

1. åœ¨å®å¡”é¢æ¿ä¸­æ‰“å¼€"Pythoné¡¹ç›®ç®¡ç†å™¨"
2. ç‚¹å‡»"æ·»åŠ Pythoné¡¹ç›®"
3. å¡«å†™é…ç½®ä¿¡æ¯ï¼š

   - **é¡¹ç›®åç§°**ï¼š`ml-service`ï¼ˆè‡ªå®šä¹‰ï¼‰
   - **é¡¹ç›®è·¯å¾„**ï¼š`/www/wwwroot/your-domain.com/sdk-platform/ml-service`
   - **Pythonç‰ˆæœ¬**ï¼šé€‰æ‹© Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
   - **å¯åŠ¨æ–‡ä»¶**ï¼š`app.py`
   - **ç«¯å£**ï¼š`5000`ï¼ˆæˆ–è‡ªå®šä¹‰ç«¯å£ï¼‰
   - **å¯åŠ¨æ–¹å¼**ï¼šé€‰æ‹© `app:app`ï¼ˆå¦‚æœéœ€è¦ä½¿ç”¨Gunicornï¼‰
   - **æ¡†æ¶ç±»å‹**ï¼šé€‰æ‹© `Flask`

4. ç‚¹å‡»"æäº¤"

### 3. é…ç½®è™šæ‹Ÿç¯å¢ƒ

åœ¨é¡¹ç›®è®¾ç½®ä¸­ï¼š

1. ç‚¹å‡»é¡¹ç›®åç§°è¿›å…¥è¯¦æƒ…
2. åœ¨"è™šæ‹Ÿç¯å¢ƒ"ä¸­ï¼Œå¡«å†™è™šæ‹Ÿç¯å¢ƒè·¯å¾„ï¼š`/www/wwwroot/your-domain.com/sdk-platform/ml-service/venv`
3. ç‚¹å‡»"ä¿å­˜"

### 4. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

åœ¨é¡¹ç›®è®¾ç½®ä¸­ï¼š

1. æ‰¾åˆ°"ç¯å¢ƒå˜é‡"æˆ–"é…ç½®æ–‡ä»¶"é€‰é¡¹
2. æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```env
ML_SERVICE_PORT=5000
FLASK_DEBUG=False
```

æˆ–è€…åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service
nano .env
```

æ·»åŠ å†…å®¹ï¼š

```env
ML_SERVICE_PORT=5000
FLASK_DEBUG=False
```

ä¿å­˜åé€€å‡ºï¼ˆCtrl+Xï¼Œç„¶å Yï¼Œç„¶å Enterï¼‰ã€‚

### 5. å¯åŠ¨æœåŠ¡

1. åœ¨Pythoné¡¹ç›®ç®¡ç†å™¨ä¸­ï¼Œæ‰¾åˆ°åˆ›å»ºçš„é¡¹ç›®
2. ç‚¹å‡»"å¯åŠ¨"æŒ‰é’®
3. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨

---

## ä½¿ç”¨PM2éƒ¨ç½²ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰

å¦‚æœä¸æƒ³ä½¿ç”¨Pythoné¡¹ç›®ç®¡ç†å™¨ï¼Œå¯ä»¥ä½¿ç”¨PM2æ¥ç®¡ç†è¿›ç¨‹ã€‚

### 1. å®‰è£…PM2

åœ¨å®å¡”é¢æ¿ä¸­ï¼š

1. è¿›å…¥"è½¯ä»¶å•†åº—"
2. æœç´¢"PM2ç®¡ç†å™¨"
3. ç‚¹å‡»"å®‰è£…"

æˆ–è€…ä½¿ç”¨npmå®‰è£…ï¼š

```bash
npm install -g pm2
```

### 2. åˆ›å»ºå¯åŠ¨è„šæœ¬

åœ¨ `ml-service` ç›®å½•ä¸‹åˆ›å»º `start.sh`ï¼š

```bash
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service
nano start.sh
```

æ·»åŠ å†…å®¹ï¼š

```bash
#!/bin/bash
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service
source venv/bin/activate
python app.py
```

ä¿å­˜åèµ‹äºˆæ‰§è¡Œæƒé™ï¼š

```bash
chmod +x start.sh
```

### 3. ä½¿ç”¨PM2å¯åŠ¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶å¯åŠ¨ï¼ˆPM2ä¼šè‡ªåŠ¨ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒçš„Pythonï¼‰
pm2 start app.py --name ml-service --interpreter /www/wwwroot/your-domain.com/sdk-platform/ml-service/venv/bin/python

# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
pm2 start start.sh --name ml-service
```

### 4. ä½¿ç”¨Gunicornï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

Gunicorn æ˜¯æ›´é€‚åˆç”Ÿäº§ç¯å¢ƒçš„WSGIæœåŠ¡å™¨ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£…Gunicorn
pip install gunicorn

# ä½¿ç”¨PM2å¯åŠ¨Gunicorn
pm2 start "gunicorn -w 4 -b 0.0.0.0:5000 app:app" --name ml-service --interpreter /www/wwwroot/your-domain.com/sdk-platform/ml-service/venv/bin/python
```

### 5. é…ç½®PM2å¼€æœºè‡ªå¯

```bash
# ä¿å­˜PM2è¿›ç¨‹åˆ—è¡¨
pm2 save

# è®¾ç½®PM2å¼€æœºè‡ªå¯
pm2 startup
# æ‰§è¡Œä¸Šé¢å‘½ä»¤åï¼Œä¼šæ˜¾ç¤ºä¸€æ¡å‘½ä»¤ï¼Œå¤åˆ¶å¹¶æ‰§è¡Œå®ƒ
```

### 6. PM2å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs ml-service

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 info ml-service

# é‡å¯æœåŠ¡
pm2 restart ml-service

# åœæ­¢æœåŠ¡
pm2 stop ml-service

# åˆ é™¤æœåŠ¡
pm2 delete ml-service
```

---

## é…ç½®ç¯å¢ƒå˜é‡

### æ–¹å¼ä¸€ï¼šä½¿ç”¨.envæ–‡ä»¶ï¼ˆæ¨èï¼‰

åœ¨ `ml-service` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service
nano .env
```

æ·»åŠ å†…å®¹ï¼š

```env
ML_SERVICE_PORT=5000
FLASK_DEBUG=False
```

### æ–¹å¼äºŒï¼šåœ¨å¯åŠ¨å‘½ä»¤ä¸­è®¾ç½®

å¦‚æœä½¿ç”¨PM2ï¼Œå¯ä»¥åœ¨å¯åŠ¨å‘½ä»¤ä¸­è®¾ç½®ï¼š

```bash
pm2 start app.py --name ml-service \
  --interpreter venv/bin/python \
  --env ML_SERVICE_PORT=5000 \
  --env FLASK_DEBUG=False
```

### æ–¹å¼ä¸‰ï¼šåœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­è®¾ç½®

```bash
# ç¼–è¾‘ç³»ç»Ÿç¯å¢ƒå˜é‡æ–‡ä»¶
nano /etc/environment

# æ·»åŠ ä»¥ä¸‹å†…å®¹
ML_SERVICE_PORT=5000
FLASK_DEBUG=False

# ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
source /etc/environment
```

---

## é…ç½®åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é€šè¿‡åŸŸåè®¿é—®MLæœåŠ¡ï¼ˆå¦‚ `https://api.yourdomain.com/ml`ï¼‰ï¼Œå¯ä»¥é…ç½®Nginxåå‘ä»£ç†ã€‚

### 1. åœ¨å®å¡”é¢æ¿ä¸­é…ç½®ç«™ç‚¹

1. è¿›å…¥"ç½‘ç«™" â†’ "æ·»åŠ ç«™ç‚¹"
2. å¡«å†™åŸŸåï¼ˆå¦‚ `ml-api.yourdomain.com`ï¼‰
3. é€‰æ‹©"çº¯é™æ€"æˆ–"PHPé¡¹ç›®"ï¼ˆè¿™é‡Œåªæ˜¯ç”¨äºé…ç½®ï¼Œå®é™…ç”±PythonæœåŠ¡å¤„ç†ï¼‰

### 2. é…ç½®Nginxåå‘ä»£ç†

åœ¨ç«™ç‚¹è®¾ç½®ä¸­ï¼š

1. ç‚¹å‡»"è®¾ç½®" â†’ "é…ç½®æ–‡ä»¶"
2. æ‰¾åˆ° `location /` éƒ¨åˆ†ï¼Œä¿®æ”¹ä¸ºï¼š

```nginx
location / {
    proxy_pass http://127.0.0.1:5000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # WebSocketæ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    
    # è¶…æ—¶è®¾ç½®
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}
```

3. ç‚¹å‡»"ä¿å­˜"å¹¶"é‡è½½é…ç½®"

### 3. é…ç½®SSLè¯ä¹¦ï¼ˆHTTPSï¼‰

1. åœ¨ç«™ç‚¹è®¾ç½®ä¸­ï¼Œç‚¹å‡»"SSL"
2. é€‰æ‹©"Let's Encrypt"å…è´¹è¯ä¹¦
3. ç‚¹å‡»"ç”³è¯·"å¹¶ç­‰å¾…è¯ä¹¦é¢å‘
4. å¼€å¯"å¼ºåˆ¶HTTPS"

---

## éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ

```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep 5000

# æˆ–ä½¿ç”¨sså‘½ä»¤
ss -tlnp | grep 5000

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep app.py
```

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

```
http://your-server-ip:5000/health
```

æˆ–ä½¿ç”¨curlï¼š

```bash
curl http://localhost:5000/health
```

åº”è¯¥è¿”å›ï¼š

```json
{
  "status": "ok",
  "service": "ML Prediction Service",
  "tensorflow_available": true
}
```

### 3. è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service
source venv/bin/activate
python test_service.py
```

### 4. æŸ¥çœ‹æ—¥å¿—

**ä½¿ç”¨Pythoné¡¹ç›®ç®¡ç†å™¨**ï¼š
- åœ¨é¡¹ç›®ç®¡ç†å™¨ä¸­ç‚¹å‡»"æ—¥å¿—"æŸ¥çœ‹

**ä½¿ç”¨PM2**ï¼š
```bash
pm2 logs ml-service
```

**æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—**ï¼š
```bash
# å¦‚æœä½¿ç”¨systemd
journalctl -u ml-service -f

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
tail -f /www/wwwroot/your-domain.com/sdk-platform/ml-service/logs/app.log
```

---

## å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š`Address already in use` æˆ– `ç«¯å£å·²è¢«å ç”¨`

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :5000
# æˆ–
netstat -tlnp | grep 5000

# æ€æ­»è¿›ç¨‹ï¼ˆæ›¿æ¢PIDä¸ºå®é™…è¿›ç¨‹IDï¼‰
kill -9 <PID>

# æˆ–ä¿®æ”¹MLæœåŠ¡ç«¯å£
# ç¼–è¾‘ .env æ–‡ä»¶
ML_SERVICE_PORT=5001
```

### é—®é¢˜2ï¼šCentOS 7 æ— æ³•æ‰¾åˆ° python38 åŒ…

**é”™è¯¯ä¿¡æ¯**ï¼š`No package python38 available` æˆ– `Nothing to do`

**åŸå› **ï¼šCentOS 7 é»˜è®¤çš„ EPEL ä»“åº“ä¸åŒ…å« Python 3.8ï¼Œéœ€è¦ä½¿ç”¨é¢å¤–çš„è½¯ä»¶æºã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

æ¨èä½¿ç”¨ **IUS ä»“åº“**ï¼ˆæœ€ç®€å•ï¼‰ï¼š

```bash
# å®‰è£…EPELæºï¼ˆå¿…é¡»å…ˆå®‰è£…ï¼‰
yum install -y epel-release

# å®‰è£…IUSä»“åº“
yum install -y https://repo.ius.io/ius-release-el7.rpm

# å®‰è£…Python 3.8
yum install -y python38u python38u-pip python38u-devel

# åˆ›å»ºè½¯é“¾æ¥
ln -sf /usr/bin/python3.8 /usr/bin/python3
ln -sf /usr/bin/pip3.8 /usr/bin/pip3

# éªŒè¯å®‰è£…
python3.8 --version
```

å¦‚æœ IUS ä»“åº“æ— æ³•è®¿é—®ï¼Œå¯ä»¥å°è¯•ï¼š

1. **ä½¿ç”¨é•œåƒæº**ï¼šé…ç½®å›½å†…é•œåƒæºåŠ é€Ÿä¸‹è½½
2. **ä½¿ç”¨ pyenv**ï¼šé€šè¿‡ pyenv ç®¡ç†å¤šç‰ˆæœ¬ Pythonï¼ˆè¯¦è§å®‰è£…Pythonç¯å¢ƒéƒ¨åˆ†ï¼‰
3. **ä»æºä»£ç ç¼–è¯‘**ï¼šä» Python å®˜ç½‘ä¸‹è½½æºç ç¼–è¯‘å®‰è£…ï¼ˆè¯¦è§å®‰è£…Pythonç¯å¢ƒéƒ¨åˆ†ï¼‰

**éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ**ï¼š

```bash
python3.8 --version  # åº”è¯¥æ˜¾ç¤º Python 3.8.x
pip3.8 --version     # åº”è¯¥æ˜¾ç¤º pip ç‰ˆæœ¬
```

### é—®é¢˜3ï¼šTensorFlowå®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼šå†…å­˜ä¸è¶³ã€ç¼–è¯‘é”™è¯¯ç­‰

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ä½¿ç”¨CPUç‰ˆæœ¬ï¼ˆæ›´è½»é‡ï¼‰
pip install tensorflow-cpu==2.13.0

# æˆ–å¢åŠ swapç©ºé—´
# åˆ›å»º2GB swapæ–‡ä»¶
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æ°¸ä¹…å¯ç”¨swap
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

### é—®é¢˜4ï¼šFlask 3.0.0 æ— æ³•å®‰è£… / æ‰¾ä¸åˆ°ç‰ˆæœ¬

**é”™è¯¯ä¿¡æ¯**ï¼š`ERROR: Could not find a version that satisfies the requirement flask==3.0.0`

**åŸå› **ï¼š
1. Flask 3.0.0 éœ€è¦ Python 3.9 æˆ–æ›´é«˜ç‰ˆæœ¬
2. å½“å‰è™šæ‹Ÿç¯å¢ƒå¯èƒ½ä½¿ç”¨äº† Python 3.8 æˆ–æ›´ä½ç‰ˆæœ¬
3. é•œåƒæºå¯èƒ½æ²¡æœ‰åŒæ­¥æœ€æ–°ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆä¸€ï¼šå‡çº§åˆ° Python 3.9+ï¼ˆæ¨èï¼‰**

```bash
# 1. åˆ é™¤æ—§çš„è™šæ‹Ÿç¯å¢ƒ
deactivate  # å…ˆé€€å‡ºå½“å‰è™šæ‹Ÿç¯å¢ƒ
rm -rf venv

# 2. å®‰è£… Python 3.9ï¼ˆCentOS 7 éœ€è¦ä½¿ç”¨ IUS æˆ– pyenvï¼‰
# ä½¿ç”¨ pyenv å®‰è£… Python 3.9.18
pyenv install 3.9.18
pyenv local 3.9.18

# æˆ–ä½¿ç”¨ IUS ä»“åº“ï¼ˆå¦‚æœæœ‰ Python 3.9ï¼‰
# yum install -y python39u python39u-pip python39u-devel

# 3. ä½¿ç”¨ Python 3.9 åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒ
python3.9 -m venv venv

# 4. æ¿€æ´»å¹¶å®‰è£…ä¾èµ–
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

**æ–¹æ¡ˆäºŒï¼šä½¿ç”¨å…¼å®¹ Python 3.8 çš„ç‰ˆæœ¬**

```bash
# 1. æ£€æŸ¥å½“å‰Pythonç‰ˆæœ¬
python --version

# 2. å¦‚æœç¡®è®¤æ˜¯ Python 3.8ï¼Œä½¿ç”¨å…¼å®¹ç‰ˆæœ¬çš„ä¾èµ–æ–‡ä»¶
pip install -r requirements-py38.txt

# æˆ–è€…æ‰‹åŠ¨å®‰è£…å…¼å®¹ç‰ˆæœ¬
pip install flask==2.3.3 flask-cors==4.0.0 numpy==1.24.3 pandas==2.0.3 scikit-learn==1.3.0 tensorflow==2.13.0 keras==2.13.1 python-dotenv==1.0.0 requests==2.31.0
```

**æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨å®˜æ–¹ PyPI æº**

å¦‚æœé•œåƒæºæ²¡æœ‰æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥ä¸´æ—¶ä½¿ç”¨å®˜æ–¹æºï¼š

```bash
# ä½¿ç”¨å®˜æ–¹ PyPI æº
pip install -r requirements.txt -i https://pypi.org/simple/

# æˆ–ä½¿ç”¨æ¸…åå¤§å­¦é•œåƒï¼ˆé€šå¸¸æ›´æ–°æ›´å¿«ï¼‰
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**éªŒè¯å®‰è£…**ï¼š

```bash
# æ£€æŸ¥ Flask ç‰ˆæœ¬
python -c "import flask; print(f'Flaskç‰ˆæœ¬: {flask.__version__}')"

# åº”è¯¥æ˜¾ç¤º Flask 3.0.0ï¼ˆPython 3.9+ï¼‰æˆ– Flask 2.3.3ï¼ˆPython 3.8ï¼‰
```

### é—®é¢˜5ï¼šä¾èµ–åŒ…å®‰è£…ç¼“æ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# æˆ–ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/

# æˆ–ä½¿ç”¨è…¾è®¯äº‘é•œåƒ
pip install -r requirements.txt -i https://mirrors.cloud.tencent.com/pypi/simple
```

### é—®é¢˜6ï¼šæƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š`Permission denied`

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®
chmod +x app.py
chmod +x start.sh

# ç¡®ä¿ç›®å½•æƒé™
chown -R www:www /www/wwwroot/your-domain.com/sdk-platform/ml-service
```

### é—®é¢˜7ï¼šè™šæ‹Ÿç¯å¢ƒä½¿ç”¨äº†é”™è¯¯çš„ Python ç‰ˆæœ¬

**é”™è¯¯ä¿¡æ¯**ï¼š`python --version` æ˜¾ç¤º `Python 2.7.x` æˆ–åœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ— æ³•å®‰è£… Flask 3.0.0

**åŸå› **ï¼š
- è™šæ‹Ÿç¯å¢ƒå¯èƒ½ä½¿ç”¨äº† Python 2.7 åˆ›å»º
- ç³»ç»Ÿé»˜è®¤ `python` å‘½ä»¤æŒ‡å‘ Python 2.7
- åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ä½¿ç”¨äº†é”™è¯¯çš„ Python ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. é€€å‡ºå½“å‰è™šæ‹Ÿç¯å¢ƒ
deactivate

# 2. åˆ é™¤æ—§çš„è™šæ‹Ÿç¯å¢ƒ
rm -rf venv

# 3. æ£€æŸ¥ç³»ç»Ÿä¸­å¯ç”¨çš„ Python 3 ç‰ˆæœ¬
python3 --version
python3.8 --version
python3.9 --version

# 4. ä½¿ç”¨æ­£ç¡®çš„ Python 3 ç‰ˆæœ¬åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
# å¦‚æœå·²å®‰è£… Python 3.8
python3.8 -m venv venv

# æˆ–å¦‚æœå·²å®‰è£… Python 3.9ï¼ˆæ¨èï¼Œæ”¯æŒ Flask 3.0.0ï¼‰
python3.9 -m venv venv

# 5. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# 6. éªŒè¯ç‰ˆæœ¬ï¼ˆå¿…é¡»æ˜¾ç¤º 3.8+ï¼Œç»å¯¹ä¸èƒ½æ˜¯ 2.7ï¼‰
python --version

# 7. å‡çº§ pip
pip install --upgrade pip

# 8. å®‰è£…ä¾èµ–
# å¦‚æœæ˜¯ Python 3.9+ï¼Œä½¿ç”¨æ ‡å‡† requirements.txt
pip install -r requirements.txt

# å¦‚æœæ˜¯ Python 3.8ï¼Œä½¿ç”¨å…¼å®¹ç‰ˆæœ¬
pip install -r requirements-py38.txt
```

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… `python --version` å¿…é¡»æ˜¾ç¤º `Python 3.8.x` æˆ–æ›´é«˜
- âŒ ç»å¯¹ä¸èƒ½æ˜¯ `Python 2.7.x`
- âœ… `which python` åº”è¯¥æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒè·¯å¾„ï¼š`.../venv/bin/python`

### é—®é¢˜8ï¼šè™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»

**é”™è¯¯ä¿¡æ¯**ï¼š`ModuleNotFoundError`

**è§£å†³æ–¹æ¡ˆ**ï¼š

ç¡®ä¿åœ¨ä½¿ç”¨PM2æˆ–Pythoné¡¹ç›®ç®¡ç†å™¨æ—¶ï¼Œæ­£ç¡®æŒ‡å®šäº†è™šæ‹Ÿç¯å¢ƒçš„Pythonè·¯å¾„ã€‚

```bash
# æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒè·¯å¾„å’Œç‰ˆæœ¬
which python
python --version
# åº”è¯¥æ˜¾ç¤ºï¼š/www/wwwroot/your-domain.com/sdk-platform/ml-service/venv/bin/python
# ç‰ˆæœ¬åº”è¯¥æ˜¯ï¼šPython 3.8.x æˆ–æ›´é«˜
```

### é—®é¢˜9ï¼šæœåŠ¡æ— æ³•è®¿é—®

**æ£€æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥é˜²ç«å¢™**ï¼š
   ```bash
   # æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
   firewall-cmd --list-all
   
   # å¼€æ”¾5000ç«¯å£
   firewall-cmd --zone=public --add-port=5000/tcp --permanent
   firewall-cmd --reload
   ```

2. **æ£€æŸ¥å®å¡”é˜²ç«å¢™**ï¼š
   - åœ¨å®å¡”é¢æ¿"å®‰å…¨"ä¸­ï¼Œæ·»åŠ 5000ç«¯å£è§„åˆ™

3. **æ£€æŸ¥æœåŠ¡æ˜¯å¦ç›‘å¬åœ¨0.0.0.0**ï¼š
   ```bash
   netstat -tlnp | grep 5000
   # åº”è¯¥æ˜¾ç¤º 0.0.0.0:5000 è€Œä¸æ˜¯ 127.0.0.1:5000
   ```

### é—®é¢˜10ï¼šå†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**ï¼š`Killed` æˆ– `Out of memory`

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. å¢åŠ swapç©ºé—´ï¼ˆè§é—®é¢˜2ï¼‰
2. ä½¿ç”¨CPUç‰ˆæœ¬çš„TensorFlow
3. å‡å°‘Gunicorn workeræ•°é‡ï¼š
   ```bash
   gunicorn -w 2 -b 0.0.0.0:5000 app:app  # ä»4ä¸ªworkerå‡å°‘åˆ°2ä¸ª
   ```

---

## ç»´æŠ¤å’Œæ›´æ–°

### æ›´æ–°ä»£ç 

```bash
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp -r . ../ml-service-backup-$(date +%Y%m%d)

# æ‹‰å–æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨Gitï¼‰
git pull

# æˆ–ä¸Šä¼ æ–°æ–‡ä»¶è¦†ç›–

# é‡å¯æœåŠ¡
pm2 restart ml-service
# æˆ–åœ¨Pythoné¡¹ç›®ç®¡ç†å™¨ä¸­ç‚¹å‡»"é‡å¯"
```

### æ›´æ–°ä¾èµ–

```bash
cd /www/wwwroot/your-domain.com/sdk-platform/ml-service
source venv/bin/activate

# æ›´æ–°æ‰€æœ‰ä¾èµ–
pip install --upgrade -r requirements.txt

# é‡å¯æœåŠ¡
pm2 restart ml-service
```

### æŸ¥çœ‹æ—¥å¿—å’Œç›‘æ§

- **å®æ—¶æ—¥å¿—**ï¼š`pm2 logs ml-service` æˆ–åœ¨Pythoné¡¹ç›®ç®¡ç†å™¨ä¸­æŸ¥çœ‹
- **ç³»ç»Ÿèµ„æº**ï¼šåœ¨å®å¡”é¢æ¿"ç›‘æ§"ä¸­æŸ¥çœ‹
- **è¿›ç¨‹çŠ¶æ€**ï¼š`pm2 status` æˆ–åœ¨Pythoné¡¹ç›®ç®¡ç†å™¨ä¸­æŸ¥çœ‹

---

## å®‰å…¨å»ºè®®

1. **ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨DEBUGæ¨¡å¼**ï¼š
   ```env
   FLASK_DEBUG=False
   ```

2. **ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®**ï¼š
   - åªå…è®¸ç‰¹å®šIPè®¿é—®5000ç«¯å£
   - æˆ–åªå…è®¸æœ¬åœ°è®¿é—®ï¼ˆ127.0.0.1ï¼‰

3. **ä½¿ç”¨HTTPS**ï¼š
   - é€šè¿‡Nginxåå‘ä»£ç†é…ç½®SSLè¯ä¹¦

4. **å®šæœŸæ›´æ–°ä¾èµ–**ï¼š
   ```bash
   pip list --outdated
   pip install --upgrade <package>
   ```

5. **ä½¿ç”¨érootç”¨æˆ·è¿è¡ŒæœåŠ¡**ï¼ˆæ¨èï¼‰ï¼š
   ```bash
   # åˆ›å»ºä¸“ç”¨ç”¨æˆ·
   useradd -m -s /bin/bash mlservice
   
   # ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…
   chown -R mlservice:mlservice /www/wwwroot/your-domain.com/sdk-platform/ml-service
   
   # ä½¿ç”¨è¯¥ç”¨æˆ·è¿è¡ŒæœåŠ¡
   su - mlservice
   ```

---

## æ€»ç»“

éƒ¨ç½²MLæœåŠ¡åˆ°å®å¡”é¢æ¿çš„æ­¥éª¤ï¼š

1. âœ… ä¼ è¾“æ–‡ä»¶åˆ°æœåŠ¡å™¨
2. âœ… å®‰è£…Python 3.8+
3. âœ… åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
4. âœ… å®‰è£…ä¾èµ–åŒ…
5. âœ… é…ç½®ç¯å¢ƒå˜é‡
6. âœ… ä½¿ç”¨Pythoné¡¹ç›®ç®¡ç†å™¨æˆ–PM2å¯åŠ¨æœåŠ¡
7. âœ… é…ç½®åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
8. âœ… éªŒè¯éƒ¨ç½²

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒ"å¸¸è§é—®é¢˜"éƒ¨åˆ†ï¼Œæˆ–æŸ¥çœ‹æœåŠ¡æ—¥å¿—è¿›è¡Œæ’æŸ¥ã€‚

---

**ç›¸å…³æ–‡æ¡£**ï¼š
- [MLæœåŠ¡ä½¿ç”¨è¯´æ˜](./doc/ä½¿ç”¨è¯´æ˜.md)
- [å¸¸è§é—®é¢˜](./doc/å¸¸è§é—®é¢˜.md)
- [é¡¹ç›®éƒ¨ç½²æŒ‡å—](../../docs/é¡¹ç›®éƒ¨ç½²æŒ‡å—.md)

