# ML预测服务常见问题

## 问题1: 看到警告信息 "This is a development server"

**问题描述**：
```
WARNING: This is a development server. Do not use it in a production deployment.
```

**解决方案**：
这是Flask开发服务器的正常提示信息，**可以安全忽略**。代码已经优化，会自动隐藏这些警告。

如果仍然看到警告，说明服务已经正常启动，可以继续使用。

## 问题2: 端口已被占用

**问题描述**：
```
OSError: [Errno 48] Address already in use
或
OSError: [WinError 10048] 地址已在使用
```

**解决方案**：

1. **查找占用端口的进程**：
   ```bash
   # Windows PowerShell
   netstat -ano | findstr :5000
   
   # 或者使用
   Get-NetTCPConnection -LocalPort 5000
   ```

2. **关闭占用端口的进程**：
   ```bash
   # 找到PID后，使用任务管理器关闭，或使用命令：
   taskkill /PID <进程ID> /F
   ```

3. **使用其他端口**：
   创建或修改 `.env` 文件：
   ```env
   ML_SERVICE_PORT=5001
   ```
   然后重启服务。

4. **同时更新后端配置**：
   在 `server/.env` 中更新：
   ```env
   ML_SERVICE_URL=http://localhost:5001
   ```

## 问题3: 无法连接到ML服务

**问题描述**：
前端显示 "ML预测服务不可用"

**解决方案**：

1. **检查服务是否启动**：
   - 查看终端是否有 "启动时序预测服务" 的日志
   - 服务应该显示运行在 `http://localhost:5000`

2. **测试服务连接**：
   ```bash
   # 使用测试脚本
   python test_service.py
   
   # 或使用浏览器访问
   http://localhost:5000/health
   ```

3. **检查防火墙设置**：
   - 确保防火墙允许5000端口
   - Windows: 控制面板 -> Windows Defender防火墙 -> 允许应用通过防火墙

4. **检查后端配置**：
   确保 `server/.env` 中的 `ML_SERVICE_URL` 配置正确：
   ```env
   ML_SERVICE_URL=http://localhost:5000
   ```

## 问题4: TensorFlow安装失败

**问题描述**：
```
ImportError: No module named 'tensorflow'
```

**解决方案**：

1. **使用CPU版本**（推荐）：
   ```bash
   pip install tensorflow-cpu==2.13.0
   ```

2. **检查Python版本**：
   - TensorFlow 2.13 需要 Python 3.8-3.11
   - 使用 `python --version` 检查

3. **使用虚拟环境**：
   ```bash
   python -m venv venv
   # Windows
   venv\Scripts\activate
   # Linux/Mac
   source venv/bin/activate
   
   pip install -r requirements.txt
   ```

4. **降级方案**：
   如果TensorFlow无法安装，服务会自动使用线性回归模型，功能仍然可用，只是预测准确性可能较低。

## 问题5: 预测失败 - 数据不足

**问题描述**：
```
历史数据不足，至少需要14天，当前只有X天
```

**解决方案**：

1. **确保数据库中有足够的历史数据**：
   - 至少需要14天的数据
   - 建议使用30天以上的数据以获得更好的预测效果

2. **检查数据日期范围**：
   - 确保数据是连续的
   - 没有缺失的日期

3. **生成测试数据**（仅用于测试）：
   可以使用SDK或手动插入一些测试数据到数据库。

## 问题6: 预测速度慢

**问题描述**：
预测需要很长时间才能完成

**解决方案**：

1. **这是正常的**：
   - 首次预测需要训练模型，可能需要10-30秒
   - 后续预测会快一些，但仍需要几秒钟

2. **优化建议**：
   - 使用GRU模型（比LSTM稍快）
   - 减少预测天数
   - 使用更少的历史数据（但可能影响准确性）

3. **生产环境优化**：
   - 考虑实现模型缓存
   - 使用GPU加速（需要安装tensorflow-gpu）

## 问题7: 预测结果不准确

**问题描述**：
预测结果与实际值偏差较大

**解决方案**：

1. **增加历史数据量**：
   - 使用更多天的历史数据（30-60天）
   - 确保数据质量良好

2. **检查数据模式**：
   - 如果数据有明显的周期性，模型会学习得更好
   - 如果数据完全随机，预测准确性会较低

3. **尝试不同模型**：
   - LSTM和GRU可能对不同的数据模式有不同的表现
   - 可以尝试两种模型，选择效果更好的

4. **数据预处理**：
   - 确保没有异常值
   - 数据应该是连续的，没有大的跳跃

## 问题8: Windows上Python命令找不到

**问题描述**：
```
'python' 不是内部或外部命令
```

**解决方案**：

1. **使用python3**：
   ```bash
   python3 app.py
   ```

2. **使用完整路径**：
   ```bash
   py app.py
   ```

3. **检查Python安装**：
   - 确保Python已安装并添加到PATH
   - 重新安装Python并勾选"Add Python to PATH"

## 获取帮助

如果以上方案都无法解决问题，请：

1. 查看服务日志中的详细错误信息
2. 运行测试脚本：`python test_service.py`
3. 检查所有依赖是否正确安装：`pip list`

