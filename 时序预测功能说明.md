# 时序预测功能实现说明

## 功能概述

已成功为项目添加了时序预测功能，使用LSTM和GRU深度学习模型来预测未来1-7天的PV、UV、转化率等指标。

## 实现内容

### 1. Python ML预测服务 (`ml-service/`)

- **文件**: `ml-service/app.py`
- **功能**: 
  - 使用TensorFlow/Keras实现LSTM和GRU模型
  - 支持PV、UV、转化率的预测
  - 自动数据归一化和预处理
  - 如果TensorFlow不可用，自动降级到线性回归
- **依赖**: `requirements.txt` 包含所有必需的Python包

### 2. Node.js后端服务

- **新增服务**: `server/src/services/predictionService.ts`
  - 获取历史数据
  - 调用ML服务进行预测
  - 处理错误和降级方案

- **新增路由**: `server/src/routes/api.ts`
  - `GET /api/prediction/health` - 检查ML服务状态
  - `POST /api/prediction/predict` - 预测单个指标
  - `POST /api/prediction/predict-batch` - 批量预测多个指标

- **依赖更新**: `server/package.json`
  - 添加了 `axios` 用于调用ML服务

### 3. 前端页面

- **新增页面**: `src/pages/Prediction/index.tsx`
  - ML服务状态检查
  - 预测参数配置（指标、模型、天数）
  - 单个指标预测和批量预测
  - 预测结果可视化（图表和表格）
  - 历史数据与预测数据对比

- **API集成**: `src/services/api.ts`
  - `checkPredictionHealth()` - 检查服务状态
  - `predict()` - 预测单个指标
  - `predictBatch()` - 批量预测

- **路由配置**: `src/router/index.tsx`
  - 添加了 `/app/prediction` 路由

- **菜单集成**: `src/components/Layout/MainLayout.tsx`
  - 在"分析"组中添加了"时序预测"菜单项

## 使用步骤

### 1. 启动ML预测服务

```bash
cd ml-service
pip install -r requirements.txt
python app.py
```

服务将在 `http://localhost:5000` 启动。

### 2. 启动后端服务

```bash
cd server
npm install  # 确保安装了axios
npm run dev
```

### 3. 启动前端服务

```bash
npm run dev
```

### 4. 使用预测功能

1. 登录系统
2. 在侧边栏"分析"组中点击"时序预测"
3. 检查ML服务状态（应显示"可用"）
4. 选择预测参数：
   - 预测指标：PV、UV或转化率
   - 预测模型：LSTM或GRU
   - 预测天数：1-30天
5. 点击"预测单个指标"或"批量预测"
6. 查看预测结果（图表和表格）

## 技术特点

1. **模型选择**：
   - LSTM：适合捕捉长期依赖关系，预测更准确
   - GRU：计算效率更高，训练速度更快

2. **数据要求**：
   - 至少需要14天的历史数据
   - 建议使用30天以上的历史数据

3. **降级方案**：
   - 如果TensorFlow不可用，自动使用线性回归
   - ML服务不可用时，前端会显示友好的错误提示

4. **性能优化**：
   - 数据归一化处理
   - 批量预测支持
   - 异步请求处理

## 文件结构

```
项目根目录/
├── ml-service/                    # Python ML预测服务
│   ├── app.py                     # Flask应用主文件
│   ├── requirements.txt           # Python依赖
│   ├── README.md                  # ML服务说明
│   └── 使用说明.md                # 中文使用说明
├── server/                        # Node.js后端
│   ├── src/
│   │   ├── services/
│   │   │   └── predictionService.ts  # 预测服务
│   │   └── routes/
│   │       └── api.ts             # API路由（已更新）
│   └── package.json               # 依赖（已更新）
└── src/                           # React前端
    ├── pages/
    │   └── Prediction/
    │       └── index.tsx          # 预测页面
    ├── services/
    │   └── api.ts                 # API调用（已更新）
    ├── router/
    │   └── index.tsx              # 路由（已更新）
    └── components/
        └── Layout/
            └── MainLayout.tsx     # 主布局（已更新）
```

## 注意事项

1. **环境要求**：
   - Python 3.8+
   - Node.js 16+
   - MySQL数据库

2. **ML服务配置**：
   - 默认运行在 `http://localhost:5000`
   - 可在 `server/.env` 中配置 `ML_SERVICE_URL`

3. **数据质量**：
   - 预测准确性取决于历史数据的质量和数量
   - 建议定期更新历史数据

4. **性能考虑**：
   - 首次预测需要训练模型，可能需要几秒钟
   - 批量预测可能需要更长时间

## 后续优化建议

1. **模型优化**：
   - 添加更多特征（如季节性、趋势等）
   - 使用更复杂的模型架构
   - 实现模型持久化，避免每次重新训练

2. **功能扩展**：
   - 支持更多指标预测
   - 添加预测置信区间
   - 实现预测结果导出

3. **用户体验**：
   - 添加预测历史记录
   - 实现预测结果对比
   - 添加预测准确性评估


