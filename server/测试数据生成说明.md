# 测试数据生成说明

## 概述

已为您生成了用于时序预测功能的测试数据SQL脚本。这些数据包含过去14天的合理且随机的数据，适合用于测试预测功能。

## 生成的文件

1. **`generated_test_data.sql`** - 完整的SQL插入脚本（推荐使用）
2. **`generate_test_data.py`** - Python生成脚本（可自定义参数）
3. **`generate_test_data.sql`** - 使用存储过程的版本（高级用法）

## 数据特点

生成的数据具有以下特点：

1. **时间范围**：过去14天的数据
2. **增长趋势**：整体呈上升趋势（每天约增长3%）
3. **周末效应**：周末数据相对较少（约减少20%）
4. **合理分布**：
   - PV（页面访问量）：每天约800-1200次
   - UV（独立访客）：约为PV的45-55%
   - 时间分布：8:00-23:00，高峰在10-12点和19-21点
5. **随机性**：包含合理的随机波动（±15%）
6. **设备多样性**：包含Windows、iOS、Android设备
7. **页面多样性**：包含9种不同的页面路径

## 使用方法

### 方法1：直接执行SQL文件（推荐）

1. **修改项目ID**（如果需要）：
   打开 `generated_test_data.sql`，修改第一行的项目ID：
   ```sql
   SET @project_id = 'your-project-id';  -- 改为您的项目ID
   ```

2. **执行SQL脚本**：
   ```bash
   # 使用MySQL命令行
   mysql -u your_username -p your_database < generated_test_data.sql
   
   # 或使用MySQL客户端工具（如Navicat、DBeaver等）直接执行SQL文件
   ```

3. **验证数据**：
   执行脚本末尾的查询语句，查看生成的数据统计。

### 方法2：使用Python脚本生成（可自定义）

1. **修改配置**：
   编辑 `generate_test_data.py`：
   ```python
   PROJECT_ID = 'your-project-id'  # 修改为您的项目ID
   DAYS = 14  # 生成天数（默认14天）
   ```

2. **运行脚本**：
   ```bash
   python generate_test_data.py
   ```

3. **执行生成的SQL**：
   脚本会生成 `generated_test_data.sql` 文件，然后按照方法1执行。

## 数据统计查询

执行以下SQL查看生成的数据统计：

```sql
SELECT 
    DATE(timestamp) as date,
    COUNT(*) as pv,
    COUNT(DISTINCT user_id) as uv,
    ROUND(COUNT(DISTINCT user_id) / COUNT(*) * 100, 2) as conversion_rate_percent
FROM events
WHERE project_id = 'demo-project'  -- 修改为您的项目ID
    AND timestamp >= DATE_SUB(NOW(), INTERVAL 14 DAY)
    AND event_name = 'pageview'
GROUP BY DATE(timestamp)
ORDER BY date ASC;
```

## 预期结果

执行后，您应该看到类似以下的数据：

| date       | pv   | uv  | conversion_rate_percent |
|------------|------|-----|------------------------|
| 2024-12-01 | 812  | 385 | 47.41                  |
| 2024-12-02 | 845  | 402 | 47.57                  |
| 2024-12-03 | 878  | 418 | 47.61                  |
| ...        | ...  | ... | ...                    |
| 2024-12-14 | 1125 | 534 | 47.47                  |

## 注意事项

1. **项目ID**：确保SQL中的项目ID与您的实际项目ID一致
2. **数据量**：生成的SQL文件可能较大（约5000-12000条记录），执行可能需要几秒钟
3. **重复执行**：如果重复执行，可能会产生重复数据，建议先清空旧数据：
   ```sql
   DELETE FROM events 
   WHERE project_id = 'demo-project' 
     AND timestamp >= DATE_SUB(NOW(), INTERVAL 14 DAY);
   ```
4. **时区**：数据使用服务器当前时区，确保时区设置正确

## 自定义数据

如果需要自定义数据特征，可以修改 `generate_test_data.py` 中的参数：

```python
# 基础PV值（第1天）
BASE_PV = 800

# 每日增长量
DAILY_GROWTH = 25

# 周末减少比例
WEEKEND_REDUCTION = 0.8

# UV/PV比例范围
UV_RATIO_MIN = 0.45
UV_RATIO_MAX = 0.55

# 随机波动范围
RANDOM_VARIANCE = 0.15
```

## 故障排查

### 问题1：执行SQL时出错

- 检查项目ID是否存在
- 检查数据库连接和权限
- 检查表结构是否正确

### 问题2：数据量不符合预期

- 检查 `DAYS` 参数设置
- 检查是否有数据被过滤

### 问题3：时间范围不对

- 检查服务器时区设置
- 修改脚本中的基准日期

## 下一步

生成数据后，您可以：

1. 在前端"时序预测"页面测试预测功能
2. 验证预测结果的合理性
3. 根据实际需求调整数据生成参数

