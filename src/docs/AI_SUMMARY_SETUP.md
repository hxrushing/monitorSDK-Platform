# AI 智能总结功能使用说明

## 功能概述

AI 智能总结功能可以每天自动分析您的数据分析平台数据，并生成专业的总结报告发送到您的邮箱。

## 功能特点

- ✅ 每天自动发送前一日的数据总结
- ✅ 可自定义发送时间
- ✅ 支持指定接收邮箱（默认使用注册邮箱）
- ✅ 可选择要总结的项目（默认总结所有项目）
- ✅ 使用 AI 分析数据并生成专业报告
- ✅ 包含关键指标、趋势分析和建议

## 配置步骤

### 1. 配置邮件服务（SMTP）

在 `server/.env` 文件中配置 SMTP 邮件服务：

```env
# SMTP邮件服务配置
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=your-email@gmail.com
```

**Gmail 配置说明：**
- 需要使用应用专用密码，而不是普通密码
- 在 Google 账号设置中启用"两步验证"
- 生成应用专用密码：https://myaccount.google.com/apppasswords

**其他邮件服务商配置：**
- QQ邮箱：`smtp.qq.com:587`
- 163邮箱：`smtp.163.com:25`
- Outlook：`smtp-mail.outlook.com:587`

### 2. 配置 AI 服务（可选）

如果需要使用 AI 生成更专业的总结，在 `server/.env` 中配置 OpenAI API：

```env
# OpenAI API配置（可选）
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_MODEL=gpt-3.5-turbo
```

**注意：** 如果不配置 OpenAI API，系统会使用基础模板生成总结，仍然包含所有关键数据。

### 3. 初始化数据库

确保数据库表已创建：

```bash
cd server
npm run init-db
```

### 4. 启动服务

```bash
# 启动后端服务
cd server
npm run dev

# 启动前端服务（另一个终端）
npm run dev
```

## 使用步骤

### 1. 访问设置页面

登录系统后，在侧边栏点击"AI 智能总结"或访问 `/app/ai-summary`

### 2. 配置设置

- **启用每日总结**：开启或关闭功能
- **发送时间**：选择每天发送总结的时间（例如：09:00）
- **接收邮箱**：可选，留空将使用注册时的邮箱
- **指定项目**：可选，留空将总结所有项目的数据

### 3. 保存设置

点击"保存设置"按钮保存配置

### 4. 测试发送

点击"立即发送测试"按钮可以立即发送一份测试总结，验证配置是否正确

## 总结内容

每日总结包含以下内容：

1. **数据概览**
   - 页面访问量(PV)
   - 独立访客数(UV)
   - 人均访问页面数
   - 平均停留时间

2. **趋势分析**
   - PV 变化趋势
   - UV 变化趋势

3. **热门事件**
   - Top 5 事件及其统计

4. **AI 分析**（如果配置了 OpenAI）
   - 专业的数据分析
   - 趋势解读
   - 优化建议

## 注意事项

1. **邮件服务配置**：必须正确配置 SMTP 服务才能发送邮件
2. **时区设置**：系统使用服务器时区，确保服务器时区正确
3. **数据要求**：需要有足够的数据才能生成有意义的总结
4. **AI 服务**：AI 服务是可选的，不配置也能正常使用基础总结功能
5. **定时任务**：系统每分钟检查一次，在指定时间自动发送

## 故障排查

### 邮件发送失败

1. 检查 SMTP 配置是否正确
2. 检查邮箱账号是否启用了应用专用密码
3. 查看服务器日志了解详细错误信息

### 总结内容为空

1. 检查是否有项目数据
2. 检查指定项目是否存在
3. 检查数据时间范围

### AI 总结不工作

1. 检查 OpenAI API Key 是否正确
2. 检查 API 余额是否充足
3. 查看服务器日志了解错误信息

## 技术支持

如有问题，请查看服务器日志或联系技术支持。

