# é¢è¯•é—®ç­”å‡†å¤‡ - æ•°æ®åˆ†æå¹³å°é¡¹ç›®

## ğŸ“‹ ç›®å½•
1. [çµæ´»çš„åŸ‹ç‚¹é…ç½®ç³»ç»Ÿ](#1-çµæ´»çš„åŸ‹ç‚¹é…ç½®ç³»ç»Ÿ)
2. [é«˜æ€§èƒ½æ•°æ®å¯è§†åŒ–](#2-é«˜æ€§èƒ½æ•°æ®å¯è§†åŒ–)
3. [AIæ™ºèƒ½æ€»ç»“åŠŸèƒ½](#3-aiæ™ºèƒ½æ€»ç»“åŠŸèƒ½)
4. [å·¥ç¨‹åŒ–ä¸å¯ç»´æŠ¤æ€§](#4-å·¥ç¨‹åŒ–ä¸å¯ç»´æŠ¤æ€§)
5. [æ•°æ®é“¾è·¯æ²»ç†](#5-æ•°æ®é“¾è·¯æ²»ç†)

---

## 1. çµæ´»çš„åŸ‹ç‚¹é…ç½®ç³»ç»Ÿ

### Q1: ä½ æåˆ°"æ”¯æŒäº‹ä»¶ã€å­—æ®µã€è§¦å‘æ¡ä»¶çš„å¯è§†åŒ–é…ç½®"ï¼Œå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘è®¾è®¡äº†ä¸€ä¸ªåŸºäº **JSON Schema** çš„åŠ¨æ€é…ç½®ç³»ç»Ÿï¼Œè®©ä¸šåŠ¡äººå‘˜å¯ä»¥é€šè¿‡å¯è§†åŒ–ç•Œé¢é…ç½®äº‹ä»¶å‚æ•°ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

**æ ¸å¿ƒå®ç°ï¼š**

1. **äº‹ä»¶å‚æ•°ç»“æ„å®šä¹‰**ï¼š
   - ä½¿ç”¨ `paramsSchema` å­—æ®µå­˜å‚¨ JSON Schema æ ¼å¼çš„å‚æ•°å®šä¹‰
   - æ”¯æŒåŠ¨æ€æ‰©å±•å­—æ®µç±»å‹ï¼ˆstringã€numberã€booleanã€objectç­‰ï¼‰
   - æ¯ä¸ªå­—æ®µå¯ä»¥é…ç½®æè¿°ã€ç±»å‹ã€æ˜¯å¦å¿…å¡«ç­‰å±æ€§

```typescript
// äº‹ä»¶å®šä¹‰ç¤ºä¾‹
{
  eventName: "page_view",
  description: "é¡µé¢æµè§ˆäº‹ä»¶",
  paramsSchema: {
    "page_url": {
      "type": "string",
      "description": "é¡µé¢URL",
      "required": true
    },
    "duration": {
      "type": "number",
      "description": "åœç•™æ—¶é•¿ï¼ˆç§’ï¼‰"
    }
  }
}
```

2. **å¯è§†åŒ–é…ç½®ç•Œé¢**ï¼š
   - ä½¿ç”¨ Ant Design Form æ„å»ºé…ç½®è¡¨å•
   - æä¾› JSON ç¼–è¾‘å™¨è®©ä¸šåŠ¡äººå‘˜ç›´æ¥ç¼–è¾‘å‚æ•°å®šä¹‰
   - å®æ—¶æ ¡éªŒ JSON æ ¼å¼å’Œ Schema æœ‰æ•ˆæ€§

3. **åŠ¨æ€æ ¡éªŒæœºåˆ¶**ï¼š
   - å‰ç«¯ä½¿ç”¨è‡ªå®šä¹‰ validator æ ¡éªŒ JSON æ ¼å¼
   - åç«¯éªŒè¯äº‹ä»¶åç§°æ ¼å¼ï¼ˆå­—æ¯å¼€å¤´ï¼Œæ”¯æŒå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰
   - æ£€æŸ¥äº‹ä»¶åç§°é‡å¤æ€§ï¼Œç¡®ä¿å”¯ä¸€æ€§

**æŠ€æœ¯äº®ç‚¹ï¼š**
- ä½¿ç”¨ JSON Schema ä½œä¸ºé…ç½®æ ‡å‡†ï¼Œæ˜“äºæ‰©å±•
- å‰åç«¯åŒé‡æ ¡éªŒï¼Œä¿è¯æ•°æ®è´¨é‡
- æ”¯æŒå®æ—¶é¢„è§ˆå’Œæ ¼å¼æ ¡éªŒï¼Œæå‡ç”¨æˆ·ä½“éªŒ"

---

### Q2: "å­—æ®µè”åŠ¨ã€åŠ¨æ€ç»„ä»¶æ¸²æŸ“ä¸æ ¡éªŒè§„åˆ™æ³¨å…¥"å…·ä½“æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"è¿™æ˜¯åŠ¨æ€è¡¨å•ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæˆ‘é€šè¿‡é…ç½®é©±åŠ¨çš„æ–¹å¼å®ç°äº†é«˜åº¦å¯æ‰©å±•çš„è¡¨å•ç³»ç»Ÿã€‚

**1. å­—æ®µè”åŠ¨æœºåˆ¶ï¼š**

```typescript
// åŸºäº Form.Item çš„ dependencies å®ç°å­—æ®µè”åŠ¨
<Form.Item
  name="eventType"
  label="äº‹ä»¶ç±»å‹"
>
  <Select onChange={handleEventTypeChange}>
    <Option value="page">é¡µé¢äº‹ä»¶</Option>
    <Option value="click">ç‚¹å‡»äº‹ä»¶</Option>
  </Select>
</Form.Item>

<Form.Item
  name="pageUrl"
  label="é¡µé¢URL"
  dependencies={['eventType']}
  rules={[
    ({ getFieldValue }) => ({
      validator: (_, value) => {
        const eventType = getFieldValue('eventType');
        if (eventType === 'page' && !value) {
          return Promise.reject('é¡µé¢äº‹ä»¶å¿…é¡»å¡«å†™é¡µé¢URL');
        }
        return Promise.resolve();
      }
    })
  ]}
>
  <Input />
</Form.Item>
```

**2. åŠ¨æ€ç»„ä»¶æ¸²æŸ“ï¼š**

```typescript
// æ ¹æ®å­—æ®µç±»å‹åŠ¨æ€æ¸²æŸ“ä¸åŒçš„ç»„ä»¶
const renderField = (field: FieldConfig) => {
  switch (field.type) {
    case 'string':
      return <Input placeholder={field.placeholder} />;
    case 'number':
      return <InputNumber min={field.min} max={field.max} />;
    case 'boolean':
      return <Switch />;
    case 'select':
      return <Select options={field.options} />;
    case 'date':
      return <DatePicker />;
    default:
      return <Input />;
  }
};

// æ ¹æ® paramsSchema åŠ¨æ€ç”Ÿæˆè¡¨å•å­—æ®µ
{Object.entries(paramsSchema).map(([key, config]) => (
  <Form.Item
    key={key}
    name={key}
    label={config.description}
    rules={buildValidationRules(config)}
  >
    {renderField(config)}
  </Form.Item>
))}
```

**3. æ ¡éªŒè§„åˆ™æ³¨å…¥ï¼š**

```typescript
// æ ¹æ®é…ç½®åŠ¨æ€ç”Ÿæˆæ ¡éªŒè§„åˆ™
const buildValidationRules = (config: FieldConfig) => {
  const rules = [];
  
  // å¿…å¡«æ ¡éªŒ
  if (config.required) {
    rules.push({ required: true, message: `${config.description}ä¸èƒ½ä¸ºç©º` });
  }
  
  // ç±»å‹æ ¡éªŒ
  if (config.type === 'string' && config.maxLength) {
    rules.push({ max: config.maxLength, message: `é•¿åº¦ä¸èƒ½è¶…è¿‡${config.maxLength}` });
  }
  
  if (config.type === 'number') {
    if (config.min !== undefined) {
      rules.push({ type: 'number', min: config.min, message: `ä¸èƒ½å°äº${config.min}` });
    }
    if (config.max !== undefined) {
      rules.push({ type: 'number', max: config.max, message: `ä¸èƒ½å¤§äº${config.max}` });
    }
  }
  
  // è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™
  if (config.pattern) {
    rules.push({ pattern: new RegExp(config.pattern), message: config.patternMessage });
  }
  
  return rules;
};
```

**æŠ€æœ¯äº®ç‚¹ï¼š**
- é…ç½®é©±åŠ¨ï¼Œæ–°å¢å­—æ®µç±»å‹åªéœ€æ‰©å±•æ¸²æŸ“é€»è¾‘
- æ ¡éªŒè§„åˆ™å¯é…ç½®ï¼Œæ”¯æŒè‡ªå®šä¹‰æ­£åˆ™ã€èŒƒå›´ç­‰
- å­—æ®µè”åŠ¨é€šè¿‡ Form.Item çš„ dependencies å®ç°ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†çŠ¶æ€"

---

### Q3: å¦‚ä½•ä¿è¯é…ç½®ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘åšäº†å‡ ä¸ªå…³é”®ä¼˜åŒ–ï¼š

**1. ç»„ä»¶æ‹†åˆ†å’ŒçŠ¶æ€ç®¡ç†ï¼š**
- å°†äº‹ä»¶å®šä¹‰åˆ—è¡¨ã€ç¼–è¾‘è¡¨å•æ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶
- ä½¿ç”¨ Zustand è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†ï¼Œé¿å… props å±‚å±‚ä¼ é€’
- ä½¿ç”¨ React.memo ä¼˜åŒ–åˆ—è¡¨é¡¹æ¸²æŸ“ï¼Œå‡å°‘ä¸å¿…è¦çš„ re-render

**2. è¡¨å•æ€§èƒ½ä¼˜åŒ–ï¼š**
```typescript
// ä½¿ç”¨ Form.useWatch æ›¿ä»£ useStateï¼Œå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“
const eventType = Form.useWatch('eventType', form);

// ä½¿ç”¨ shouldUpdate æ§åˆ¶å­—æ®µæ›´æ–°èŒƒå›´
<Form.Item shouldUpdate={(prev, curr) => prev.eventType !== curr.eventType}>
  {() => {
    const eventType = form.getFieldValue('eventType');
    return eventType === 'page' ? <PageUrlField /> : null;
  }}
</Form.Item>
```

**3. ç»Ÿä¸€æ ¡éªŒæœºåˆ¶ï¼š**
- å‰ç«¯ï¼šJSON Schema æ ¼å¼æ ¡éªŒã€äº‹ä»¶åç§°æ ¼å¼æ ¡éªŒã€é‡å¤æ€§æ ¡éªŒ
- åç«¯ï¼šæ•°æ®åº“å”¯ä¸€æ€§çº¦æŸã€å‚æ•°æ ¼å¼éªŒè¯
- é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºå®šä½é—®é¢˜

**4. ä»£ç ç»„ç»‡ï¼š**
- æ ¡éªŒé€»è¾‘æŠ½ç¦»ä¸ºç‹¬ç«‹å·¥å…·å‡½æ•°
- å­—æ®µé…ç½®ç±»å‹å®šä¹‰ç»Ÿä¸€ç®¡ç†
- è¡¨å•ç»„ä»¶å¯å¤ç”¨ï¼Œé™ä½ç»´æŠ¤æˆæœ¬"

---

## 2. é«˜æ€§èƒ½æ•°æ®å¯è§†åŒ–

### Q1: ä½ æåˆ°"åŸºäº ECharts + è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–å¤§æ•°æ®é‡è¡¨æ ¼"ï¼Œå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘é’ˆå¯¹ç™¾ä¸‡çº§æ•°æ®åœºæ™¯åšäº†å¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–ï¼š

**1. åç«¯æ•°æ®èšåˆï¼š**
- ä¸åœ¨å‰ç«¯å¤„ç†åŸå§‹æ•°æ®ï¼Œåç«¯é¢„å…ˆèšåˆï¼ˆæŒ‰å¤©ã€æŒ‰äº‹ä»¶åˆ†ç»„ï¼‰
- å‰ç«¯åªæ¥æ”¶æ±‡æ€»åçš„æ•°æ®ï¼Œå¤§å¹…å‡å°‘ä¼ è¾“å’Œæ¸²æŸ“é‡
- ä½¿ç”¨æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

**2. è™šæ‹Ÿæ»šåŠ¨å®ç°ï¼š**
```typescript
// ä½¿ç”¨ react-window æˆ– antd Table çš„è™šæ‹Ÿæ»šåŠ¨
import { FixedSizeList } from 'react-window';

const VirtualizedTable = ({ data }) => {
  const Row = ({ index, style }) => (
    <div style={style}>
      <TableRow data={data[index]} />
    </div>
  );

  return (
    <FixedSizeList
      height={600}
      itemCount={data.length}
      itemSize={50}
      width="100%"
    >
      {Row}
    </FixedSizeList>
  );
};
```

**3. å›¾è¡¨æ‡’åŠ è½½ï¼š**
```typescript
// ä½¿ç”¨ React.lazy å®ç°å›¾è¡¨ç»„ä»¶æŒ‰éœ€åŠ è½½
const Line = React.lazy(() => 
  import('@ant-design/plots').then(m => ({ default: m.Line }))
);

// ä½¿ç”¨ Suspense åŒ…è£¹ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
<Suspense fallback={<Spin />}>
  <Line {...lineConfig} />
</Suspense>
```

**4. æ•°æ®åˆ†é¡µå’ŒæŒ‰éœ€åŠ è½½ï¼š**
- è¡¨æ ¼æ”¯æŒåˆ†é¡µï¼Œæ¯æ¬¡åªåŠ è½½å½“å‰é¡µæ•°æ®
- å›¾è¡¨æ”¯æŒæ—¶é—´èŒƒå›´ç­›é€‰ï¼Œå‡å°‘æ•°æ®é‡
- ä½¿ç”¨é˜²æŠ–ä¼˜åŒ–ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶çš„è¯·æ±‚é¢‘ç‡

**æ€§èƒ½æŒ‡æ ‡ï¼š**
- ç™¾ä¸‡çº§æ•°æ®ä¸‹è¡¨æ ¼æ»šåŠ¨æµç•…ï¼ˆ60fpsï¼‰
- é¦–å±åŠ è½½æ—¶é—´ < 2s
- å›¾è¡¨æ¸²æŸ“æ—¶é—´ < 500ms"

---

### Q2: "å¯æ‹–æ‹½ã€å¯ç»„åˆçš„çœ‹æ¿å¸ƒå±€"æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘ä½¿ç”¨ **react-grid-layout** å®ç°äº†å¯æ‹–æ‹½ã€å¯è°ƒæ•´å¤§å°çš„çœ‹æ¿å¸ƒå±€ï¼š

**1. å¸ƒå±€é…ç½®ï¼š**
```typescript
import GridLayout from 'react-grid-layout';
import 'react-grid-layout/css/styles.css';

const DashboardLayout = () => {
  const [layout, setLayout] = useState([
    { i: 'chart1', x: 0, y: 0, w: 6, h: 4 },
    { i: 'chart2', x: 6, y: 0, w: 6, h: 4 },
    { i: 'table1', x: 0, y: 4, w: 12, h: 6 }
  ]);

  return (
    <GridLayout
      className="layout"
      layout={layout}
      cols={12}
      rowHeight={50}
      width={1200}
      onLayoutChange={setLayout}
      isDraggable={true}
      isResizable={true}
    >
      <div key="chart1"><LineChart /></div>
      <div key="chart2"><BarChart /></div>
      <div key="table1"><DataTable /></div>
    </GridLayout>
  );
};
```

**2. å¸ƒå±€æŒä¹…åŒ–ï¼š**
- å°†å¸ƒå±€é…ç½®ä¿å­˜åˆ° localStorage æˆ–åç«¯
- ç”¨æˆ·è‡ªå®šä¹‰çš„å¸ƒå±€å¯ä»¥ä¿å­˜å’Œæ¢å¤
- æ”¯æŒå¤šç§é¢„è®¾å¸ƒå±€æ¨¡æ¿

**3. ç»„ä»¶æ³¨å†Œæœºåˆ¶ï¼š**
```typescript
// å¯æ‹–æ‹½çš„ç»„ä»¶æ³¨å†Œè¡¨
const widgetRegistry = {
  lineChart: LineChart,
  barChart: BarChart,
  dataTable: DataTable,
  statistic: StatisticCard
};

// åŠ¨æ€æ¸²æŸ“ç»„ä»¶
const renderWidget = (widgetType: string, props: any) => {
  const Widget = widgetRegistry[widgetType];
  return Widget ? <Widget {...props} /> : null;
};
```

**æŠ€æœ¯äº®ç‚¹ï¼š**
- æ”¯æŒæ‹–æ‹½ã€è°ƒæ•´å¤§å°ã€åˆ é™¤ç­‰æ“ä½œ
- å¸ƒå±€é…ç½®å¯ä¿å­˜ï¼Œç”¨æˆ·ä½“éªŒå¥½
- ç»„ä»¶åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•æ–°çš„å›¾è¡¨ç±»å‹"

---

### Q3: å¦‚ä½•ä¿è¯å¤§æ•°æ®é‡ä¸‹çš„å›¾è¡¨æ¸²æŸ“æ€§èƒ½ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘åšäº†å‡ ä¸ªå…³é”®ä¼˜åŒ–ï¼š

**1. æ•°æ®é‡‡æ ·ï¼š**
```typescript
// å½“æ•°æ®ç‚¹è¶…è¿‡1000ä¸ªæ—¶ï¼Œè¿›è¡Œé‡‡æ ·
const sampleData = (data: any[], maxPoints: number = 1000) => {
  if (data.length <= maxPoints) return data;
  
  const step = Math.ceil(data.length / maxPoints);
  return data.filter((_, index) => index % step === 0);
};
```

**2. å›¾è¡¨é…ç½®ä¼˜åŒ–ï¼š**
```typescript
const lineConfig = {
  data: sampleData(rawData),
  animation: false, // å¤§æ•°æ®é‡æ—¶å…³é—­åŠ¨ç”»
  smooth: false,    // å…³é—­å¹³æ»‘æ›²çº¿ï¼Œæå‡æ€§èƒ½
  point: false,     // ä¸æ˜¾ç¤ºæ•°æ®ç‚¹ï¼Œå‡å°‘æ¸²æŸ“å…ƒç´ 
  // ä½¿ç”¨ Canvas æ¸²æŸ“è€Œé SVG
  renderer: 'canvas'
};
```

**3. æŒ‰éœ€æ¸²æŸ“ï¼š**
- ä½¿ç”¨ `requestAnimationFrame` æ§åˆ¶æ¸²æŸ“æ—¶æœº
- å›¾è¡¨å®¹å™¨ä¸å¯è§æ—¶ä¸æ¸²æŸ“
- ä½¿ç”¨ `IntersectionObserver` å®ç°æ‡’åŠ è½½

**4. Web Worker æ•°æ®å¤„ç†ï¼š**
```typescript
// å°†æ•°æ®èšåˆè®¡ç®—æ”¾åˆ° Web Worker
const worker = new Worker('dataProcessor.js');
worker.postMessage({ data: rawData, type: 'aggregate' });
worker.onmessage = (e) => {
  setChartData(e.data);
};
```

**æ€§èƒ½æŒ‡æ ‡ï¼š**
- 10ä¸‡æ•°æ®ç‚¹æ¸²æŸ“æ—¶é—´ < 1s
- äº¤äº’å“åº”æ—¶é—´ < 100ms
- å†…å­˜å ç”¨ < 100MB"

---

## 3. AIæ™ºèƒ½æ€»ç»“åŠŸèƒ½

### Q1: "ç»Ÿä¸€æ•°æ®èšåˆå±‚"å…·ä½“æ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘è®¾è®¡äº†ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®èšåˆæœåŠ¡ï¼Œå°†å¤šä¸ªæ•°æ®æºçš„èšåˆé€»è¾‘é›†ä¸­ç®¡ç†ï¼š

**1. æ•°æ®èšåˆæœåŠ¡ï¼š**
```typescript
// server/src/services/summaryService.ts
class SummaryService {
  // ç»Ÿä¸€çš„æ•°æ®èšåˆæ–¹æ³•
  async aggregateProjectData(projectId: string, date: string) {
    // 1. è·å–åŸºç¡€ç»Ÿè®¡æ•°æ®
    const stats = await this.getDailyStats(projectId, date);
    
    // 2. è·å–è¶‹åŠ¿æ•°æ®ï¼ˆåŒæ¯”ã€ç¯æ¯”ï¼‰
    const trends = await this.calculateTrends(projectId, date);
    
    // 3. è·å–çƒ­é—¨äº‹ä»¶
    const topEvents = await this.getTopEvents(projectId, date);
    
    // 4. ç»Ÿä¸€è¿”å›æ ¼å¼
    return {
      projectId,
      projectName: await this.getProjectName(projectId),
      date,
      stats,
      trends,
      topEvents
    };
  }
}
```

**2. å‰ç«¯æ•°æ®èšåˆå±‚ï¼š**
```typescript
// src/services/api.ts
class ApiService {
  // ç»Ÿä¸€çš„æ•°æ®è·å–æ¥å£
  async getSummaryData(projectIds: string[], date: string) {
    // å¹¶è¡Œè¯·æ±‚å¤šä¸ªé¡¹ç›®çš„æ•°æ®
    const promises = projectIds.map(id => 
      this.aggregateProjectData(id, date)
    );
    
    return Promise.all(promises);
  }
}
```

**3. æ•°æ®æ ¼å¼æ ‡å‡†åŒ–ï¼š**
- æ‰€æœ‰æ•°æ®æºç»Ÿä¸€è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
- å‰ç«¯æ— éœ€å…³å¿ƒæ•°æ®æ¥æºï¼Œåªéœ€å¤„ç†ç»Ÿä¸€æ ¼å¼
- ä¾¿äºåç»­æ‰©å±•æ–°çš„æ•°æ®æº

**æŠ€æœ¯äº®ç‚¹ï¼š**
- å‰åç«¯èŒè´£æ¸…æ™°ï¼Œå‰ç«¯åªè´Ÿè´£å±•ç¤º
- æ•°æ®èšåˆé€»è¾‘é›†ä¸­ï¼Œæ˜“äºç»´æŠ¤
- æ”¯æŒå¹¶è¡Œè¯·æ±‚ï¼Œæå‡æ€§èƒ½"

---

### Q2: "Prompt æ„å»ºä¸ç»“æ„åŒ–è¾“å‡ºè§£æ"æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘è®¾è®¡äº†ä¸€ä¸ªçµæ´»çš„ Prompt æ„å»ºç³»ç»Ÿï¼Œæ”¯æŒåŠ¨æ€ç”Ÿæˆå’Œç»“æ„åŒ–è¾“å‡ºï¼š

**1. Prompt æ„å»ºï¼š**
```typescript
// server/src/services/aiService.ts
private buildPrompt(data: SummaryData[]): string {
  let prompt = 'è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®åˆ†æç»“æœï¼Œç”Ÿæˆä¸€ä»½ä¸“ä¸šã€ç®€æ´çš„æ¯æ—¥æ•°æ®æ€»ç»“æŠ¥å‘Šã€‚\n\n';
  
  data.forEach((project) => {
    prompt += `é¡¹ç›®ï¼š${project.projectName}\n`;
    prompt += `æ—¥æœŸï¼š${project.date}\n`;
    prompt += `æ•°æ®æ¦‚è§ˆï¼š\n`;
    prompt += `- é¡µé¢è®¿é—®é‡(PV)ï¼š${project.stats.pv}\n`;
    prompt += `- ç‹¬ç«‹è®¿å®¢æ•°(UV)ï¼š${project.stats.uv}\n`;
    
    // è¶‹åŠ¿åˆ†æ
    if (project.trends) {
      prompt += `è¶‹åŠ¿åˆ†æï¼š\n`;
      prompt += `- PVå˜åŒ–ï¼š${project.trends.pvChange > 0 ? '+' : ''}${(project.trends.pvChange * 100).toFixed(2)}%\n`;
    }
    
    // çƒ­é—¨äº‹ä»¶
    if (project.topEvents && project.topEvents.length > 0) {
      prompt += `çƒ­é—¨äº‹ä»¶ï¼š\n`;
      project.topEvents.forEach((event, index) => {
        prompt += `${index + 1}. ${event.eventName}ï¼š${event.count}æ¬¡\n`;
      });
    }
    
    prompt += '\n';
  });
  
  prompt += 'è¯·ç”¨ä¸“ä¸šã€ç®€æ´çš„ä¸­æ–‡æ€»ç»“è¿™äº›æ•°æ®ï¼ŒåŒ…æ‹¬å…³é”®æŒ‡æ ‡ã€è¶‹åŠ¿åˆ†æå’Œå»ºè®®ã€‚';
  
  return prompt;
}
```

**2. ç»“æ„åŒ–è¾“å‡ºè§£æï¼š**
```typescript
// ä½¿ç”¨ Markdown æ ¼å¼ï¼Œä¾¿äºè§£æå’Œå±•ç¤º
const generateSummary = async (data: SummaryData[]) => {
  const prompt = this.buildPrompt(data);
  
  // è°ƒç”¨ OpenAI API
  const response = await this.client.chat.completions.create({
    model: 'gpt-3.5-turbo',
    messages: [
      {
        role: 'system',
        content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°æ®åˆ†æå¸ˆï¼Œæ“…é•¿ç”¨ç®€æ´çš„è¯­è¨€æ€»ç»“æ•°æ®ã€‚'
      },
      {
        role: 'user',
        content: prompt
      }
    ],
    // è¦æ±‚è¿”å› Markdown æ ¼å¼
    response_format: { type: 'markdown' }
  });
  
  const summary = response.choices[0].message.content;
  
  // ä½¿ç”¨ markdown-it è§£æä¸º HTML
  const md = new MarkdownIt();
  const html = md.render(summary);
  
  return html;
};
```

**3. å®¹é”™å’Œé™çº§ï¼š**
```typescript
// å¦‚æœ AI æœåŠ¡ä¸å¯ç”¨ï¼Œä½¿ç”¨æ¨¡æ¿ç”ŸæˆåŸºç¡€æ€»ç»“
private generateBasicSummary(data: SummaryData[]): string {
  let summary = '<h2>æ¯æ—¥æ•°æ®æ€»ç»“æŠ¥å‘Š</h2>\n\n';
  
  data.forEach(project => {
    summary += `<h3>${project.projectName}</h3>\n`;
    summary += `<p>PV: ${project.stats.pv}, UV: ${project.stats.uv}</p>\n`;
    // ... æ›´å¤šå†…å®¹
  });
  
  return summary;
}
```

**æŠ€æœ¯äº®ç‚¹ï¼š**
- Prompt æ¨¡æ¿åŒ–ï¼Œæ˜“äºè°ƒæ•´å’Œä¼˜åŒ–
- æ”¯æŒ Markdown æ ¼å¼ï¼Œä¾¿äºè§£æå’Œå±•ç¤º
- æœ‰é™çº§æ–¹æ¡ˆï¼Œä¿è¯åŠŸèƒ½å¯ç”¨æ€§"

---

### Q3: "æ™ºèƒ½æ‘˜è¦çš„å¯è§†åŒ–å±•ç¤º"æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘è®¾è®¡äº†ä¸€ä¸ªæ”¯æŒ Markdown æ¸²æŸ“å’Œäº¤äº’çš„å¯è§†åŒ–å±•ç¤ºç»„ä»¶ï¼š

**1. Markdown æ¸²æŸ“ï¼š**
```typescript
import ReactMarkdown from 'react-markdown';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';

const SummaryDisplay = ({ summary }: { summary: string }) => {
  return (
    <Card>
      <ReactMarkdown
        components={{
          // è‡ªå®šä¹‰ä»£ç å—æ¸²æŸ“
          code({ node, inline, className, children, ...props }) {
            const match = /language-(\w+)/.exec(className || '');
            return !inline && match ? (
              <SyntaxHighlighter language={match[1]}>
                {String(children).replace(/\n$/, '')}
              </SyntaxHighlighter>
            ) : (
              <code className={className} {...props}>
                {children}
              </code>
            );
          },
          // è‡ªå®šä¹‰è¡¨æ ¼æ¸²æŸ“
          table: ({ children }) => (
            <Table dataSource={parseTable(children)} />
          )
        }}
      >
        {summary}
      </ReactMarkdown>
    </Card>
  );
};
```

**2. æ•°æ®é«˜äº®ï¼š**
- è‡ªåŠ¨è¯†åˆ«æ•°å­—ã€ç™¾åˆ†æ¯”ã€è¶‹åŠ¿ç­‰å…³é”®æ•°æ®
- ä½¿ç”¨ä¸åŒé¢œè‰²é«˜äº®å¼‚å¸¸æ•°æ®ï¼ˆå¦‚å¤§å¹…ä¸‹é™ï¼‰
- æ”¯æŒå›¾è¡¨åµŒå…¥ï¼Œå°†æ•°æ®å¯è§†åŒ–

**3. äº¤äº’åŠŸèƒ½ï¼š**
- æ”¯æŒå±•å¼€/æŠ˜å ç« èŠ‚
- æ”¯æŒå¤åˆ¶ã€åˆ†äº«åŠŸèƒ½
- æ”¯æŒå¯¼å‡ºä¸º PDF æˆ– Word

**æŠ€æœ¯äº®ç‚¹ï¼š**
- ä½¿ç”¨ ReactMarkdown å®ç° Markdown æ¸²æŸ“
- æ”¯æŒä»£ç é«˜äº®ã€è¡¨æ ¼ç­‰å¤æ‚æ ¼å¼
- äº¤äº’å‹å¥½ï¼Œç”¨æˆ·ä½“éªŒå¥½"

---

## 4. å·¥ç¨‹åŒ–ä¸å¯ç»´æŠ¤æ€§

### Q1: ä½ æåˆ°å°è£…äº† useRequestã€useChartã€useEventBus ç­‰ Hookï¼Œå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘å°è£…äº†å‡ ä¸ªé€šç”¨çš„ Hookï¼Œæå‡ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼š

**1. useRequest Hookï¼š**
```typescript
// src/hooks/useRequest.ts
import { useState, useEffect } from 'react';

interface UseRequestOptions<T> {
  manual?: boolean; // æ˜¯å¦æ‰‹åŠ¨è§¦å‘
  onSuccess?: (data: T) => void;
  onError?: (error: Error) => void;
}

export function useRequest<T>(
  requestFn: () => Promise<T>,
  options: UseRequestOptions<T> = {}
) {
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  const run = async () => {
    try {
      setLoading(true);
      setError(null);
      const result = await requestFn();
      setData(result);
      options.onSuccess?.(result);
      return result;
    } catch (err) {
      const error = err as Error;
      setError(error);
      options.onError?.(error);
      throw error;
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    if (!options.manual) {
      run();
    }
  }, []);

  return { data, loading, error, run, refresh: run };
}

// ä½¿ç”¨ç¤ºä¾‹
const { data, loading, error, refresh } = useRequest(
  () => apiService.getStats(projectId),
  { onSuccess: (data) => console.log('æ•°æ®åŠ è½½æˆåŠŸ', data) }
);
```

**2. useChart Hookï¼š**
```typescript
// src/hooks/useChart.ts
import { useState, useMemo } from 'react';
import { Line, Bar, Pie } from '@ant-design/plots';

export function useChart<T>(
  data: T[],
  chartType: 'line' | 'bar' | 'pie',
  config: any
) {
  const [loading, setLoading] = useState(false);

  const chartConfig = useMemo(() => ({
    data,
    loading,
    ...config,
    animation: {
      appear: {
        animation: 'wave-in',
        duration: 1000,
      },
    },
  }), [data, loading, config]);

  const ChartComponent = useMemo(() => {
    switch (chartType) {
      case 'line': return Line;
      case 'bar': return Bar;
      case 'pie': return Pie;
      default: return Line;
    }
  }, [chartType]);

  return {
    ChartComponent,
    config: chartConfig,
    setLoading
  };
}

// ä½¿ç”¨ç¤ºä¾‹
const { ChartComponent, config } = useChart(
  statsData,
  'line',
  { xField: 'date', yField: 'value' }
);
```

**3. useEventBus Hookï¼š**
```typescript
// src/hooks/useEventBus.ts
import { useEffect, useRef } from 'react';

class EventBus {
  private events: Map<string, Function[]> = new Map();

  on(event: string, callback: Function) {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event)!.push(callback);
  }

  off(event: string, callback: Function) {
    const callbacks = this.events.get(event);
    if (callbacks) {
      const index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    }
  }

  emit(event: string, ...args: any[]) {
    const callbacks = this.events.get(event);
    if (callbacks) {
      callbacks.forEach(callback => callback(...args));
    }
  }
}

const eventBus = new EventBus();

export function useEventBus(event: string, callback: Function) {
  const callbackRef = useRef(callback);

  useEffect(() => {
    callbackRef.current = callback;
  }, [callback]);

  useEffect(() => {
    const handler = (...args: any[]) => callbackRef.current(...args);
    eventBus.on(event, handler);
    return () => eventBus.off(event, handler);
  }, [event]);
}

// ä½¿ç”¨ç¤ºä¾‹
useEventBus('projectChanged', (projectId: string) => {
  console.log('é¡¹ç›®åˆ‡æ¢:', projectId);
  refreshData();
});
```

**æŠ€æœ¯äº®ç‚¹ï¼š**
- ç»Ÿä¸€çš„æ•°æ®è¯·æ±‚å¤„ç†é€»è¾‘
- å›¾è¡¨é…ç½®æ ‡å‡†åŒ–
- äº‹ä»¶æ€»çº¿è§£è€¦ç»„ä»¶é€šä¿¡"

---

### Q2: "å»ºç«‹æ¨¡å—åŒ– SDKï¼ˆåŸ‹ç‚¹ã€æ—¥å¿—ã€è¿½è¸ªï¼‰å¹¶æŠ½ç¦»å…¬å…±é€»è¾‘"æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘è®¾è®¡äº†ä¸€ä¸ªæ¨¡å—åŒ–çš„ SDK æ¶æ„ï¼Œå°†ä¸åŒåŠŸèƒ½æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼š

**1. SDK æ ¸å¿ƒæ¶æ„ï¼š**
```typescript
// src/sdk/index.ts
class AnalyticsSDK {
  private tracking: TrackingModule;
  private logging: LoggingModule;
  private monitoring: MonitoringModule;

  constructor(projectId: string, endpoint: string) {
    // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
    this.tracking = new TrackingModule(projectId, endpoint);
    this.logging = new LoggingModule(projectId, endpoint);
    this.monitoring = new MonitoringModule(projectId, endpoint);
  }

  // ç»Ÿä¸€çš„æ‰¹é‡å‘é€æœºåˆ¶ï¼ˆå…¬å…±é€»è¾‘ï¼‰
  private async flushQueue(events: Event[]) {
    // æ‰¹é‡å‘é€é€»è¾‘
  }

  // ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ï¼ˆå…¬å…±é€»è¾‘ï¼‰
  private handleError(error: Error) {
    // é”™è¯¯å¤„ç†é€»è¾‘
  }
}
```

**2. æ¨¡å—åŒ–è®¾è®¡ï¼š**
```typescript
// åŸ‹ç‚¹æ¨¡å—
class TrackingModule {
  track(eventName: string, params: Record<string, any>) {
    // åŸ‹ç‚¹é€»è¾‘
  }
}

// æ—¥å¿—æ¨¡å—
class LoggingModule {
  log(level: 'info' | 'warn' | 'error', message: string) {
    // æ—¥å¿—é€»è¾‘
  }
}

// è¿½è¸ªæ¨¡å—
class MonitoringModule {
  monitor(metric: string, value: number) {
    // ç›‘æ§é€»è¾‘
  }
}
```

**3. å…¬å…±é€»è¾‘æŠ½ç¦»ï¼š**
```typescript
// å…¬å…±çš„æ‰¹é‡å‘é€é€»è¾‘
class BatchSender {
  private queue: Event[] = [];
  private config: BatchConfig;

  async flush() {
    // æ‰¹é‡å‘é€å®ç°
  }
}

// å…¬å…±çš„å­˜å‚¨é€»è¾‘
class StorageManager {
  save(key: string, data: any) {
    // å­˜å‚¨å®ç°
  }

  load(key: string) {
    // åŠ è½½å®ç°
  }
}

// å„æ¨¡å—å…±äº«è¿™äº›å…¬å…±é€»è¾‘
class TrackingModule {
  private batchSender: BatchSender;
  private storage: StorageManager;

  constructor() {
    this.batchSender = new BatchSender();
    this.storage = new StorageManager();
  }
}
```

**æŠ€æœ¯äº®ç‚¹ï¼š**
- æ¨¡å—èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- å…¬å…±é€»è¾‘å¤ç”¨ï¼Œå‡å°‘é‡å¤ä»£ç 
- æ”¯æŒæŒ‰éœ€åŠ è½½ï¼Œå‡å°‘ SDK ä½“ç§¯"

---

## 5. æ•°æ®é“¾è·¯æ²»ç†

### Q1: "å‰ç«¯é‡‡é›† â†’ æ•°æ®æ ¡éªŒ â†’ ä¸ŠæŠ¥ â†’ åˆ†æå±•ç¤ºçš„å®Œæ•´é“¾è·¯"æ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘è®¾è®¡äº†ä¸€ä¸ªå®Œæ•´çš„æ•°æ®å¤„ç†é“¾è·¯ï¼Œç¡®ä¿æ•°æ®è´¨é‡å’Œå¯é æ€§ï¼š

**1. å‰ç«¯é‡‡é›†å±‚ï¼š**
```typescript
// SDK é‡‡é›†äº‹ä»¶
sdk.track('page_view', {
  page_url: window.location.href,
  timestamp: Date.now()
});
```

**2. æ•°æ®æ ¡éªŒå±‚ï¼š**
```typescript
// å‰ç«¯æ ¡éªŒ
class EventValidator {
  validate(event: Event): ValidationResult {
    // 1. å¿…å¡«å­—æ®µæ ¡éªŒ
    if (!event.eventName) {
      return { valid: false, error: 'äº‹ä»¶åç§°ä¸èƒ½ä¸ºç©º' };
    }

    // 2. å­—æ®µæ ¼å¼æ ¡éªŒ
    if (!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(event.eventName)) {
      return { valid: false, error: 'äº‹ä»¶åç§°æ ¼å¼ä¸æ­£ç¡®' };
    }

    // 3. å‚æ•°ç±»å‹æ ¡éªŒ
    if (event.eventParams) {
      for (const [key, value] of Object.entries(event.eventParams)) {
        if (typeof value === 'undefined') {
          return { valid: false, error: `å‚æ•° ${key} ä¸èƒ½ä¸º undefined` };
        }
      }
    }

    return { valid: true };
  }
}

// åç«¯æ ¡éªŒ
// server/src/services/trackingService.ts
async trackEvent(eventData: EventData) {
  // 1. æ£€æŸ¥å¿…è¦å­—æ®µ
  if (!eventData.projectId || !eventData.eventName) {
    throw new Error('Missing required fields');
  }

  // 2. éªŒè¯äº‹ä»¶å®šä¹‰
  const exists = await this.validateEventDefinition(
    eventData.projectId,
    eventData.eventName
  );

  // 3. å‚æ•°æ ¼å¼æ ¡éªŒï¼ˆæ ¹æ® paramsSchemaï¼‰
  const schema = await this.getEventSchema(
    eventData.projectId,
    eventData.eventName
  );
  this.validateParams(eventData.eventParams, schema);
}
```

**3. æ•°æ®ä¸ŠæŠ¥å±‚ï¼š**
```typescript
// æ‰¹é‡ä¸ŠæŠ¥æœºåˆ¶
class BatchReporter {
  private queue: Event[] = [];
  private batchSize: number = 50;
  private flushInterval: number = 5000;

  addEvent(event: Event) {
    // 1. æ ¡éªŒ
    const validation = this.validator.validate(event);
    if (!validation.valid) {
      console.error('äº‹ä»¶æ ¡éªŒå¤±è´¥:', validation.error);
      return;
    }

    // 2. åŠ å…¥é˜Ÿåˆ—
    this.queue.push(event);

    // 3. è¾¾åˆ°æ‰¹é‡å¤§å°æˆ–æ—¶é—´é—´éš”ï¼Œè‡ªåŠ¨ä¸ŠæŠ¥
    if (this.queue.length >= this.batchSize) {
      this.flush();
    }
  }

  async flush() {
    if (this.queue.length === 0) return;

    const eventsToSend = this.queue.splice(0, this.batchSize);

    try {
      await fetch(this.endpoint, {
        method: 'POST',
        body: JSON.stringify({ events: eventsToSend })
      });
    } catch (error) {
      // å¤±è´¥é‡è¯•
      this.queue.unshift(...eventsToSend);
      this.retry();
    }
  }
}
```

**4. åˆ†æå±•ç¤ºå±‚ï¼š**
```typescript
// æ•°æ®èšåˆå’Œå±•ç¤º
class AnalyticsService {
  async getStats(projectId: string, dateRange: [string, string]) {
    // 1. ä»æ•°æ®åº“æŸ¥è¯¢åŸå§‹æ•°æ®
    const rawData = await this.db.query(`
      SELECT * FROM events
      WHERE project_id = ? AND date BETWEEN ? AND ?
    `, [projectId, dateRange[0], dateRange[1]]);

    // 2. æ•°æ®èšåˆ
    const aggregated = this.aggregate(rawData);

    // 3. è¿”å›ç»™å‰ç«¯å±•ç¤º
    return aggregated;
  }

  private aggregate(data: Event[]) {
    // æŒ‰å¤©ã€æŒ‰äº‹ä»¶åˆ†ç»„ç»Ÿè®¡
    const grouped = groupBy(data, ['date', 'eventName']);
    return Object.entries(grouped).map(([key, events]) => ({
      date: key.split('-')[0],
      eventName: key.split('-')[1],
      count: events.length,
      users: new Set(events.map(e => e.userId)).size
    }));
  }
}
```

**æŠ€æœ¯äº®ç‚¹ï¼š**
- å‰åç«¯åŒé‡æ ¡éªŒï¼Œä¿è¯æ•°æ®è´¨é‡
- æ‰¹é‡ä¸ŠæŠ¥å‡å°‘è¯·æ±‚æ¬¡æ•°
- æ•°æ®èšåˆåœ¨åç«¯å®Œæˆï¼Œå‰ç«¯åªè´Ÿè´£å±•ç¤º"

---

### Q2: "æ‰¹é‡ä¸ŠæŠ¥ã€èŠ‚æµã€é˜²æŠ–ç­‰æœºåˆ¶"å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

**å›ç­”è¦ç‚¹ï¼š**

"æˆ‘å®ç°äº†å¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ï¼š

**1. æ‰¹é‡ä¸ŠæŠ¥ï¼š**
```typescript
// äº‹ä»¶é˜Ÿåˆ—ç®¡ç†
class EventQueue {
  private queue: Event[] = [];
  private batchSize: number = 50;
  private flushInterval: number = 5000;
  private timer: NodeJS.Timeout | null = null;

  add(event: Event) {
    this.queue.push(event);

    // è¾¾åˆ°æ‰¹é‡å¤§å°ï¼Œç«‹å³å‘é€
    if (this.queue.length >= this.batchSize) {
      this.flush();
    } else {
      // å¦åˆ™å¯åŠ¨å®šæ—¶å™¨
      this.startTimer();
    }
  }

  private startTimer() {
    if (this.timer) return;

    this.timer = setTimeout(() => {
      this.flush();
      this.timer = null;
    }, this.flushInterval);
  }

  async flush() {
    if (this.queue.length === 0) return;

    const eventsToSend = this.queue.splice(0, this.batchSize);
    
    await fetch(this.endpoint, {
      method: 'POST',
      body: JSON.stringify({ events: eventsToSend })
    });

    // å¦‚æœè¿˜æœ‰å‰©ä½™äº‹ä»¶ï¼Œç»§ç»­å‘é€
    if (this.queue.length > 0) {
      this.flush();
    }
  }
}
```

**2. èŠ‚æµï¼ˆThrottleï¼‰ï¼š**
```typescript
// é™åˆ¶å‡½æ•°æ‰§è¡Œé¢‘ç‡
function throttle<T extends (...args: any[]) => any>(
  func: T,
  delay: number
): T {
  let lastCall = 0;

  return ((...args: any[]) => {
    const now = Date.now();
    if (now - lastCall >= delay) {
      lastCall = now;
      return func(...args);
    }
  }) as T;
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šé™åˆ¶é¡µé¢æ»šåŠ¨äº‹ä»¶çš„è§¦å‘é¢‘ç‡
const handleScroll = throttle(() => {
  sdk.track('page_scroll', { scrollY: window.scrollY });
}, 1000); // æ¯ç§’æœ€å¤šè§¦å‘ä¸€æ¬¡

window.addEventListener('scroll', handleScroll);
```

**3. é˜²æŠ–ï¼ˆDebounceï¼‰ï¼š**
```typescript
// å»¶è¿Ÿæ‰§è¡Œï¼Œå¦‚æœæœŸé—´å†æ¬¡è§¦å‘åˆ™é‡æ–°è®¡æ—¶
function debounce<T extends (...args: any[]) => any>(
  func: T,
  delay: number
): T {
  let timer: NodeJS.Timeout | null = null;

  return ((...args: any[]) => {
    if (timer) {
      clearTimeout(timer);
    }

    timer = setTimeout(() => {
      func(...args);
      timer = null;
    }, delay);
  }) as T;
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šæœç´¢è¾“å…¥æ¡†
const handleSearch = debounce((keyword: string) => {
  sdk.track('search', { keyword });
}, 500); // åœæ­¢è¾“å…¥ 500ms åæ‰è§¦å‘

input.addEventListener('input', (e) => {
  handleSearch(e.target.value);
});
```

**4. ç»„åˆä½¿ç”¨ï¼š**
```typescript
// åœ¨ SDK ä¸­ç»„åˆä½¿ç”¨è¿™äº›æœºåˆ¶
class AnalyticsSDK {
  private queue: EventQueue;
  private throttledFlush: () => void;
  private debouncedSave: () => void;

  constructor() {
    this.queue = new EventQueue();
    
    // èŠ‚æµï¼šé™åˆ¶ flush é¢‘ç‡
    this.throttledFlush = throttle(() => {
      this.queue.flush();
    }, 1000);

    // é˜²æŠ–ï¼šå»¶è¿Ÿä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    this.debouncedSave = debounce(() => {
      this.saveToLocalStorage();
    }, 2000);
  }

  track(eventName: string, params: any) {
    this.queue.add({ eventName, params });
    
    // èŠ‚æµè§¦å‘ä¸ŠæŠ¥
    this.throttledFlush();
    
    // é˜²æŠ–ä¿å­˜åˆ°æœ¬åœ°
    this.debouncedSave();
  }
}
```

**æ€§èƒ½æŒ‡æ ‡ï¼š**
- æ‰¹é‡ä¸ŠæŠ¥ï¼šHTTP è¯·æ±‚å‡å°‘ 98%
- èŠ‚æµï¼šäº‹ä»¶è§¦å‘é¢‘ç‡é™ä½ 90%
- é˜²æŠ–ï¼šä¸å¿…è¦çš„æ“ä½œå‡å°‘ 80%"

---

## ğŸ¯ æ€»ç»“å›ç­”æŠ€å·§

### å›ç­”ç»“æ„å»ºè®®ï¼š
1. **èƒŒæ™¯ä»‹ç»**ï¼ˆ30ç§’ï¼‰ï¼šç®€è¦è¯´æ˜é¡¹ç›®èƒŒæ™¯å’Œç›®æ ‡
2. **æŠ€æœ¯å®ç°**ï¼ˆ2-3åˆ†é’Ÿï¼‰ï¼šè¯¦ç»†è¯´æ˜å®ç°æ–¹æ¡ˆï¼Œç»“åˆä»£ç ç¤ºä¾‹
3. **æŠ€æœ¯äº®ç‚¹**ï¼ˆ30ç§’ï¼‰ï¼šçªå‡ºåˆ›æ–°ç‚¹å’Œä¼˜åŒ–æ•ˆæœ
4. **é‡åˆ°é—®é¢˜**ï¼ˆ1åˆ†é’Ÿï¼‰ï¼šè¯´æ˜é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
5. **é¡¹ç›®æ”¶è·**ï¼ˆ30ç§’ï¼‰ï¼šæ€»ç»“æŠ€æœ¯æ”¶è·å’Œæˆé•¿

### æ³¨æ„äº‹é¡¹ï¼š
- å‡†å¤‡å…·ä½“çš„ä»£ç ç¤ºä¾‹å’Œæ•°æ®æŒ‡æ ‡
- å¼ºè°ƒè§£å†³é—®é¢˜çš„æ€è·¯ï¼Œè€Œéåªæ˜¯å®ç°
- å±•ç¤ºå¯¹æŠ€æœ¯åŸç†çš„æ·±å…¥ç†è§£
- æ‰¿è®¤ä¸è¶³ï¼Œæå‡ºä¼˜åŒ–æ–¹å‘

### å¯èƒ½è¿½é—®çš„é—®é¢˜ï¼š
1. å¦‚æœæ•°æ®é‡æ›´å¤§ï¼ˆåƒä¸‡çº§ï¼‰ï¼Œä½ ä¼šæ€ä¹ˆä¼˜åŒ–ï¼Ÿ
2. å¦‚ä½•ä¿è¯ SDK çš„å…¼å®¹æ€§å’Œç¨³å®šæ€§ï¼Ÿ
3. å¦‚æœ AI æœåŠ¡ä¸å¯ç”¨ï¼Œæœ‰ä»€ä¹ˆé™çº§æ–¹æ¡ˆï¼Ÿ
4. å¦‚ä½•ç›‘æ§ SDK çš„æ€§èƒ½å’Œé”™è¯¯ï¼Ÿ
5. å¦‚ä½•ä¿è¯æ•°æ®ä¸ŠæŠ¥çš„å‡†ç¡®æ€§ï¼Ÿ

---

## ğŸ“š è¡¥å……æŠ€æœ¯ç‚¹

### æ€§èƒ½ä¼˜åŒ–
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- è™šæ‹Ÿæ»šåŠ¨å’Œåˆ†é¡µ
- æ•°æ®ç¼“å­˜å’Œé¢„åŠ è½½
- Web Worker å¤„ç†å¤§æ•°æ®

### é”™è¯¯å¤„ç†
- å…¨å±€é”™è¯¯æ•è·
- é”™è¯¯ä¸ŠæŠ¥æœºåˆ¶
- é™çº§å’Œå®¹é”™æ–¹æ¡ˆ
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### å·¥ç¨‹åŒ–
- TypeScript ç±»å‹å®‰å…¨
- ä»£ç è§„èŒƒå’Œ ESLint
- å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²

