# SDKæ‰¹é‡å‘é€æœºåˆ¶

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **æ‰¹é‡å‘é€**: å°†å¤šä¸ªäº‹ä»¶åˆå¹¶ä¸ºä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼Œå¤§å¹…å‡å°‘ç½‘ç»œå¼€é”€
- **æ™ºèƒ½é˜Ÿåˆ—**: åŸºäºä¼˜å…ˆçº§çš„äº‹ä»¶é˜Ÿåˆ—ç®¡ç†
- **ç¦»çº¿æ”¯æŒ**: ç½‘ç»œæ–­å¼€æ—¶è‡ªåŠ¨å­˜å‚¨äº‹ä»¶åˆ°æœ¬åœ°ï¼Œæ¢å¤åè‡ªåŠ¨å‘é€
- **é‡è¯•æœºåˆ¶**: å‘é€å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼Œæ”¯æŒæŒ‡æ•°é€€é¿
- **æ€§èƒ½ä¼˜åŒ–**: å®šæ—¶åˆ·æ–°ã€é¡µé¢å¸è½½æ—¶å‘é€ã€ç§»åŠ¨ç«¯é¡µé¢éšè—æ—¶å‘é€

### é…ç½®é€‰é¡¹
```typescript
interface BatchConfig {
  maxBatchSize: number;        // æœ€å¤§æ‰¹é‡å¤§å° (é»˜è®¤: 50)
  flushInterval: number;        // åˆ·æ–°é—´éš”æ¯«ç§’ (é»˜è®¤: 5000)
  maxRetries: number;          // æœ€å¤§é‡è¯•æ¬¡æ•° (é»˜è®¤: 3)
  retryDelay: number;          // é‡è¯•å»¶è¿Ÿæ¯«ç§’ (é»˜è®¤: 1000)
  enableOfflineStorage: boolean; // æ˜¯å¦å¯ç”¨ç¦»çº¿å­˜å‚¨ (é»˜è®¤: true)
  maxStorageSize: number;      // æœ€å¤§å­˜å‚¨å¤§å°å­—èŠ‚ (é»˜è®¤: 1MB)
  adaptive?: AdaptiveBatchConfig; // è‡ªé€‚åº”æ‰¹é‡å¤§å°é…ç½®
}

interface AdaptiveBatchConfig {
  enabled: boolean;             // æ˜¯å¦å¯ç”¨è‡ªé€‚åº”æ‰¹é‡å¤§å° (é»˜è®¤: true)
  minBatchSize: number;        // æœ€å°æ‰¹é‡å¤§å° (é»˜è®¤: 10)
  maxBatchSize: number;        // æœ€å¤§æ‰¹é‡å¤§å° (é»˜è®¤: 100)
  initialBatchSize: number;     // åˆå§‹æ‰¹é‡å¤§å° (é»˜è®¤: 50)
  queueLengthWeight: number;    // é˜Ÿåˆ—é•¿åº¦æƒé‡ 0-1 (é»˜è®¤: 0.3)
  networkQualityWeight: number; // ç½‘ç»œè´¨é‡æƒé‡ 0-1 (é»˜è®¤: 0.7)
  adjustmentInterval: number;   // è°ƒæ•´é—´éš”æ¯«ç§’ (é»˜è®¤: 30000)
  networkCheckInterval: number; // ç½‘ç»œæ£€æŸ¥é—´éš”æ¯«ç§’ (é»˜è®¤: 10000)
}
```

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨
```typescript
import AnalyticsSDK from './index';

// ä½¿ç”¨é»˜è®¤é…ç½®
const sdk = AnalyticsSDK.getInstance('your-project-id', 'http://localhost:3000/api/track');

// å‘é€äº‹ä»¶
sdk.track('page_view', { page: '/home' });
```

### 2. è‡ªå®šä¹‰é…ç½®
```typescript
const customSdk = AnalyticsSDK.getInstance('project-id', 'endpoint', {
  maxBatchSize: 20,        // æœ€å¤§æ‰¹é‡20ä¸ªäº‹ä»¶
  flushInterval: 3000,      // 3ç§’åˆ·æ–°ä¸€æ¬¡
  maxRetries: 5,           // æœ€å¤§é‡è¯•5æ¬¡
  retryDelay: 2000,        // é‡è¯•å»¶è¿Ÿ2ç§’
  enableOfflineStorage: true,
  maxStorageSize: 2 * 1024 * 1024, // 2MBå­˜å‚¨
  adaptive: {
    enabled: true,          // å¯ç”¨è‡ªé€‚åº”æ‰¹é‡å¤§å°
    minBatchSize: 5,       // æœ€å°æ‰¹é‡5ä¸ª
    maxBatchSize: 50,      // æœ€å¤§æ‰¹é‡50ä¸ª
    initialBatchSize: 20,  // åˆå§‹æ‰¹é‡20ä¸ª
    queueLengthWeight: 0.4, // é˜Ÿåˆ—é•¿åº¦æƒé‡40%
    networkQualityWeight: 0.6, // ç½‘ç»œè´¨é‡æƒé‡60%
    adjustmentInterval: 20000, // 20ç§’è°ƒæ•´ä¸€æ¬¡
    networkCheckInterval: 5000, // 5ç§’æ£€æŸ¥ä¸€æ¬¡ç½‘ç»œ
  }
});
```

### 3. ä¼˜å…ˆçº§äº‹ä»¶
```typescript
// æ™®é€šä¼˜å…ˆçº§ï¼ˆé»˜è®¤ï¼‰
sdk.track('user_action', { action: 'click' });

// é«˜ä¼˜å…ˆçº§ï¼ˆé”™è¯¯äº‹ä»¶ï¼‰
sdk.track('error', { message: 'Something went wrong' }, 'high');

// ä½ä¼˜å…ˆçº§ï¼ˆéå…³é”®äº‹ä»¶ï¼‰
sdk.track('background_event', { data: 'non-critical' }, 'low');
```

### 4. æ‰‹åŠ¨æ§åˆ¶
```typescript
// ç«‹å³å‘é€æ‰€æœ‰å¾…å‘é€äº‹ä»¶
await sdk.flush();

// è·å–é˜Ÿåˆ—çŠ¶æ€
const status = sdk.getQueueStatus();
console.log('é˜Ÿåˆ—é•¿åº¦:', status.queueLength);
console.log('æ˜¯å¦åœ¨çº¿:', status.isOnline);

// è·å–è‡ªé€‚åº”æ‰¹é‡å¤§å°çŠ¶æ€
const adaptiveStatus = sdk.getAdaptiveBatchStatus();
console.log('å½“å‰æ‰¹é‡å¤§å°:', adaptiveStatus.currentBatchSize);
console.log('ç½‘ç»œè´¨é‡:', adaptiveStatus.networkMetrics?.quality);
console.log('å‘é€æˆåŠŸç‡:', adaptiveStatus.recentSuccessRate);

// è·å–ç½‘ç»œçŠ¶å†µ
const networkMetrics = sdk.getNetworkMetrics();
if (networkMetrics) {
  console.log('ç½‘ç»œRTT:', networkMetrics.rtt, 'ms');
  console.log('ç½‘ç»œå¸¦å®½:', networkMetrics.bandwidth, 'bytes/s');
  console.log('è¿æ¥ç±»å‹:', networkMetrics.connectionType);
}

// æ‰‹åŠ¨è§¦å‘ç½‘ç»œæ£€æµ‹
await sdk.checkNetworkManually();

// æ‰‹åŠ¨è§¦å‘æ‰¹é‡å¤§å°è°ƒæ•´
sdk.adjustBatchSizeManually();

// åŠ¨æ€æ›´æ–°é…ç½®
sdk.updateBatchConfig({
  flushInterval: 10000, // æ”¹ä¸º10ç§’åˆ·æ–°
  maxBatchSize: 100,     // æ”¹ä¸ºæœ€å¤§100ä¸ªäº‹ä»¶
  adaptive: {
    enabled: true,
    minBatchSize: 10,
    maxBatchSize: 100
  }
});
```

## ğŸ”§ åç«¯æ”¯æŒ

### APIç«¯ç‚¹
æ‰¹é‡äº‹ä»¶å‘é€åˆ° `/api/track` ç«¯ç‚¹ï¼Œæ”¯æŒä»¥ä¸‹æ•°æ®æ ¼å¼ï¼š

```typescript
// æ‰¹é‡äº‹ä»¶æ ¼å¼
{
  projectId: string;
  events: EventData[];
  batchSize: number;
  timestamp: number;
  uid?: string;
  deviceInfo: any;
  sdkVersion: string;
}

// å•ä¸ªäº‹ä»¶æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰
{
  projectId: string;
  eventName: string;
  eventParams: any;
  uid?: string;
  deviceInfo: any;
  timestamp: number;
}
```

### å“åº”æ ¼å¼
```typescript
{
  success: boolean;
  processedCount: number;
  failedEvents?: any[]; // å¤±è´¥çš„äº‹ä»¶åˆ—è¡¨
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŠ¿

### ç½‘ç»œè¯·æ±‚å‡å°‘
- **ä¼ ç»Ÿæ–¹å¼**: æ¯ä¸ªäº‹ä»¶1æ¬¡è¯·æ±‚
- **æ‰¹é‡æ–¹å¼**: 50ä¸ªäº‹ä»¶1æ¬¡è¯·æ±‚
- **æ€§èƒ½æå‡**: ç½‘ç»œè¯·æ±‚å‡å°‘98%

### å¸¦å®½èŠ‚çœ
- **å‹ç¼©ä¼ è¾“**: æ‰¹é‡æ•°æ®å¯è¿›è¡Œgzipå‹ç¼©
- **å¤´éƒ¨å¼€é”€**: å‡å°‘HTTPå¤´éƒ¨é‡å¤å¼€é”€
- **è¿æ¥å¤ç”¨**: å‡å°‘TCPè¿æ¥å»ºç«‹å¼€é”€

### ç”¨æˆ·ä½“éªŒ
- **ç¦»çº¿æ”¯æŒ**: ç½‘ç»œæ–­å¼€æ—¶äº‹ä»¶ä¸ä¸¢å¤±
- **åå°å‘é€**: ä¸å½±å“ç”¨æˆ·æ“ä½œæµç•…æ€§
- **æ™ºèƒ½é‡è¯•**: ç½‘ç»œæ¢å¤åè‡ªåŠ¨é‡å‘

## ğŸš€ è‡ªé€‚åº”æ‰¹é‡å¤§å°ç®—æ³•

### æ ¸å¿ƒç‰¹æ€§
- **æ™ºèƒ½è°ƒæ•´**: æ ¹æ®ç½‘ç»œçŠ¶å†µå’Œé˜Ÿåˆ—é•¿åº¦åŠ¨æ€è°ƒæ•´æ‰¹é‡å¤§å°
- **ç½‘ç»œæ„ŸçŸ¥**: å®æ—¶æ£€æµ‹ç½‘ç»œRTTã€å¸¦å®½å’Œè¿æ¥è´¨é‡
- **é˜Ÿåˆ—æ„ŸçŸ¥**: æ ¹æ®é˜Ÿåˆ—é•¿åº¦è‡ªåŠ¨è°ƒæ•´æ‰¹é‡å¤§å°
- **æ€§èƒ½ä¼˜åŒ–**: ç½‘ç»œå¥½æ—¶å¢å¤§æ‰¹é‡ï¼Œç½‘ç»œå·®æ—¶å‡å°æ‰¹é‡

### å·¥ä½œåŸç†

1. **ç½‘ç»œçŠ¶å†µæ£€æµ‹**
   - å®šæœŸæ£€æµ‹ç½‘ç»œRTTï¼ˆå¾€è¿”æ—¶å»¶ï¼‰
   - è·å–è¿æ¥ç±»å‹ï¼ˆ4Gã€3Gã€WiFiç­‰ï¼‰
   - è¯„ä¼°ç½‘ç»œè´¨é‡ï¼ˆexcellent/good/fair/poorï¼‰

2. **æ‰¹é‡å¤§å°è®¡ç®—**
   - åŸºäºç½‘ç»œè´¨é‡ï¼šç½‘ç»œå¥½æ—¶å¢å¤§æ‰¹é‡ï¼Œç½‘ç»œå·®æ—¶å‡å°æ‰¹é‡
   - åŸºäºé˜Ÿåˆ—é•¿åº¦ï¼šé˜Ÿåˆ—é•¿æ—¶å¢å¤§æ‰¹é‡å¿«é€Ÿæ¸…ç©ºï¼Œé˜Ÿåˆ—çŸ­æ—¶å‡å°æ‰¹é‡é™ä½å»¶è¿Ÿ
   - åŸºäºå‘é€æˆåŠŸç‡ï¼šæˆåŠŸç‡é«˜æ—¶é€‚å½“å¢å¤§ï¼ŒæˆåŠŸç‡ä½æ—¶å‡å°
   - åŠ æƒåˆå¹¶ï¼šç½‘ç»œè´¨é‡æƒé‡70%ï¼Œé˜Ÿåˆ—é•¿åº¦æƒé‡30%

3. **å¹³æ»‘è°ƒæ•´**
   - é¿å…æ‰¹é‡å¤§å°å‰§çƒˆå˜åŒ–
   - å˜åŒ–è¶…è¿‡50%æ—¶é‡‡ç”¨å¹³æ»‘è°ƒæ•´ç­–ç•¥
   - ç¡®ä¿æ‰¹é‡å¤§å°åœ¨æœ€å°å’Œæœ€å¤§èŒƒå›´å†…

### ç½‘ç»œè´¨é‡è¯„ä¼°æ ‡å‡†
- **excellent**: RTT < 50ms ä¸”å¸¦å®½ > 5Mbps
- **good**: RTT < 100ms ä¸”å¸¦å®½ > 1Mbps
- **fair**: RTT < 300ms ä¸”å¸¦å®½ > 100KBps
- **poor**: å…¶ä»–æƒ…å†µ

### æ‰¹é‡å¤§å°è°ƒæ•´ç­–ç•¥
- **ç½‘ç»œè´¨é‡ excellent**: æ‰¹é‡å¤§å° Ã— 1.5
- **ç½‘ç»œè´¨é‡ good**: æ‰¹é‡å¤§å° Ã— 1.2
- **ç½‘ç»œè´¨é‡ fair**: æ‰¹é‡å¤§å° Ã— 0.8
- **ç½‘ç»œè´¨é‡ poor**: æ‰¹é‡å¤§å° Ã— 0.5
- **é˜Ÿåˆ—é•¿åº¦ > 100**: æ‰¹é‡å¤§å° = é˜Ÿåˆ—é•¿åº¦ Ã— 0.3ï¼ˆä¸Šé™ä¸ºæœ€å¤§æ‰¹é‡ï¼‰
- **é˜Ÿåˆ—é•¿åº¦ < 20**: æ‰¹é‡å¤§å° = é˜Ÿåˆ—é•¿åº¦ Ã— 0.5ï¼ˆä¸‹é™ä¸ºæœ€å°æ‰¹é‡ï¼‰

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•
```typescript
import { batchTester } from './test';

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
await batchTester.runAllTests();

// æ¸…ç†æµ‹è¯•æ•°æ®
batchTester.cleanup();
```

### æµ‹è¯•è¦†ç›–
- âœ… åŸºæœ¬æ‰¹é‡å‘é€
- âœ… ä¼˜å…ˆçº§å¤„ç†
- âœ… ç¦»çº¿å­˜å‚¨
- âœ… é‡è¯•æœºåˆ¶
- âœ… æ€§èƒ½æµ‹è¯•

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¸€è‡´æ€§
- æ‰¹é‡å‘é€ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- éƒ¨åˆ†å¤±è´¥æ—¶ä¼šè¿”å›å¤±è´¥äº‹ä»¶åˆ—è¡¨
- å»ºè®®ç›‘æ§å¤±è´¥äº‹ä»¶å¹¶å¤„ç†

### 2. å­˜å‚¨é™åˆ¶
- ç¦»çº¿å­˜å‚¨æœ‰å¤§å°é™åˆ¶ï¼Œè¶…å‡ºä¼šåˆ é™¤æ—§äº‹ä»¶
- å»ºè®®æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ `maxStorageSize`
- å®šæœŸæ¸…ç†ä¸éœ€è¦çš„ç¦»çº¿æ•°æ®

### 3. ç½‘ç»œç¯å¢ƒ
- åœ¨å¼±ç½‘ç¯å¢ƒä¸‹å»ºè®®å¢åŠ  `flushInterval`
- ç§»åŠ¨ç«¯å»ºè®®å¯ç”¨é¡µé¢éšè—æ—¶å‘é€
- è€ƒè™‘ä½¿ç”¨Service Workerè¿›è¡Œåå°å‘é€

### 4. é”™è¯¯å¤„ç†
- ç›‘æ§SDKé”™è¯¯æ—¥å¿—
- è®¾ç½®åˆç†çš„é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿ
- è€ƒè™‘å®ç°é™çº§ç­–ç•¥

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»
1. æ›´æ–°SDKåˆå§‹åŒ–ä»£ç 
2. åç«¯æ·»åŠ æ‰¹é‡å¤„ç†æ”¯æŒ
3. æµ‹è¯•æ‰¹é‡å‘é€åŠŸèƒ½
4. ç›‘æ§æ€§èƒ½æŒ‡æ ‡

### å‘åå…¼å®¹
- æ—§çš„å•ä¸ªäº‹ä»¶å‘é€æ–¹å¼ä»ç„¶æ”¯æŒ
- å¯ä»¥é€æ­¥è¿ç§»åˆ°æ‰¹é‡å‘é€
- ä¸å½±å“ç°æœ‰åŠŸèƒ½

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡
- é˜Ÿåˆ—é•¿åº¦
- æ‰¹é‡å‘é€æˆåŠŸç‡
- å¹³å‡æ‰¹é‡å¤§å°
- ç¦»çº¿äº‹ä»¶æ•°é‡
- é‡è¯•æ¬¡æ•°

### å»ºè®®ç›‘æ§
```typescript
// å®šæœŸæ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
setInterval(() => {
  const status = sdk.getQueueStatus();
  console.log('SDKçŠ¶æ€:', status);
}, 30000);
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **åˆç†è®¾ç½®æ‰¹é‡å¤§å°**: æ ¹æ®ç½‘ç»œç¯å¢ƒå’Œä¸šåŠ¡éœ€æ±‚è°ƒæ•´
2. **ç›‘æ§é˜Ÿåˆ—çŠ¶æ€**: å®šæœŸæ£€æŸ¥é˜Ÿåˆ—é•¿åº¦å’Œå‘é€çŠ¶æ€
3. **å¤„ç†å¤±è´¥äº‹ä»¶**: å®ç°å¤±è´¥äº‹ä»¶çš„é‡æ–°å‘é€æœºåˆ¶
4. **ä¼˜åŒ–å­˜å‚¨ç­–ç•¥**: æ ¹æ®è®¾å¤‡å­˜å‚¨èƒ½åŠ›è°ƒæ•´ç¦»çº¿å­˜å‚¨å¤§å°
5. **æµ‹è¯•ç½‘ç»œç¯å¢ƒ**: åœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸‹æµ‹è¯•SDKè¡¨ç°
