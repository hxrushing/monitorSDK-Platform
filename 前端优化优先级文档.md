# å‰ç«¯ä¼˜åŒ–ä¼˜å…ˆçº§æ–‡æ¡£

> åŸºäºå½“å‰é¡¹ç›®ä»£ç åˆ†æï¼ŒæŒ‰ä¼˜å…ˆçº§å’Œå½±å“èŒƒå›´æ•´ç†çš„ä¼˜åŒ–å»ºè®®

## ğŸ“Š é¡¹ç›®ç°çŠ¶åˆ†æ

### âœ… å·²å®Œæˆçš„ä¼˜åŒ–
- âœ… è·¯ç”±ä»£ç åˆ†å‰²ï¼ˆReact.lazyï¼‰
- âœ… å›¾è¡¨åº“æ‡’åŠ è½½ï¼ˆ@ant-design/plotsï¼‰
- âœ… Viteæ„å»ºä¼˜åŒ–ï¼ˆæ‰‹åŠ¨åˆ†åŒ…ã€ä»£ç å‹ç¼©ï¼‰
- âœ… é”™è¯¯è¾¹ç•Œï¼ˆå…¨å±€ + è·¯ç”±çº§åˆ«ï¼‰
- âœ… åŠ è½½çŠ¶æ€ä¼˜åŒ–ï¼ˆå¤šç§Loadingç»„ä»¶ï¼‰
- âœ… è¯·æ±‚å°è£…ï¼ˆuseRequest Hookï¼Œæ”¯æŒç¼“å­˜ã€å»é‡ï¼‰
- âœ… é˜²æŠ–Hookï¼ˆuseDebounceï¼‰
- âœ… å›¾ç‰‡ä¼˜åŒ–ç»„ä»¶ï¼ˆOptimizedImageï¼‰
- âœ… èµ„æºé¢„åŠ è½½ï¼ˆPreloadResourcesï¼‰
- âœ… æ•°æ®é‡‡æ ·ä¼˜åŒ–ï¼ˆadaptiveChartSamplingï¼‰

### âš ï¸ å‘ç°çš„é—®é¢˜
- 132ä¸ª console.log/error/warnï¼ˆç”Ÿäº§ç¯å¢ƒåº”ç§»é™¤ï¼‰
- ç¼ºå°‘ React.memo ä¼˜åŒ–ï¼ˆç»„ä»¶é‡æ¸²æŸ“ï¼‰
- ç¼ºå°‘è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§æ•°æ®åˆ—è¡¨æ€§èƒ½ï¼‰
- ç¼ºå°‘ Service Workerï¼ˆç¦»çº¿æ”¯æŒï¼‰
- ç¼ºå°‘æ€§èƒ½ç›‘æ§å’Œé”™è¯¯ä¸ŠæŠ¥
- ç¼ºå°‘è¯·æ±‚é‡è¯•æœºåˆ¶
- ç¼ºå°‘ Web Workersï¼ˆå¤§æ•°æ®å¤„ç†ï¼‰
- ç¼ºå°‘ IndexedDB ç¼“å­˜ï¼ˆç¦»çº¿æ•°æ®ï¼‰

---

## ğŸš€ é«˜ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆP0 - ç«‹å³å®æ–½ï¼‰

### 1. ç§»é™¤ç”Ÿäº§ç¯å¢ƒ console è¯­å¥ âœ… å·²å®Œæˆ

**ä¼˜å…ˆçº§**: P0  
**å½±å“**: æ€§èƒ½ã€å®‰å…¨æ€§  
**å·¥ä½œé‡**: 1-2å°æ—¶  
**æ”¶ç›Š**: å‡å°‘åŒ…ä½“ç§¯ï¼Œæå‡æ€§èƒ½ï¼Œé¿å…ä¿¡æ¯æ³„éœ²  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

**é—®é¢˜**ï¼š
- é¡¹ç›®ä¸­å­˜åœ¨ 132 ä¸ª console è¯­å¥
- ç”Ÿäº§ç¯å¢ƒä¸åº”æš´éœ²è°ƒè¯•ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// vite.config.ts
build: {
  minify: 'terser',
  terserOptions: {
    compress: {
      drop_console: true,        // ç§»é™¤æ‰€æœ‰ console
      drop_debugger: true,       // ç§»é™¤ debugger
      pure_funcs: ['console.log', 'console.info'], // åªç§»é™¤ç‰¹å®šå‡½æ•°
    }
  }
}
```

**æˆ–è€…ä½¿ç”¨æ’ä»¶**ï¼š
```bash
pnpm add -D vite-plugin-remove-console
```

```typescript
// vite.config.ts
import removeConsole from 'vite-plugin-remove-console'

export default defineConfig({
  plugins: [
    react(),
    removeConsole({ includes: ['log', 'warn', 'error', 'info'] })
  ]
})
```

**å®æ–½ä½ç½®**ï¼š
- âœ… `vite.config.ts` - å·²æ›´æ–°æ„å»ºé…ç½®
- âœ… `package.json` - å·²æ·»åŠ  vite-plugin-remove-console ä¾èµ–
- âœ… `ç§»é™¤consoleä¼˜åŒ–è¯´æ˜.md` - è¯¦ç»†è¯´æ˜æ–‡æ¡£

**å®Œæˆæƒ…å†µ**ï¼š
- âœ… å·²å®‰è£… vite-plugin-remove-console æ’ä»¶
- âœ… å·²é…ç½®ç§»é™¤ console.log/info/debug/trace
- âœ… å·²ä¿ç•™ console.error/warn ç”¨äºé”™è¯¯è¿½è¸ª
- âœ… é…ç½®ä»…åœ¨ç”Ÿäº§ç¯å¢ƒç”Ÿæ•ˆï¼Œå¼€å‘ç¯å¢ƒä¸å—å½±å“

**éªŒè¯æ–¹æ³•**ï¼š
1. è¿è¡Œ `pnpm run build` æ„å»ºç”Ÿäº§ç‰ˆæœ¬
2. æ£€æŸ¥ `dist/js/*.js` æ–‡ä»¶ï¼Œåº”è¯¥æ‰¾ä¸åˆ° console.log ç­‰è¯­å¥
3. ä½†å¯ä»¥æ‰¾åˆ° console.error å’Œ console.warnï¼ˆå·²ä¿ç•™ï¼‰

**è¯¦ç»†è¯´æ˜**ï¼šè¯·æŸ¥çœ‹ `ç§»é™¤consoleä¼˜åŒ–è¯´æ˜.md` æ–‡ä»¶

---

### 2. ä½¿ç”¨ React.memo ä¼˜åŒ–ç»„ä»¶é‡æ¸²æŸ“

**ä¼˜å…ˆçº§**: P0  
**å½±å“**: æ€§èƒ½ï¼ˆæ¸²æŸ“ä¼˜åŒ–ï¼‰  
**å·¥ä½œé‡**: 2-4å°æ—¶  
**æ”¶ç›Š**: å‡å°‘ 30-50% ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Œæå‡äº¤äº’æµç•…åº¦

**é—®é¢˜**ï¼š
- çº¯å±•ç¤ºç»„ä»¶åœ¨çˆ¶ç»„ä»¶æ›´æ–°æ—¶é¢‘ç¹é‡æ¸²æŸ“
- åˆ—è¡¨é¡¹ç»„ä»¶åœ¨æ•°æ®æ›´æ–°æ—¶å…¨éƒ¨é‡æ¸²æŸ“

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 2.1 ä¼˜åŒ–ç»Ÿè®¡å¡ç‰‡ç»„ä»¶
```typescript
// src/components/StatisticCard.tsx (æ–°å»º)
import React, { memo } from 'react';
import { Card, Statistic } from 'antd';

interface StatisticCardProps {
  title: string;
  value: number | string;
  suffix?: string;
  prefix?: React.ReactNode;
  icon?: React.ReactNode;
  loading?: boolean;
}

const StatisticCard: React.FC<StatisticCardProps> = memo(({
  title,
  value,
  suffix,
  prefix,
  icon,
  loading
}) => {
  return (
    <Card>
      <Statistic
        title={title}
        value={value}
        suffix={suffix}
        prefix={prefix || icon}
        loading={loading}
      />
    </Card>
  );
}, (prevProps, nextProps) => {
  // è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œåªæœ‰å…³é”®å±æ€§å˜åŒ–æ—¶æ‰é‡æ¸²æŸ“
  return (
    prevProps.value === nextProps.value &&
    prevProps.title === nextProps.title &&
    prevProps.loading === nextProps.loading
  );
});

StatisticCard.displayName = 'StatisticCard';
export default StatisticCard;
```

#### 2.2 ä¼˜åŒ–è¡¨æ ¼è¡Œç»„ä»¶
```typescript
// åœ¨è¡¨æ ¼ä¸­ä½¿ç”¨ rowRender ä¼˜åŒ–
<Table
  dataSource={data}
  columns={columns}
  rowRender={(record, index) => (
    <MemoizedTableRow key={record.id} record={record} />
  )}
/>
```

**å®æ–½ä½ç½®**ï¼š
- `src/components/StatisticCard.tsx` - æ–°å»ºç»Ÿè®¡å¡ç‰‡ç»„ä»¶
- `src/pages/Dashboard/index.tsx` - ä½¿ç”¨ä¼˜åŒ–åçš„ç»„ä»¶
- `src/pages/EventAnalysis/index.tsx` - ä¼˜åŒ–è¡¨æ ¼è¡Œ
- `src/pages/PredictionHistory/index.tsx` - ä¼˜åŒ–è¡¨æ ¼è¡Œ

---

### 3. å®ç°è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§æ•°æ®åˆ—è¡¨ï¼‰

**ä¼˜å…ˆçº§**: P0  
**å½±å“**: æ€§èƒ½ï¼ˆå¤§æ•°æ®æ¸²æŸ“ï¼‰  
**å·¥ä½œé‡**: 4-6å°æ—¶  
**æ”¶ç›Š**: æ”¯æŒæ¸²æŸ“ 10ä¸‡+ æ¡æ•°æ®ï¼Œå†…å­˜å ç”¨é™ä½ 90%+

**é—®é¢˜**ï¼š
- è¡¨æ ¼å’Œåˆ—è¡¨åœ¨æ•°æ®é‡å¤§æ—¶æ€§èƒ½å·®
- å½“å‰ä½¿ç”¨ `scroll={{ y: 500 }}` ä½†æœªå¯ç”¨è™šæ‹Ÿæ»šåŠ¨
- é¢„æµ‹è®°å½•ã€äº‹ä»¶æ˜ç»†ç­‰é¡µé¢å¯èƒ½é¢ä¸´å¤§æ•°æ®é‡

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 3.1 ä½¿ç”¨ Ant Design Table è™šæ‹Ÿæ»šåŠ¨
```typescript
// src/pages/PredictionHistory/index.tsx
<Table
  dataSource={records}
  columns={columns}
  rowKey="id"
  loading={loading}
  scroll={{ y: 500, x: 'max-content' }}
  virtual={true}  // å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
  pagination={{
    current: page,
    pageSize: pageSize,
    total: total,
    showSizeChanger: true,
    showTotal: (total) => `å…± ${total} æ¡è®°å½•`,
    onChange: (page, pageSize) => {
      setPage(page);
      setPageSize(pageSize);
    },
  }}
/>
```

#### 3.2 è‡ªå®šä¹‰è™šæ‹Ÿåˆ—è¡¨ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
```typescript
// src/components/VirtualList.tsx (æ–°å»º)
import { FixedSizeList as List } from 'react-window';

interface VirtualListProps<T> {
  items: T[];
  height: number;
  itemHeight: number;
  renderItem: (item: T, index: number) => React.ReactNode;
}

export function VirtualList<T>({ items, height, itemHeight, renderItem }: VirtualListProps<T>) {
  return (
    <List
      height={height}
      itemCount={items.length}
      itemSize={itemHeight}
      width="100%"
    >
      {({ index, style }) => (
        <div style={style}>
          {renderItem(items[index], index)}
        </div>
      )}
    </List>
  );
}
```

**ä¾èµ–å®‰è£…**ï¼š
```bash
# Ant Design 5.x å·²å†…ç½®è™šæ‹Ÿæ»šåŠ¨ï¼Œæ— éœ€é¢å¤–ä¾èµ–
# å¦‚éœ€è‡ªå®šä¹‰ï¼Œå¯å®‰è£… react-window
pnpm add react-window @types/react-window
```

**å®æ–½ä½ç½®**ï¼š
- `src/pages/PredictionHistory/index.tsx` - å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
- `src/pages/EventAnalysis/index.tsx` - å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
- `src/pages/EventManagement/index.tsx` - å¯ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚éœ€è¦ï¼‰

---

### 4. æ·»åŠ è¯·æ±‚é‡è¯•æœºåˆ¶

**ä¼˜å…ˆçº§**: P0  
**å½±å“**: ç”¨æˆ·ä½“éªŒã€ç¨³å®šæ€§  
**å·¥ä½œé‡**: 2-3å°æ—¶  
**æ”¶ç›Š**: ç½‘ç»œæ³¢åŠ¨æ—¶è‡ªåŠ¨é‡è¯•ï¼Œå‡å°‘ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°

**é—®é¢˜**ï¼š
- ç½‘ç»œæ³¢åŠ¨å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨é‡è¯•
- é•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚ï¼ˆAIæ€»ç»“ã€é¢„æµ‹ï¼‰å¤±è´¥åæ— è‡ªåŠ¨æ¢å¤

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 4.1 æ‰©å±• useRequest Hook
```typescript
// src/hooks/useRequest.ts
export interface UseRequestOptions<T> {
  // ... ç°æœ‰é€‰é¡¹
  /** é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤0ï¼‰ */
  retryCount?: number;
  /** é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼Œé»˜è®¤1000ï¼‰ */
  retryDelay?: number;
  /** é‡è¯•æ¡ä»¶å‡½æ•° */
  retryWhen?: (error: Error) => boolean;
}

export function useRequest<T = any>(
  requestFn: (...args: any[]) => Promise<T>,
  options: UseRequestOptions<T> = {}
): UseRequestResult<T> {
  const {
    retryCount = 0,
    retryDelay = 1000,
    retryWhen = (error) => {
      // é»˜è®¤åªå¯¹ç½‘ç»œé”™è¯¯é‡è¯•
      return error.message.includes('Network') || 
             error.message.includes('timeout') ||
             error?.response?.status >= 500;
    },
    // ... å…¶ä»–é€‰é¡¹
  } = options;

  const run = useCallback(async (...args: any[]): Promise<T | undefined> => {
    let lastError: Error | null = null;
    
    for (let attempt = 0; attempt <= retryCount; attempt++) {
      try {
        if (attempt > 0) {
          // ç­‰å¾…é‡è¯•å»¶è¿Ÿ
          await new Promise(resolve => setTimeout(resolve, retryDelay * attempt));
        }
        
        const result = await requestFn(...args);
        return result;
      } catch (err) {
        lastError = err instanceof Error ? err : new Error(String(err));
        
        // æ£€æŸ¥æ˜¯å¦åº”è¯¥é‡è¯•
        if (attempt < retryCount && retryWhen(lastError)) {
          continue; // ç»§ç»­é‡è¯•
        }
        
        throw lastError; // ä¸å†é‡è¯•ï¼ŒæŠ›å‡ºé”™è¯¯
      }
    }
    
    throw lastError;
  }, [requestFn, retryCount, retryDelay, retryWhen]);

  // ... å…¶ä½™ä»£ç 
}
```

#### 4.2 åœ¨å…³é”®APIä¸­ä½¿ç”¨
```typescript
// src/pages/Dashboard/index.tsx
const { data: statsData, loading, error, run } = useRequest(
  () => apiService.getStats({
    projectId: selectedProjectId,
    startDate,
    endDate
  }),
  {
    retryCount: 3,
    retryDelay: 1000,
    retryWhen: (error) => error?.response?.status >= 500
  }
);
```

**å®æ–½ä½ç½®**ï¼š
- `src/hooks/useRequest.ts` - æ·»åŠ é‡è¯•é€»è¾‘
- `src/services/api.ts` - å…³é”®APIè°ƒç”¨å¤„ä½¿ç”¨é‡è¯•

---

## âš¡ ä¸­é«˜ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆP1 - è¿‘æœŸå®æ–½ï¼‰

### 5. æ·»åŠ æ€§èƒ½ç›‘æ§ï¼ˆWeb Vitalsï¼‰

**ä¼˜å…ˆçº§**: P1  
**å½±å“**: å¯è§‚æµ‹æ€§ã€æ€§èƒ½ä¼˜åŒ–  
**å·¥ä½œé‡**: 3-4å°æ—¶  
**æ”¶ç›Š**: å®æ—¶äº†è§£åº”ç”¨æ€§èƒ½ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 5.1 å®‰è£…ä¾èµ–
```bash
pnpm add web-vitals
```

#### 5.2 åˆ›å»ºæ€§èƒ½ç›‘æ§å·¥å…·
```typescript
// src/utils/performance.ts (æ–°å»º)
import { onCLS, onFID, onFCP, onLCP, onTTFB, onINP } from 'web-vitals';

interface Metric {
  name: string;
  value: number;
  rating: 'good' | 'needs-improvement' | 'poor';
  delta: number;
  id: string;
}

type ReportHandler = (metric: Metric) => void;

// å‘é€åˆ°åˆ†ææœåŠ¡
function sendToAnalytics(metric: Metric) {
  // å‘é€åˆ°åç«¯API
  if (process.env.NODE_ENV === 'production') {
    fetch('/api/analytics/performance', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        name: metric.name,
        value: metric.value,
        rating: metric.rating,
        url: window.location.href,
        timestamp: Date.now()
      })
    }).catch(console.error);
  } else {
    console.log('[Performance]', metric);
  }
}

// æ³¨å†Œæ‰€æœ‰ Web Vitals
export function reportWebVitals(onPerfEntry?: ReportHandler) {
  if (onPerfEntry && onPerfEntry instanceof Function) {
    onCLS(onPerfEntry);
    onFID(onPerfEntry);
    onFCP(onPerfEntry);
    onLCP(onPerfEntry);
    onTTFB(onPerfEntry);
    onINP(onPerfEntry);
  }
  
  // åŒæ—¶å‘é€åˆ°åˆ†ææœåŠ¡
  onCLS(sendToAnalytics);
  onFID(sendToAnalytics);
  onFCP(sendToAnalytics);
  onLCP(sendToAnalytics);
  onTTFB(sendToAnalytics);
  onINP(sendToAnalytics);
}
```

#### 5.3 åœ¨åº”ç”¨å…¥å£ä½¿ç”¨
```typescript
// src/main.tsx
import { reportWebVitals } from '@/utils/performance';

// ... ç°æœ‰ä»£ç 

// æ€§èƒ½ç›‘æ§
reportWebVitals();
```

**å®æ–½ä½ç½®**ï¼š
- `src/utils/performance.ts` - æ–°å»ºæ€§èƒ½ç›‘æ§å·¥å…·
- `src/main.tsx` - å¯ç”¨æ€§èƒ½ç›‘æ§
- `server/src/routes/api.ts` - æ·»åŠ æ€§èƒ½æ•°æ®æ¥æ”¶æ¥å£ï¼ˆå¯é€‰ï¼‰

---

### 6. æ·»åŠ é”™è¯¯ä¸ŠæŠ¥æœºåˆ¶

**ä¼˜å…ˆçº§**: P1  
**å½±å“**: å¯è§‚æµ‹æ€§ã€é—®é¢˜æ’æŸ¥  
**å·¥ä½œé‡**: 2-3å°æ—¶  
**æ”¶ç›Š**: å¿«é€Ÿå‘ç°å’Œå®šä½ç”Ÿäº§ç¯å¢ƒé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 6.1 åˆ›å»ºé”™è¯¯ä¸ŠæŠ¥å·¥å…·
```typescript
// src/utils/errorReporter.ts (æ–°å»º)
interface ErrorInfo {
  message: string;
  stack?: string;
  componentStack?: string;
  url: string;
  userAgent: string;
  timestamp: number;
  userId?: string;
  projectId?: string;
}

export class ErrorReporter {
  private static queue: ErrorInfo[] = [];
  private static isOnline = navigator.onLine;

  static init() {
    // ç›‘å¬ç½‘ç»œçŠ¶æ€
    window.addEventListener('online', () => {
      this.isOnline = true;
      this.flush();
    });
    window.addEventListener('offline', () => {
      this.isOnline = false;
    });

    // ç›‘å¬æœªæ•è·çš„é”™è¯¯
    window.addEventListener('error', (event) => {
      this.report({
        message: event.message,
        stack: event.error?.stack,
        url: event.filename,
        userAgent: navigator.userAgent,
        timestamp: Date.now(),
      });
    });

    // ç›‘å¬æœªå¤„ç†çš„ Promise æ‹’ç»
    window.addEventListener('unhandledrejection', (event) => {
      this.report({
        message: `Unhandled Promise Rejection: ${event.reason}`,
        stack: event.reason?.stack,
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now(),
      });
    });
  }

  static report(error: Partial<ErrorInfo>) {
    const errorInfo: ErrorInfo = {
      message: error.message || 'Unknown error',
      stack: error.stack,
      componentStack: error.componentStack,
      url: error.url || window.location.href,
      userAgent: navigator.userAgent,
      timestamp: Date.now(),
      userId: localStorage.getItem('userId') || undefined,
      projectId: localStorage.getItem('selectedProjectId') || undefined,
    };

    this.queue.push(errorInfo);

    if (this.isOnline) {
      this.flush();
    }
  }

  private static async flush() {
    if (!this.isOnline || this.queue.length === 0) {
      return;
    }

    const errors = [...this.queue];
    this.queue = [];

    try {
      await fetch('/api/errors/report', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ errors }),
      });
    } catch (error) {
      // å‘é€å¤±è´¥ï¼Œé‡æ–°åŠ å…¥é˜Ÿåˆ—
      this.queue.unshift(...errors);
    }
  }
}
```

#### 6.2 åœ¨ ErrorBoundary ä¸­ä½¿ç”¨
```typescript
// src/components/ErrorBoundary.tsx
import { ErrorReporter } from '@/utils/errorReporter';

componentDidCatch(error: Error, errorInfo: ErrorInfo) {
  ErrorReporter.report({
    message: error.message,
    stack: error.stack,
    componentStack: errorInfo.componentStack,
  });
  
  // ... ç°æœ‰é”™è¯¯å¤„ç†é€»è¾‘
}
```

**å®æ–½ä½ç½®**ï¼š
- `src/utils/errorReporter.ts` - æ–°å»ºé”™è¯¯ä¸ŠæŠ¥å·¥å…·
- `src/main.tsx` - åˆå§‹åŒ–é”™è¯¯ä¸ŠæŠ¥
- `src/components/ErrorBoundary.tsx` - é›†æˆé”™è¯¯ä¸ŠæŠ¥
- `server/src/routes/api.ts` - æ·»åŠ é”™è¯¯æ¥æ”¶æ¥å£ï¼ˆå¯é€‰ï¼‰

---

### 7. ä½¿ç”¨ Web Workers å¤„ç†å¤§æ•°æ®

**ä¼˜å…ˆçº§**: P1  
**å½±å“**: æ€§èƒ½ï¼ˆä¸»çº¿ç¨‹ä¼˜åŒ–ï¼‰  
**å·¥ä½œé‡**: 4-6å°æ—¶  
**æ”¶ç›Š**: å¤§æ•°æ®å¤„ç†ä¸é˜»å¡UIï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**é—®é¢˜**ï¼š
- æ•°æ®é‡‡æ ·ã€æ•°æ®è½¬æ¢ç­‰è®¡ç®—å¯†é›†å‹æ“ä½œåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
- å¤§æ•°æ®é‡æ—¶å¯èƒ½å¯¼è‡´é¡µé¢å¡é¡¿

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 7.1 åˆ›å»ºæ•°æ®é‡‡æ · Worker
```typescript
// src/workers/dataSampling.worker.ts (æ–°å»º)
import { lttbSampling } from '../utils/dataSampling';

self.onmessage = (event: MessageEvent) => {
  const { data, maxPoints, type } = event.data;
  
  try {
    const result = lttbSampling(data, maxPoints);
    self.postMessage({ success: true, result });
  } catch (error) {
    self.postMessage({ 
      success: false, 
      error: error instanceof Error ? error.message : 'Unknown error' 
    });
  }
};
```

#### 7.2 åˆ›å»º Worker Hook
```typescript
// src/hooks/useWorker.ts (æ–°å»º)
import { useEffect, useRef, useState } from 'react';

export function useWorker<T = any, R = any>(
  workerPath: string,
  onMessage?: (result: R) => void
) {
  const workerRef = useRef<Worker | null>(null);
  const [isProcessing, setIsProcessing] = useState(false);

  useEffect(() => {
    workerRef.current = new Worker(
      new URL(workerPath, import.meta.url),
      { type: 'module' }
    );

    workerRef.current.onmessage = (event: MessageEvent) => {
      setIsProcessing(false);
      if (event.data.success) {
        onMessage?.(event.data.result);
      }
    };

    workerRef.current.onerror = (error) => {
      setIsProcessing(false);
      console.error('Worker error:', error);
    };

    return () => {
      workerRef.current?.terminate();
    };
  }, [workerPath, onMessage]);

  const postMessage = (data: T) => {
    if (workerRef.current) {
      setIsProcessing(true);
      workerRef.current.postMessage(data);
    }
  };

  return { postMessage, isProcessing };
}
```

#### 7.3 åœ¨ Dashboard ä¸­ä½¿ç”¨
```typescript
// src/pages/Dashboard/index.tsx
import { useWorker } from '@/hooks/useWorker';

const Dashboard: React.FC = () => {
  const { postMessage: sampleData, isProcessing: isSampling } = useWorker(
    '@/workers/dataSampling.worker.ts',
    (result) => {
      setSampledData(result);
    }
  );

  useEffect(() => {
    if (statsData.length > 1000) {
      sampleData({ data: statsData, maxPoints: 500, type: 'lttb' });
    }
  }, [statsData]);
};
```

**å®æ–½ä½ç½®**ï¼š
- `src/workers/dataSampling.worker.ts` - æ–°å»ºWorker
- `src/hooks/useWorker.ts` - æ–°å»ºWorker Hook
- `src/pages/Dashboard/index.tsx` - ä½¿ç”¨Workerå¤„ç†æ•°æ®

---

### 8. å®ç° IndexedDB ç¼“å­˜

**ä¼˜å…ˆçº§**: P1  
**å½±å“**: æ€§èƒ½ã€ç¦»çº¿æ”¯æŒ  
**å·¥ä½œé‡**: 4-5å°æ—¶  
**æ”¶ç›Š**: ç¦»çº¿è®¿é—®å†å²æ•°æ®ï¼Œå‡å°‘é‡å¤è¯·æ±‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 8.1 åˆ›å»º IndexedDB å·¥å…·
```typescript
// src/utils/indexedDB.ts (æ–°å»º)
interface CacheItem<T> {
  key: string;
  data: T;
  timestamp: number;
  expiresAt?: number;
}

class IndexedDBCache {
  private dbName = 'analytics-cache';
  private version = 1;
  private db: IDBDatabase | null = null;

  async init(): Promise<void> {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.dbName, this.version);

      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        this.db = request.result;
        resolve();
      };

      request.onupgradeneeded = (event) => {
        const db = (event.target as IDBOpenDBRequest).result;
        if (!db.objectStoreNames.contains('cache')) {
          db.createObjectStore('cache', { keyPath: 'key' });
        }
      };
    });
  }

  async set<T>(key: string, data: T, ttl?: number): Promise<void> {
    if (!this.db) await this.init();

    const item: CacheItem<T> = {
      key,
      data,
      timestamp: Date.now(),
      expiresAt: ttl ? Date.now() + ttl : undefined,
    };

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction(['cache'], 'readwrite');
      const store = transaction.objectStore('cache');
      const request = store.put(item);

      request.onsuccess = () => resolve();
      request.onerror = () => reject(request.error);
    });
  }

  async get<T>(key: string): Promise<T | null> {
    if (!this.db) await this.init();

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction(['cache'], 'readonly');
      const store = transaction.objectStore('cache');
      const request = store.get(key);

      request.onsuccess = () => {
        const item = request.result as CacheItem<T> | undefined;
        if (!item) {
          resolve(null);
          return;
        }

        // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        if (item.expiresAt && Date.now() > item.expiresAt) {
          this.delete(key);
          resolve(null);
          return;
        }

        resolve(item.data);
      };

      request.onerror = () => reject(request.error);
    });
  }

  async delete(key: string): Promise<void> {
    if (!this.db) await this.init();

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction(['cache'], 'readwrite');
      const store = transaction.objectStore('cache');
      const request = store.delete(key);

      request.onsuccess = () => resolve();
      request.onerror = () => reject(request.error);
    });
  }

  async clear(): Promise<void> {
    if (!this.db) await this.init();

    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction(['cache'], 'readwrite');
      const store = transaction.objectStore('cache');
      const request = store.clear();

      request.onsuccess = () => resolve();
      request.onerror = () => reject(request.error);
    });
  }
}

export const cacheDB = new IndexedDBCache();
```

#### 8.2 åœ¨ useRequest ä¸­é›†æˆ
```typescript
// src/hooks/useRequest.ts
import { cacheDB } from '@/utils/indexedDB';

export function useRequest<T = any>(
  requestFn: (...args: any[]) => Promise<T>,
  options: UseRequestOptions<T> = {}
): UseRequestResult<T> {
  const { cacheTime = 0, cacheKey: customCacheKey } = options;

  const run = useCallback(async (...args: any[]): Promise<T | undefined> => {
    // æ£€æŸ¥ IndexedDB ç¼“å­˜
    if (cacheTime > 0) {
      const key = customCacheKey || getCacheKey(...args);
      const cached = await cacheDB.get<T>(key);
      if (cached) {
        setData(cached);
        return cached;
      }
    }

    // æ‰§è¡Œè¯·æ±‚
    const result = await requestFn(...args);

    // ä¿å­˜åˆ° IndexedDB
    if (cacheTime > 0) {
      const key = customCacheKey || getCacheKey(...args);
      await cacheDB.set(key, result, cacheTime);
    }

    return result;
  }, [requestFn, cacheTime, customCacheKey]);
}
```

**å®æ–½ä½ç½®**ï¼š
- `src/utils/indexedDB.ts` - æ–°å»ºIndexedDBå·¥å…·
- `src/hooks/useRequest.ts` - é›†æˆIndexedDBç¼“å­˜
- `src/main.tsx` - åˆå§‹åŒ–IndexedDB

---

## ğŸ“ˆ ä¸­ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆP2 - è®¡åˆ’å®æ–½ï¼‰

### 9. æ·»åŠ  Service Workerï¼ˆPWAæ”¯æŒï¼‰

**ä¼˜å…ˆçº§**: P2  
**å½±å“**: ç¦»çº¿æ”¯æŒã€æ€§èƒ½  
**å·¥ä½œé‡**: 6-8å°æ—¶  
**æ”¶ç›Š**: ç¦»çº¿è®¿é—®ã€æ›´å¿«çš„åŠ è½½é€Ÿåº¦ã€å¯å®‰è£…åº”ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ Vite PWA æ’ä»¶ï¼š
```bash
pnpm add -D vite-plugin-pwa
```

```typescript
// vite.config.ts
import { VitePWA } from 'vite-plugin-pwa'

export default defineConfig({
  plugins: [
    react(),
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}']
      },
      manifest: {
        name: 'æ•°æ®åŸ‹ç‚¹åˆ†æå¹³å°',
        short_name: 'åŸ‹ç‚¹å¹³å°',
        description: 'æ•°æ®åŸ‹ç‚¹åˆ†æå¹³å°',
        theme_color: '#1677ff',
        icons: [
          {
            src: 'pwa-192x192.png',
            sizes: '192x192',
            type: 'image/png'
          },
          {
            src: 'pwa-512x512.png',
            sizes: '512x512',
            type: 'image/png'
          }
        ]
      }
    })
  ]
})
```

---

### 10. ä¼˜åŒ– HTML å’Œèµ„æºåŠ è½½

**ä¼˜å…ˆçº§**: P2  
**å½±å“**: æ€§èƒ½ï¼ˆé¦–å±åŠ è½½ï¼‰  
**å·¥ä½œé‡**: 1-2å°æ—¶  
**æ”¶ç›Š**: æ›´å¿«çš„é¦–å±åŠ è½½ï¼Œæ›´å¥½çš„SEO

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 10.1 ä¼˜åŒ– index.html
```html
<!-- index.html -->
<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="æ•°æ®åŸ‹ç‚¹åˆ†æå¹³å°" />
    
    <!-- DNS é¢„è§£æ -->
    <link rel="dns-prefetch" href="//api.example.com" />
    
    <!-- é¢„è¿æ¥ -->
    <link rel="preconnect" href="http://localhost:3000" crossorigin />
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="/fonts/main.woff2" as="font" type="font/woff2" crossorigin />
    
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <title>æ•°æ®åŸ‹ç‚¹åˆ†æå¹³å°</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
```

---

### 11. æ·»åŠ éª¨æ¶å±ï¼ˆSkeleton Screenï¼‰

**ä¼˜å…ˆçº§**: P2  
**å½±å“**: ç”¨æˆ·ä½“éªŒ  
**å·¥ä½œé‡**: 2-3å°æ—¶  
**æ”¶ç›Š**: æ›´å¥½çš„åŠ è½½ä½“éªŒï¼Œå‡å°‘æ„ŸçŸ¥å»¶è¿Ÿ

**é—®é¢˜**ï¼š
- è™½ç„¶æœ‰ Skeleton ç»„ä»¶ï¼Œä½†å¯èƒ½ä½¿ç”¨ä¸å¤Ÿå…¨é¢
- æŸäº›é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç©ºç™½

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥å¹¶ä¼˜åŒ–æ‰€æœ‰é¡µé¢çš„åŠ è½½çŠ¶æ€ï¼Œç¡®ä¿ä½¿ç”¨éª¨æ¶å±è€Œä¸æ˜¯ç®€å•çš„ Spinã€‚

---

### 12. ä¼˜åŒ– Bundle åˆ†æå’Œç›‘æ§

**ä¼˜å…ˆçº§**: P2  
**å½±å“**: å¯è§‚æµ‹æ€§  
**å·¥ä½œé‡**: 1-2å°æ—¶  
**æ”¶ç›Š**: äº†è§£åŒ…ä½“ç§¯å˜åŒ–ï¼ŒåŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
pnpm add -D rollup-plugin-visualizer
```

```typescript
// vite.config.ts
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    react(),
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true,
    })
  ]
})
```

---

## ğŸ”§ ä½ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆP3 - é•¿æœŸè§„åˆ’ï¼‰

### 13. TypeScript ä¸¥æ ¼æ¨¡å¼

**ä¼˜å…ˆçº§**: P3  
**å½±å“**: ä»£ç è´¨é‡  
**å·¥ä½œé‡**: 4-8å°æ—¶  
**æ”¶ç›Š**: æ›´å¥½çš„ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
é€æ­¥å¯ç”¨ `tsconfig.json` ä¸­çš„ä¸¥æ ¼é€‰é¡¹ã€‚

---

### 14. æ·»åŠ å•å…ƒæµ‹è¯•

**ä¼˜å…ˆçº§**: P3  
**å½±å“**: ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§  
**å·¥ä½œé‡**: æŒç»­æŠ•å…¥  
**æ”¶ç›Š**: æé«˜ä»£ç è´¨é‡ï¼Œå‡å°‘å›å½’bug

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ Vitest + React Testing Libraryã€‚

---

### 15. å›½é™…åŒ–ï¼ˆi18nï¼‰

**ä¼˜å…ˆçº§**: P3  
**å½±å“**: ç”¨æˆ·ä½“éªŒ  
**å·¥ä½œé‡**: 8-12å°æ—¶  
**æ”¶ç›Š**: æ”¯æŒå¤šè¯­è¨€ï¼Œæ‰©å¤§ç”¨æˆ·ç¾¤ä½“

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ react-i18nextã€‚

---

### 16. æ— éšœç¢æ€§ï¼ˆA11yï¼‰ä¼˜åŒ–

**ä¼˜å…ˆçº§**: P3  
**å½±å“**: å¯è®¿é—®æ€§  
**å·¥ä½œé‡**: æŒç»­æŠ•å…¥  
**æ”¶ç›Š**: ç¬¦åˆWCAGæ ‡å‡†ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ·»åŠ  ARIA æ ‡ç­¾
- é”®ç›˜å¯¼èˆªæ”¯æŒ
- å±å¹•é˜…è¯»å™¨æ”¯æŒ
- é¢œè‰²å¯¹æ¯”åº¦ä¼˜åŒ–

---

### 17. å†…å­˜æ³„æ¼æ£€æµ‹å’Œä¼˜åŒ–

**ä¼˜å…ˆçº§**: P3  
**å½±å“**: æ€§èƒ½ï¼ˆé•¿æœŸè¿è¡Œï¼‰  
**å·¥ä½œé‡**: 2-4å°æ—¶  
**æ”¶ç›Š**: é¿å…é•¿æ—¶é—´ä½¿ç”¨åæ€§èƒ½ä¸‹é™

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ React DevTools Profiler
- æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨æ¸…ç†
- æ£€æŸ¥å®šæ—¶å™¨æ¸…ç†
- æ£€æŸ¥è®¢é˜…æ¸…ç†

---

## ğŸ“‹ ä¼˜åŒ–å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰
1. âœ… ç§»é™¤ç”Ÿäº§ç¯å¢ƒ console
2. âœ… ä½¿ç”¨ React.memo ä¼˜åŒ–ç»„ä»¶
3. âœ… å®ç°è™šæ‹Ÿæ»šåŠ¨
4. âœ… æ·»åŠ è¯·æ±‚é‡è¯•æœºåˆ¶

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-3å‘¨ï¼‰
5. âœ… æ·»åŠ æ€§èƒ½ç›‘æ§
6. âœ… æ·»åŠ é”™è¯¯ä¸ŠæŠ¥
7. âœ… ä½¿ç”¨ Web Workers
8. âœ… å®ç° IndexedDB ç¼“å­˜

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1-2ä¸ªæœˆï¼‰
9. âœ… æ·»åŠ  Service Worker
10. âœ… ä¼˜åŒ– HTML å’Œèµ„æºåŠ è½½
11. âœ… å®Œå–„éª¨æ¶å±
12. âœ… Bundle åˆ†æ

### ç¬¬å››é˜¶æ®µï¼ˆé•¿æœŸï¼‰
13. âœ… TypeScript ä¸¥æ ¼æ¨¡å¼
14. âœ… å•å…ƒæµ‹è¯•
15. âœ… å›½é™…åŒ–
16. âœ… æ— éšœç¢æ€§ä¼˜åŒ–

---

## ğŸ“Š é¢„æœŸæ”¶ç›Šæ€»ç»“

| ä¼˜åŒ–é¡¹ | æ€§èƒ½æå‡ | ç”¨æˆ·ä½“éªŒæå‡ | å¼€å‘æ•ˆç‡æå‡ |
|--------|---------|------------|------------|
| ç§»é™¤ console | â­â­â­ | â­ | â­ |
| React.memo | â­â­â­â­ | â­â­â­ | â­â­ |
| è™šæ‹Ÿæ»šåŠ¨ | â­â­â­â­â­ | â­â­â­â­ | â­ |
| è¯·æ±‚é‡è¯• | â­â­ | â­â­â­â­ | â­â­ |
| æ€§èƒ½ç›‘æ§ | â­â­ | â­â­â­ | â­â­â­â­ |
| é”™è¯¯ä¸ŠæŠ¥ | â­ | â­â­â­ | â­â­â­â­ |
| Web Workers | â­â­â­â­ | â­â­â­â­ | â­ |
| IndexedDB | â­â­â­ | â­â­â­â­ | â­â­ |
| Service Worker | â­â­â­â­ | â­â­â­â­â­ | â­ |

---

## ğŸ” ç›‘æ§æŒ‡æ ‡

ä¼˜åŒ–ååº”å…³æ³¨ä»¥ä¸‹æŒ‡æ ‡ï¼š

### æ€§èƒ½æŒ‡æ ‡
- **FCP (First Contentful Paint)**: < 1.8s
- **LCP (Largest Contentful Paint)**: < 2.5s
- **FID (First Input Delay)**: < 100ms
- **CLS (Cumulative Layout Shift)**: < 0.1
- **TTFB (Time to First Byte)**: < 800ms

### åŒ…ä½“ç§¯æŒ‡æ ‡
- **åˆå§‹ JS Bundle**: < 500KB (gzipped)
- **æ€» Bundle å¤§å°**: < 2MB (gzipped)

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- **é¡µé¢åŠ è½½æ—¶é—´**: < 3s
- **äº¤äº’å“åº”æ—¶é—´**: < 100ms
- **é”™è¯¯ç‡**: < 0.1%

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ¸è¿›å¼ä¼˜åŒ–**ï¼šä¸è¦ä¸€æ¬¡æ€§å®æ–½æ‰€æœ‰ä¼˜åŒ–ï¼ŒæŒ‰ä¼˜å…ˆçº§é€æ­¥æ¨è¿›
2. **æ€§èƒ½æµ‹è¯•**ï¼šæ¯æ¬¡ä¼˜åŒ–åéƒ½è¦è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼Œç¡®ä¿æœ‰å®é™…æå‡
3. **ç”¨æˆ·ä½“éªŒ**ï¼šä¼˜åŒ–ä¸åº”ä»¥ç‰ºç‰²ç”¨æˆ·ä½“éªŒä¸ºä»£ä»·
4. **å‘åå…¼å®¹**ï¼šç¡®ä¿ä¼˜åŒ–ä¸å½±å“ç°æœ‰åŠŸèƒ½
5. **æ–‡æ¡£æ›´æ–°**ï¼šä¼˜åŒ–ååŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´  
**ç»´æŠ¤è€…**: å‰ç«¯å›¢é˜Ÿ

