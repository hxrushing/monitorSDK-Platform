# ç™¾ä¸‡çº§æ•°æ®æ€§èƒ½æµ‹è¯•æ–¹æ¡ˆ

## ğŸ“‹ ä¸€ã€æµ‹è¯•ç›®æ ‡

éªŒè¯é¡¹ç›®åœ¨ç™¾ä¸‡çº§æ•°æ®åœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ï¼ŒåŒ…æ‹¬ï¼š
1. **æ•°æ®é‡‡é›†æ€§èƒ½**ï¼šSDKæ‰¹é‡å‘é€ã€ç¦»çº¿å­˜å‚¨ã€é‡è¯•æœºåˆ¶
2. **æ•°æ®æŸ¥è¯¢æ€§èƒ½**ï¼šç»Ÿè®¡æŸ¥è¯¢ã€äº‹ä»¶åˆ†æã€æ¼æ–—åˆ†æ
3. **æ•°æ®å¯è§†åŒ–æ€§èƒ½**ï¼šLTTBé‡‡æ ·ã€å›¾è¡¨æ¸²æŸ“ã€è™šæ‹Ÿæ»šåŠ¨
4. **ç³»ç»Ÿèµ„æºå ç”¨**ï¼šCPUã€å†…å­˜ã€æ•°æ®åº“è¿æ¥
5. **å¹¶å‘å¤„ç†èƒ½åŠ›**ï¼šå¤šç”¨æˆ·åŒæ—¶è®¿é—®ã€é«˜å¹¶å‘æ•°æ®ä¸ŠæŠ¥

---

## ğŸ› ï¸ äºŒã€æµ‹è¯•ç¯å¢ƒå‡†å¤‡

### 2.1 ç¡¬ä»¶é…ç½®å»ºè®®

**æœ€ä½é…ç½®**ï¼ˆç”¨äºåŠŸèƒ½éªŒè¯ï¼‰ï¼š
- CPU: 4æ ¸
- å†…å­˜: 8GB
- ç£ç›˜: SSD 100GB
- æ•°æ®åº“: MySQL 8.0+

**æ¨èé…ç½®**ï¼ˆç”¨äºæ€§èƒ½æµ‹è¯•ï¼‰ï¼š
- CPU: 8æ ¸+
- å†…å­˜: 16GB+
- ç£ç›˜: SSD 200GB+
- æ•°æ®åº“: MySQL 8.0+ï¼ˆé…ç½®ä¼˜åŒ–ï¼‰

### 2.2 æ•°æ®åº“ä¼˜åŒ–é…ç½®

**MySQLé…ç½®ä¼˜åŒ–**ï¼ˆ`my.cnf`ï¼‰ï¼š
```ini
[mysqld]
# ç¼“å†²æ± å¤§å°ï¼ˆå»ºè®®ä¸ºå†…å­˜çš„70-80%ï¼‰
innodb_buffer_pool_size = 4G

# æ—¥å¿—æ–‡ä»¶å¤§å°
innodb_log_file_size = 512M

# è¿æ¥æ•°
max_connections = 500

# æŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL 8.0å·²ç§»é™¤ï¼Œä½¿ç”¨å…¶ä»–ç¼“å­˜æ–¹æ¡ˆï¼‰
# query_cache_size = 256M

# è¡¨ç©ºé—´æ–‡ä»¶è‡ªåŠ¨å¢é•¿
innodb_autoextend_increment = 64

# äº‹åŠ¡éš”ç¦»çº§åˆ«
transaction_isolation = READ-COMMITTED

# æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
```

**ç´¢å¼•ä¼˜åŒ–**ï¼š
```sql
-- ç¡®ä¿å…³é”®å­—æ®µæœ‰ç´¢å¼•
CREATE INDEX idx_project_timestamp ON events(project_id, timestamp);
CREATE INDEX idx_project_event ON events(project_id, event_name);
CREATE INDEX idx_timestamp ON events(timestamp);
CREATE INDEX idx_user_id ON events(user_id);
```

---

## ğŸ“Š ä¸‰ã€ç™¾ä¸‡çº§æµ‹è¯•æ•°æ®ç”Ÿæˆ

### 3.1 Pythonè„šæœ¬ç”Ÿæˆï¼ˆæ¨èï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`server/generate_million_data.py`

```python
"""
ç”Ÿæˆç™¾ä¸‡çº§æµ‹è¯•æ•°æ®
ç”¨äºæ€§èƒ½æµ‹è¯•
"""
import random
import json
import uuid
from datetime import datetime, timedelta
from concurrent.futures import ThreadPoolExecutor
import mysql.connector
from mysql.connector import pooling

# é…ç½®
PROJECT_ID = 'perf-test-project'
TOTAL_EVENTS = 1000000  # 100ä¸‡æ¡æ•°æ®
BATCH_SIZE = 10000  # æ¯æ‰¹æ’å…¥1ä¸‡æ¡
DAYS = 30  # ç”Ÿæˆ30å¤©çš„æ•°æ®
THREADS = 4  # å¹¶å‘çº¿ç¨‹æ•°

# æ•°æ®åº“é…ç½®
DB_CONFIG = {
    'host': 'localhost',
    'user': 'root',
    'password': 'your_password',
    'database': 'sdk-platform',
    'charset': 'utf8mb4',
    'pool_size': 10,
    'pool_reset_session': False
}

# äº‹ä»¶ç±»å‹
EVENT_TYPES = [
    'page_view', 'click', 'scroll', 'form_submit', 
    'purchase', 'add_to_cart', 'search', 'share'
]

# é¡µé¢åˆ—è¡¨
PAGES = [
    '/home', '/products', '/product/detail', '/cart', 
    '/checkout', '/user/profile', '/search', '/category'
]

def generate_event(project_id, start_date, day_offset):
    """ç”Ÿæˆå•ä¸ªäº‹ä»¶"""
    current_date = start_date - timedelta(days=day_offset)
    
    # éšæœºæ—¶é—´ï¼ˆ0-23ç‚¹ï¼‰
    hour = random.randint(0, 23)
    minute = random.randint(0, 59)
    second = random.randint(0, 59)
    event_time = current_date.replace(hour=hour, minute=minute, second=second)
    
    # éšæœºç”¨æˆ·ID
    user_id = f'user-{random.randint(1, 100000)}'
    
    # éšæœºäº‹ä»¶ç±»å‹
    event_name = random.choice(EVENT_TYPES)
    
    # éšæœºé¡µé¢
    page = random.choice(PAGES)
    
    # äº‹ä»¶å‚æ•°
    event_params = {
        'page': page,
        'title': f'é¡µé¢-{page}',
        'referrer': random.choice(['direct', 'google', 'baidu', 'weibo']),
        'duration': random.randint(1, 300)  # åœç•™æ—¶é—´ï¼ˆç§’ï¼‰
    }
    
    # è®¾å¤‡ä¿¡æ¯
    device_info = {
        'userAgent': random.choice([
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',
            'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0)',
            'Mozilla/5.0 (Linux; Android 10)'
        ]),
        'platform': random.choice(['Windows', 'iOS', 'Android']),
        'language': 'zh-CN',
        'screenResolution': random.choice(['1920x1080', '375x667', '360x640'])
    }
    
    return (
        project_id,
        event_name,
        json.dumps(event_params, ensure_ascii=False),
        user_id,
        json.dumps(device_info, ensure_ascii=False),
        event_time.strftime('%Y-%m-%d %H:%M:%S')
    )

def insert_batch(connection_pool, events):
    """æ‰¹é‡æ’å…¥äº‹ä»¶"""
    try:
        conn = connection_pool.get_connection()
        cursor = conn.cursor()
        
        sql = """
        INSERT INTO events 
        (project_id, event_name, event_params, user_id, device_info, timestamp) 
        VALUES (%s, %s, %s, %s, %s, %s)
        """
        
        cursor.executemany(sql, events)
        conn.commit()
        
        cursor.close()
        conn.close()
        
        return len(events)
    except Exception as e:
        print(f'æ‰¹é‡æ’å…¥å¤±è´¥: {e}')
        return 0

def generate_million_data():
    """ç”Ÿæˆç™¾ä¸‡çº§æ•°æ®"""
    print(f'å¼€å§‹ç”Ÿæˆ {TOTAL_EVENTS:,} æ¡æµ‹è¯•æ•°æ®...')
    print(f'é¡¹ç›®ID: {PROJECT_ID}')
    print(f'æ—¶é—´èŒƒå›´: {DAYS} å¤©')
    print(f'æ‰¹é‡å¤§å°: {BATCH_SIZE:,} æ¡/æ‰¹')
    print(f'å¹¶å‘çº¿ç¨‹: {THREADS}')
    
    # åˆ›å»ºè¿æ¥æ± 
    connection_pool = pooling.MySQLConnectionPool(**DB_CONFIG)
    
    # è®¡ç®—æ¯å¤©çš„æ•°æ®é‡
    events_per_day = TOTAL_EVENTS // DAYS
    
    start_date = datetime.now()
    total_inserted = 0
    
    # ä½¿ç”¨çº¿ç¨‹æ± å¹¶å‘ç”Ÿæˆ
    with ThreadPoolExecutor(max_workers=THREADS) as executor:
        futures = []
        
        for day_offset in range(DAYS):
            # ç”Ÿæˆå½“å¤©çš„æ•°æ®
            day_events = []
            for _ in range(events_per_day):
                event = generate_event(PROJECT_ID, start_date, day_offset)
                day_events.append(event)
                
                # è¾¾åˆ°æ‰¹é‡å¤§å°æ—¶æ’å…¥
                if len(day_events) >= BATCH_SIZE:
                    future = executor.submit(insert_batch, connection_pool, day_events.copy())
                    futures.append(future)
                    day_events.clear()
            
            # æ’å…¥å‰©ä½™æ•°æ®
            if day_events:
                future = executor.submit(insert_batch, connection_pool, day_events)
                futures.append(future)
        
        # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        for i, future in enumerate(futures):
            inserted = future.result()
            total_inserted += inserted
            if (i + 1) % 10 == 0:
                print(f'å·²å®Œæˆ {i + 1}/{len(futures)} æ‰¹ï¼Œå·²æ’å…¥ {total_inserted:,} æ¡')
    
    print(f'\næ•°æ®ç”Ÿæˆå®Œæˆï¼')
    print(f'æ€»è®¡æ’å…¥: {total_inserted:,} æ¡')
    print(f'é¡¹ç›®ID: {PROJECT_ID}')
    
    # éªŒè¯æ•°æ®
    conn = connection_pool.get_connection()
    cursor = conn.cursor()
    cursor.execute(
        'SELECT COUNT(*) FROM events WHERE project_id = %s',
        (PROJECT_ID,)
    )
    count = cursor.fetchone()[0]
    print(f'æ•°æ®åº“å®é™…è®°å½•æ•°: {count:,} æ¡')
    cursor.close()
    conn.close()

if __name__ == '__main__':
    generate_million_data()
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# å®‰è£…ä¾èµ–
pip install mysql-connector-python

# ä¿®æ”¹é…ç½®ï¼ˆæ•°æ®åº“è¿æ¥ã€é¡¹ç›®IDç­‰ï¼‰
# è¿è¡Œè„šæœ¬
python generate_million_data.py
```

### 3.2 SQLè„šæœ¬ç”Ÿæˆï¼ˆç®€å•ç‰ˆæœ¬ï¼‰

**æ–‡ä»¶ä½ç½®**ï¼š`server/generate_million_data.sql`

```sql
-- ç”Ÿæˆç™¾ä¸‡çº§æµ‹è¯•æ•°æ®ï¼ˆç®€åŒ–ç‰ˆï¼‰
-- æ³¨æ„ï¼šæ­¤æ–¹æ³•è¾ƒæ…¢ï¼Œå»ºè®®ä½¿ç”¨Pythonè„šæœ¬

USE `sdk-platform`;

SET @project_id = 'perf-test-project';
SET @total_events = 1000000;
SET @days = 30;
SET @events_per_day = @total_events / @days;

-- æ¸…ç©ºç°æœ‰æµ‹è¯•æ•°æ®
DELETE FROM events WHERE project_id = @project_id;

-- ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ç”Ÿæˆæ•°æ®
DELIMITER $$

DROP PROCEDURE IF EXISTS generate_million_events$$

CREATE PROCEDURE generate_million_events()
BEGIN
    DECLARE i INT DEFAULT 0;
    DECLARE day_offset INT DEFAULT 0;
    DECLARE current_date DATE;
    DECLARE event_time DATETIME;
    DECLARE user_id VARCHAR(100);
    DECLARE event_name VARCHAR(100);
    
    SET current_date = DATE_SUB(CURDATE(), INTERVAL @days DAY);
    
    WHILE day_offset < @days DO
        SET i = 0;
        WHILE i < @events_per_day DO
            SET event_time = DATE_ADD(current_date, INTERVAL 
                (FLOOR(RAND() * 86400)) SECOND);
            SET user_id = CONCAT('user-', FLOOR(RAND() * 100000));
            SET event_name = ELT(FLOOR(1 + RAND() * 8), 
                'page_view', 'click', 'scroll', 'form_submit',
                'purchase', 'add_to_cart', 'search', 'share');
            
            INSERT INTO events 
            (project_id, event_name, event_params, user_id, device_info, timestamp)
            VALUES (
                @project_id,
                event_name,
                JSON_OBJECT('page', '/home', 'title', 'é¦–é¡µ'),
                user_id,
                JSON_OBJECT('platform', 'Windows', 'language', 'zh-CN'),
                event_time
            );
            
            SET i = i + 1;
            
            -- æ¯1000æ¡æäº¤ä¸€æ¬¡
            IF i % 1000 = 0 THEN
                COMMIT;
            END IF;
        END WHILE;
        
        SET day_offset = day_offset + 1;
        SET current_date = DATE_ADD(current_date, INTERVAL 1 DAY);
    END WHILE;
    
    COMMIT;
END$$

DELIMITER ;

-- æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼ˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼‰
CALL generate_million_events();

-- éªŒè¯æ•°æ®
SELECT 
    COUNT(*) as total_events,
    COUNT(DISTINCT user_id) as unique_users,
    MIN(timestamp) as first_event,
    MAX(timestamp) as last_event
FROM events
WHERE project_id = @project_id;
```

---

## ğŸ§ª å››ã€æ€§èƒ½æµ‹è¯•è„šæœ¬

### 4.1 SDKæ‰¹é‡å‘é€æ€§èƒ½æµ‹è¯•

**æ–‡ä»¶ä½ç½®**ï¼š`server/test_sdk_performance.js`

```javascript
/**
 * SDKæ‰¹é‡å‘é€æ€§èƒ½æµ‹è¯•
 * æµ‹è¯•SDKåœ¨ç™¾ä¸‡çº§æ•°æ®ä¸‹çš„æ‰¹é‡å‘é€æ€§èƒ½
 */

const axios = require('axios');
const { performance } = require('perf_hooks');

const API_BASE = 'http://localhost:3000/api';
const PROJECT_ID = 'perf-test-project';
const BATCH_SIZES = [10, 50, 100, 200]; // æµ‹è¯•ä¸åŒçš„æ‰¹é‡å¤§å°
const TOTAL_EVENTS = 10000; // æ€»å…±å‘é€1ä¸‡æ¡äº‹ä»¶

// ç”Ÿæˆæµ‹è¯•äº‹ä»¶
function generateEvent(index) {
  return {
    eventName: `test_event_${index % 10}`,
    eventParams: {
      page: `/test/page/${index}`,
      index: index,
      timestamp: Date.now()
    },
    timestamp: Date.now()
  };
}

// æµ‹è¯•æ‰¹é‡å‘é€
async function testBatchSend(batchSize) {
  console.log(`\næµ‹è¯•æ‰¹é‡å¤§å°: ${batchSize}`);
  
  const events = [];
  for (let i = 0; i < TOTAL_EVENTS; i++) {
    events.push(generateEvent(i));
  }
  
  // åˆ†æ‰¹å‘é€
  const batches = [];
  for (let i = 0; i < events.length; i += batchSize) {
    batches.push(events.slice(i, i + batchSize));
  }
  
  const startTime = performance.now();
  let successCount = 0;
  let failCount = 0;
  
  // å¹¶å‘å‘é€ï¼ˆæœ€å¤š5ä¸ªå¹¶å‘ï¼‰
  const concurrency = 5;
  for (let i = 0; i < batches.length; i += concurrency) {
    const batchPromises = batches.slice(i, i + concurrency).map(async (batch) => {
      try {
        const response = await axios.post(`${API_BASE}/track`, {
          projectId: PROJECT_ID,
          events: batch,
          batchSize: batch.length,
          timestamp: Date.now(),
          deviceInfo: {
            userAgent: 'Test Agent',
            platform: 'Test',
            language: 'zh-CN',
            screenResolution: '1920x1080'
          },
          sdkVersion: '1.0.0'
        });
        
        if (response.data.success) {
          successCount += batch.length;
        } else {
          failCount += batch.length;
        }
      } catch (error) {
        failCount += batch.length;
        console.error(`æ‰¹é‡å‘é€å¤±è´¥: ${error.message}`);
      }
    });
    
    await Promise.all(batchPromises);
    
    // æ˜¾ç¤ºè¿›åº¦
    if ((i + concurrency) % 50 === 0) {
      const progress = ((i + concurrency) / batches.length * 100).toFixed(1);
      console.log(`è¿›åº¦: ${progress}%`);
    }
  }
  
  const endTime = performance.now();
  const duration = (endTime - startTime) / 1000; // ç§’
  
  console.log(`\næ‰¹é‡å¤§å°: ${batchSize}`);
  console.log(`æ€»äº‹ä»¶æ•°: ${TOTAL_EVENTS}`);
  console.log(`æˆåŠŸ: ${successCount}`);
  console.log(`å¤±è´¥: ${failCount}`);
  console.log(`è€—æ—¶: ${duration.toFixed(2)} ç§’`);
  console.log(`ååé‡: ${(TOTAL_EVENTS / duration).toFixed(2)} äº‹ä»¶/ç§’`);
  console.log(`å¹³å‡å»¶è¿Ÿ: ${(duration / batches.length * 1000).toFixed(2)} æ¯«ç§’/æ‰¹`);
  
  return {
    batchSize,
    totalEvents: TOTAL_EVENTS,
    successCount,
    failCount,
    duration,
    throughput: TOTAL_EVENTS / duration,
    avgLatency: duration / batches.length * 1000
  };
}

// è¿è¡Œæµ‹è¯•
async function runTests() {
  console.log('å¼€å§‹SDKæ‰¹é‡å‘é€æ€§èƒ½æµ‹è¯•...');
  console.log(`é¡¹ç›®ID: ${PROJECT_ID}`);
  console.log(`æ€»äº‹ä»¶æ•°: ${TOTAL_EVENTS}`);
  
  const results = [];
  
  for (const batchSize of BATCH_SIZES) {
    const result = await testBatchSend(batchSize);
    results.push(result);
    
    // ç­‰å¾…ä¸€æ®µæ—¶é—´å†æµ‹è¯•ä¸‹ä¸€ä¸ªæ‰¹é‡å¤§å°
    await new Promise(resolve => setTimeout(resolve, 2000));
  }
  
  // è¾“å‡ºæ€»ç»“
  console.log('\n========== æµ‹è¯•æ€»ç»“ ==========');
  console.table(results.map(r => ({
    'æ‰¹é‡å¤§å°': r.batchSize,
    'ååé‡(äº‹ä»¶/ç§’)': r.throughput.toFixed(2),
    'å¹³å‡å»¶è¿Ÿ(æ¯«ç§’)': r.avgLatency.toFixed(2),
    'æˆåŠŸç‡': ((r.successCount / r.totalEvents) * 100).toFixed(2) + '%'
  })));
}

runTests().catch(console.error);
```

### 4.2 æ•°æ®æŸ¥è¯¢æ€§èƒ½æµ‹è¯•

**æ–‡ä»¶ä½ç½®**ï¼š`server/test_query_performance.js`

```javascript
/**
 * æ•°æ®æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
 * æµ‹è¯•å„ç§æŸ¥è¯¢åœ¨ç™¾ä¸‡çº§æ•°æ®ä¸‹çš„æ€§èƒ½
 */

const axios = require('axios');
const { performance } = require('perf_hooks');

const API_BASE = 'http://localhost:3000/api';
const PROJECT_ID = 'perf-test-project';
const TOKEN = 'your-jwt-token'; // éœ€è¦å…ˆç™»å½•è·å–token

// æµ‹è¯•ç»Ÿè®¡æŸ¥è¯¢
async function testStatsQuery() {
  console.log('\næµ‹è¯•ç»Ÿè®¡æŸ¥è¯¢...');
  
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - 30);
  const endDate = new Date();
  
  const startTime = performance.now();
  
  try {
    const response = await axios.get(`${API_BASE}/stats`, {
      params: {
        projectId: PROJECT_ID,
        startDate: startDate.toISOString().split('T')[0],
        endDate: endDate.toISOString().split('T')[0]
      },
      headers: {
        'Authorization': `Bearer ${TOKEN}`
      }
    });
    
    const endTime = performance.now();
    const duration = (endTime - startTime) / 1000;
    
    console.log(`æŸ¥è¯¢è€—æ—¶: ${duration.toFixed(2)} ç§’`);
    console.log(`è¿”å›æ•°æ®ç‚¹: ${response.data.length} ä¸ª`);
    
    return duration;
  } catch (error) {
    console.error(`æŸ¥è¯¢å¤±è´¥: ${error.message}`);
    return null;
  }
}

// æµ‹è¯•äº‹ä»¶åˆ†ææŸ¥è¯¢
async function testEventAnalysis() {
  console.log('\næµ‹è¯•äº‹ä»¶åˆ†ææŸ¥è¯¢...');
  
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - 7);
  const endDate = new Date();
  
  const startTime = performance.now();
  
  try {
    const response = await axios.get(`${API_BASE}/events/analysis`, {
      params: {
        projectId: PROJECT_ID,
        startDate: startDate.toISOString().split('T')[0],
        endDate: endDate.toISOString().split('T')[0],
        events: 'page_view,click,scroll'
      },
      headers: {
        'Authorization': `Bearer ${TOKEN}`
      }
    });
    
    const endTime = performance.now();
    const duration = (endTime - startTime) / 1000;
    
    console.log(`æŸ¥è¯¢è€—æ—¶: ${duration.toFixed(2)} ç§’`);
    console.log(`è¿”å›æ•°æ®ç‚¹: ${response.data.length} ä¸ª`);
    
    return duration;
  } catch (error) {
    console.error(`æŸ¥è¯¢å¤±è´¥: ${error.message}`);
    return null;
  }
}

// æµ‹è¯•å¹¶å‘æŸ¥è¯¢
async function testConcurrentQueries() {
  console.log('\næµ‹è¯•å¹¶å‘æŸ¥è¯¢ï¼ˆ10ä¸ªå¹¶å‘ï¼‰...');
  
  const queries = Array(10).fill(null).map(() => testStatsQuery());
  const startTime = performance.now();
  
  const results = await Promise.all(queries);
  const endTime = performance.now();
  
  const totalDuration = (endTime - startTime) / 1000;
  const avgDuration = results.filter(r => r !== null).reduce((a, b) => a + b, 0) / results.length;
  
  console.log(`æ€»è€—æ—¶: ${totalDuration.toFixed(2)} ç§’`);
  console.log(`å¹³å‡æŸ¥è¯¢è€—æ—¶: ${avgDuration.toFixed(2)} ç§’`);
  console.log(`å¹¶å‘ååé‡: ${(10 / totalDuration).toFixed(2)} æŸ¥è¯¢/ç§’`);
}

// è¿è¡Œæµ‹è¯•
async function runTests() {
  console.log('å¼€å§‹æ•°æ®æŸ¥è¯¢æ€§èƒ½æµ‹è¯•...');
  console.log(`é¡¹ç›®ID: ${PROJECT_ID}`);
  
  await testStatsQuery();
  await testEventAnalysis();
  await testConcurrentQueries();
}

runTests().catch(console.error);
```

### 4.3 å‰ç«¯æ¸²æŸ“æ€§èƒ½æµ‹è¯•

**æ–‡ä»¶ä½ç½®**ï¼š`src/utils/performanceTest.ts`

```typescript
/**
 * å‰ç«¯æ¸²æŸ“æ€§èƒ½æµ‹è¯•
 * æµ‹è¯•LTTBé‡‡æ ·å’Œå›¾è¡¨æ¸²æŸ“æ€§èƒ½
 */

import { lttbSampling, adaptiveChartSampling } from './dataSampling';

// ç”Ÿæˆæµ‹è¯•æ•°æ®
function generateTestData(count: number) {
  const data = [];
  const baseTime = Date.now() - count * 1000;
  
  for (let i = 0; i < count; i++) {
    data.push({
      date: new Date(baseTime + i * 1000).toISOString(),
      value: Math.random() * 1000 + Math.sin(i / 100) * 200
    });
  }
  
  return data;
}

// æµ‹è¯•LTTBé‡‡æ ·æ€§èƒ½
export function testLTTBSampling() {
  console.log('\næµ‹è¯•LTTBé‡‡æ ·æ€§èƒ½...');
  
  const testCases = [
    { original: 10000, target: 1000 },
    { original: 50000, target: 2000 },
    { original: 100000, target: 5000 },
    { original: 500000, target: 10000 }
  ];
  
  const results = [];
  
  for (const testCase of testCases) {
    const data = generateTestData(testCase.original);
    
    const startTime = performance.now();
    const sampled = lttbSampling(data, testCase.target);
    const endTime = performance.now();
    
    const duration = endTime - startTime;
    const compressionRatio = (1 - sampled.length / data.length) * 100;
    
    results.push({
      original: testCase.original,
      sampled: sampled.length,
      duration: duration.toFixed(2) + 'ms',
      compressionRatio: compressionRatio.toFixed(2) + '%',
      throughput: (testCase.original / duration * 1000).toFixed(2) + ' ç‚¹/ç§’'
    });
  }
  
  console.table(results);
  return results;
}

// æµ‹è¯•å›¾è¡¨æ¸²æŸ“æ€§èƒ½
export function testChartRendering() {
  console.log('\næµ‹è¯•å›¾è¡¨æ¸²æŸ“æ€§èƒ½...');
  
  const testCases = [1000, 5000, 10000, 50000, 100000];
  const results = [];
  
  for (const count of testCases) {
    const data = generateTestData(count);
    
    // æµ‹è¯•é‡‡æ ·
    const startSampling = performance.now();
    const sampled = adaptiveChartSampling(data, 'date', 'value');
    const endSampling = performance.now();
    const samplingTime = endSampling - startSampling;
    
    // æ¨¡æ‹Ÿæ¸²æŸ“ï¼ˆå®é™…æ¸²æŸ“æ—¶é—´éœ€è¦åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ï¼‰
    const startRender = performance.now();
    // è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿï¼Œå®é™…æ¸²æŸ“éœ€è¦åœ¨çœŸå®ç¯å¢ƒä¸­æµ‹è¯•
    const endRender = performance.now();
    const renderTime = endRender - startRender;
    
    results.push({
      original: count,
      sampled: sampled.length,
      samplingTime: samplingTime.toFixed(2) + 'ms',
      renderTime: renderTime.toFixed(2) + 'ms',
      totalTime: (samplingTime + renderTime).toFixed(2) + 'ms'
    });
  }
  
  console.table(results);
  return results;
}

// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
if (typeof window !== 'undefined') {
  (window as any).testLTTBSampling = testLTTBSampling;
  (window as any).testChartRendering = testChartRendering;
}
```

---

## ğŸ“ˆ äº”ã€ç›‘æ§æŒ‡æ ‡

### 5.1 æ•°æ®åº“ç›‘æ§

**æ…¢æŸ¥è¯¢ç›‘æ§**ï¼š
```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log 
ORDER BY start_time DESC 
LIMIT 10;

-- æŸ¥çœ‹å½“å‰è¿è¡Œçš„æŸ¥è¯¢
SHOW PROCESSLIST;

-- æŸ¥çœ‹è¡¨å¤§å°
SELECT 
    table_name,
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS 'Size (MB)'
FROM information_schema.TABLES
WHERE table_schema = 'sdk-platform'
ORDER BY (data_length + index_length) DESC;
```

**æ€§èƒ½ç›‘æ§SQL**ï¼š
```sql
-- æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
EXPLAIN SELECT 
    DATE(timestamp) as date,
    COUNT(*) as pv,
    COUNT(DISTINCT user_id) as uv
FROM events
WHERE project_id = 'perf-test-project'
    AND timestamp >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY DATE(timestamp)
ORDER BY date ASC;

-- æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SHOW INDEX FROM events;
```

### 5.2 ç³»ç»Ÿèµ„æºç›‘æ§

**Node.jsæ€§èƒ½ç›‘æ§**ï¼š
```javascript
// server/src/utils/monitor.ts
import os from 'os';

export function getSystemMetrics() {
  return {
    cpu: {
      usage: process.cpuUsage(),
      loadAverage: os.loadavg()
    },
    memory: {
      heapUsed: process.memoryUsage().heapUsed / 1024 / 1024, // MB
      heapTotal: process.memoryUsage().heapTotal / 1024 / 1024, // MB
      rss: process.memoryUsage().rss / 1024 / 1024, // MB
      systemTotal: os.totalmem() / 1024 / 1024, // MB
      systemFree: os.freemem() / 1024 / 1024 // MB
    }
  };
}
```

### 5.3 å‰ç«¯æ€§èƒ½ç›‘æ§

**æµè§ˆå™¨Performance API**ï¼š
```typescript
// ç›‘æ§é¡µé¢åŠ è½½æ€§èƒ½
export function measurePageLoad() {
  const perfData = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;
  
  return {
    dns: perfData.domainLookupEnd - perfData.domainLookupStart,
    tcp: perfData.connectEnd - perfData.connectStart,
    request: perfData.responseStart - perfData.requestStart,
    response: perfData.responseEnd - perfData.responseStart,
    dom: perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart,
    load: perfData.loadEventEnd - perfData.loadEventStart,
    total: perfData.loadEventEnd - perfData.fetchStart
  };
}

// ç›‘æ§APIè¯·æ±‚æ€§èƒ½
export function measureAPIRequest(url: string) {
  const start = performance.now();
  
  return fetch(url)
    .then(response => {
      const end = performance.now();
      return {
        url,
        duration: end - start,
        status: response.status
      };
    });
}
```

---

## ğŸ¯ å…­ã€æµ‹è¯•åœºæ™¯

### 6.1 æ•°æ®é‡‡é›†åœºæ™¯

**åœºæ™¯1ï¼šé«˜å¹¶å‘æ‰¹é‡å‘é€**
- å¹¶å‘æ•°ï¼š100ä¸ªSDKå®ä¾‹
- æ¯ä¸ªå®ä¾‹ï¼šæ¯ç§’å‘é€1æ‰¹ï¼ˆ50ä¸ªäº‹ä»¶ï¼‰
- æ€»ååé‡ï¼š5000äº‹ä»¶/ç§’
- æŒç»­æ—¶é—´ï¼š10åˆ†é’Ÿ
- **é¢„æœŸç»“æœ**ï¼šæˆåŠŸç‡ > 99%ï¼Œå¹³å‡å»¶è¿Ÿ < 500ms

**åœºæ™¯2ï¼šå¼±ç½‘ç¯å¢ƒæµ‹è¯•**
- ä½¿ç”¨Chrome DevToolsæ¨¡æ‹Ÿæ…¢é€Ÿ3G
- æ‰¹é‡å¤§å°ï¼šè‡ªé€‚åº”è°ƒæ•´
- **é¢„æœŸç»“æœ**ï¼šæˆåŠŸç‡ > 95%ï¼Œæ‰¹é‡å¤§å°è‡ªåŠ¨å‡å°

**åœºæ™¯3ï¼šç¦»çº¿æ¢å¤æµ‹è¯•**
- æ–­å¼€ç½‘ç»œï¼Œç§¯ç´¯10000ä¸ªäº‹ä»¶
- æ¢å¤ç½‘ç»œï¼Œè§‚å¯Ÿè‡ªåŠ¨å‘é€
- **é¢„æœŸç»“æœ**ï¼šæ‰€æœ‰äº‹ä»¶æˆåŠŸå‘é€ï¼Œæ— ä¸¢å¤±

### 6.2 æ•°æ®æŸ¥è¯¢åœºæ™¯

**åœºæ™¯1ï¼šå¤§æ—¶é—´èŒƒå›´æŸ¥è¯¢**
- æŸ¥è¯¢èŒƒå›´ï¼š30å¤©
- æ•°æ®é‡ï¼š100ä¸‡æ¡
- **é¢„æœŸç»“æœ**ï¼šæŸ¥è¯¢æ—¶é—´ < 2ç§’

**åœºæ™¯2ï¼šå¤šç»´åº¦åˆ†æ**
- åŒæ—¶æŸ¥è¯¢PVã€UVã€äº‹ä»¶åˆ†æã€æ¼æ–—åˆ†æ
- **é¢„æœŸç»“æœ**ï¼šæ€»è€—æ—¶ < 5ç§’

**åœºæ™¯3ï¼šå¹¶å‘æŸ¥è¯¢**
- 10ä¸ªç”¨æˆ·åŒæ—¶æŸ¥è¯¢
- **é¢„æœŸç»“æœ**ï¼šå¹³å‡å“åº”æ—¶é—´ < 3ç§’

### 6.3 æ•°æ®å¯è§†åŒ–åœºæ™¯

**åœºæ™¯1ï¼šå¤§æ•°æ®é‡å›¾è¡¨æ¸²æŸ“**
- æ•°æ®ç‚¹ï¼š10ä¸‡ã€50ä¸‡ã€100ä¸‡
- é‡‡æ ·åï¼š1000ã€2000ã€5000ç‚¹
- **é¢„æœŸç»“æœ**ï¼šæ¸²æŸ“æ—¶é—´ < 1ç§’ï¼Œä¿æŒ60fps

**åœºæ™¯2ï¼šå¤šå›¾è¡¨åŒæ—¶æ¸²æŸ“**
- åŒæ—¶æ¸²æŸ“5ä¸ªå›¾è¡¨
- æ¯ä¸ªå›¾è¡¨10ä¸‡æ•°æ®ç‚¹
- **é¢„æœŸç»“æœ**ï¼šæ€»æ¸²æŸ“æ—¶é—´ < 3ç§’

---

## ğŸ“Š ä¸ƒã€æ€§èƒ½åŸºå‡†

### 7.1 æ•°æ®é‡‡é›†æ€§èƒ½åŸºå‡†

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|------|--------|----------|
| æ‰¹é‡å‘é€ååé‡ | > 5000 äº‹ä»¶/ç§’ | 100ä¸ªå¹¶å‘SDKå®ä¾‹ |
| å¹³å‡å»¶è¿Ÿ | < 500ms | æ‰¹é‡å‘é€å“åº”æ—¶é—´ |
| æˆåŠŸç‡ | > 99% | æ­£å¸¸ç½‘ç»œç¯å¢ƒ |
| å¼±ç½‘æˆåŠŸç‡ | > 95% | 3Gç½‘ç»œæ¨¡æ‹Ÿ |
| ç¦»çº¿æ¢å¤ç‡ | 100% | ç½‘ç»œæ–­å¼€æ¢å¤æµ‹è¯• |

### 7.2 æ•°æ®æŸ¥è¯¢æ€§èƒ½åŸºå‡†

| æŸ¥è¯¢ç±»å‹ | æ•°æ®é‡ | ç›®æ ‡å“åº”æ—¶é—´ |
|----------|--------|--------------|
| ç»Ÿè®¡æŸ¥è¯¢ï¼ˆ30å¤©ï¼‰ | 100ä¸‡ | < 2ç§’ |
| äº‹ä»¶åˆ†æï¼ˆ7å¤©ï¼‰ | 30ä¸‡ | < 1ç§’ |
| æ¼æ–—åˆ†æï¼ˆ7å¤©ï¼‰ | 30ä¸‡ | < 1.5ç§’ |
| å¹¶å‘æŸ¥è¯¢ï¼ˆ10ä¸ªï¼‰ | 100ä¸‡ | < 3ç§’/æŸ¥è¯¢ |

### 7.3 æ•°æ®å¯è§†åŒ–æ€§èƒ½åŸºå‡†

| æ•°æ®ç‚¹ | é‡‡æ ·å | ç›®æ ‡æ¸²æŸ“æ—¶é—´ |
|--------|--------|--------------|
| 10ä¸‡ | 1000 | < 500ms |
| 50ä¸‡ | 2000 | < 800ms |
| 100ä¸‡ | 5000 | < 1ç§’ |

---

## ğŸ” å…«ã€æµ‹è¯•æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šå‡†å¤‡æµ‹è¯•ç¯å¢ƒ
```bash
# 1. ä¼˜åŒ–æ•°æ®åº“é…ç½®
# 2. åˆ›å»ºç´¢å¼•
# 3. ç”Ÿæˆæµ‹è¯•æ•°æ®
python generate_million_data.py

# 4. éªŒè¯æ•°æ®
mysql -u root -p -e "SELECT COUNT(*) FROM events WHERE project_id='perf-test-project';"
```

### æ­¥éª¤2ï¼šæ‰§è¡Œæ€§èƒ½æµ‹è¯•
```bash
# 1. SDKæ‰¹é‡å‘é€æµ‹è¯•
node server/test_sdk_performance.js

# 2. æ•°æ®æŸ¥è¯¢æµ‹è¯•
node server/test_query_performance.js

# 3. å‰ç«¯æ¸²æŸ“æµ‹è¯•ï¼ˆåœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼‰
# æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œè¿è¡Œï¼š
testLTTBSampling()
testChartRendering()
```

### æ­¥éª¤3ï¼šç›‘æ§ç³»ç»Ÿèµ„æº
```bash
# ç›‘æ§CPUå’Œå†…å­˜
top
# æˆ–
htop

# ç›‘æ§æ•°æ®åº“
mysql -u root -p -e "SHOW PROCESSLIST;"
mysql -u root -p -e "SHOW STATUS LIKE 'Threads_connected';"
```

### æ­¥éª¤4ï¼šåˆ†ææµ‹è¯•ç»“æœ
- æ”¶é›†æ‰€æœ‰æµ‹è¯•æ•°æ®
- å¯¹æ¯”æ€§èƒ½åŸºå‡†
- æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆ
- æå‡ºä¼˜åŒ–å»ºè®®

---

## ğŸ“ ä¹ã€æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
# ç™¾ä¸‡çº§æ•°æ®æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ
- ç¡¬ä»¶é…ç½®ï¼šCPU 8æ ¸ï¼Œå†…å­˜ 16GB
- æ•°æ®åº“ï¼šMySQL 8.0
- æ•°æ®é‡ï¼š1,000,000 æ¡äº‹ä»¶
- æµ‹è¯•æ—¶é—´ï¼š2024-XX-XX

## æµ‹è¯•ç»“æœ

### 1. æ•°æ®é‡‡é›†æ€§èƒ½
- æ‰¹é‡å‘é€ååé‡ï¼šX äº‹ä»¶/ç§’
- å¹³å‡å»¶è¿Ÿï¼šX ms
- æˆåŠŸç‡ï¼šX%
- **ç»“è®º**ï¼šâœ… é€šè¿‡ / âŒ æœªé€šè¿‡

### 2. æ•°æ®æŸ¥è¯¢æ€§èƒ½
- ç»Ÿè®¡æŸ¥è¯¢ï¼ˆ30å¤©ï¼‰ï¼šX ç§’
- äº‹ä»¶åˆ†æï¼ˆ7å¤©ï¼‰ï¼šX ç§’
- å¹¶å‘æŸ¥è¯¢ï¼ˆ10ä¸ªï¼‰ï¼šX ç§’/æŸ¥è¯¢
- **ç»“è®º**ï¼šâœ… é€šè¿‡ / âŒ æœªé€šè¿‡

### 3. æ•°æ®å¯è§†åŒ–æ€§èƒ½
- 10ä¸‡æ•°æ®ç‚¹æ¸²æŸ“ï¼šX ms
- 50ä¸‡æ•°æ®ç‚¹æ¸²æŸ“ï¼šX ms
- 100ä¸‡æ•°æ®ç‚¹æ¸²æŸ“ï¼šX ms
- **ç»“è®º**ï¼šâœ… é€šè¿‡ / âŒ æœªé€šè¿‡

## æ€§èƒ½ç“¶é¢ˆåˆ†æ
1. [å‘ç°çš„ç“¶é¢ˆ]
2. [ä¼˜åŒ–å»ºè®®]

## ä¼˜åŒ–å»ºè®®
1. [å…·ä½“ä¼˜åŒ–æ–¹æ¡ˆ]
2. [é¢„æœŸæ•ˆæœ]
```

---

## ğŸš€ åã€å¿«é€Ÿå¼€å§‹

### ä¸€é”®æµ‹è¯•è„šæœ¬

**æ–‡ä»¶ä½ç½®**ï¼š`server/run_performance_test.sh`

```bash
#!/bin/bash

echo "å¼€å§‹ç™¾ä¸‡çº§æ•°æ®æ€§èƒ½æµ‹è¯•..."

# 1. ç”Ÿæˆæµ‹è¯•æ•°æ®
echo "1. ç”Ÿæˆæµ‹è¯•æ•°æ®..."
python generate_million_data.py

# 2. ç­‰å¾…æ•°æ®ç”Ÿæˆå®Œæˆ
sleep 5

# 3. æ‰§è¡ŒSDKæ€§èƒ½æµ‹è¯•
echo "2. æ‰§è¡ŒSDKæ€§èƒ½æµ‹è¯•..."
node test_sdk_performance.js

# 4. æ‰§è¡ŒæŸ¥è¯¢æ€§èƒ½æµ‹è¯•
echo "3. æ‰§è¡ŒæŸ¥è¯¢æ€§èƒ½æµ‹è¯•..."
node test_query_performance.js

# 5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
echo "4. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š..."
# è¿™é‡Œå¯ä»¥æ·»åŠ æŠ¥å‘Šç”Ÿæˆé€»è¾‘

echo "æµ‹è¯•å®Œæˆï¼"
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
chmod +x run_performance_test.sh
./run_performance_test.sh
```

---

## ğŸ’¡ åä¸€ã€å¸¸è§é—®é¢˜

### Q1: æ•°æ®ç”Ÿæˆå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨Pythonè„šæœ¬å¤šçº¿ç¨‹ç”Ÿæˆ
2. å¢åŠ æ‰¹é‡æ’å…¥å¤§å°
3. å…³é—­æ•°æ®åº“çš„æŸäº›æ—¥å¿—ï¼ˆä»…æµ‹è¯•ç¯å¢ƒï¼‰
4. ä½¿ç”¨SSDç¡¬ç›˜

### Q2: æŸ¥è¯¢æ€§èƒ½ä¸è¾¾æ ‡æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç´¢å¼•æ˜¯å¦åˆ›å»º
2. ä¼˜åŒ–SQLæŸ¥è¯¢ï¼ˆé¿å…å…¨è¡¨æ‰«æï¼‰
3. å¢åŠ æ•°æ®åº“ç¼“å†²æ± å¤§å°
4. è€ƒè™‘ä½¿ç”¨ç¼“å­˜ï¼ˆRedisï¼‰

### Q3: å‰ç«¯æ¸²æŸ“å¡é¡¿æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿LTTBé‡‡æ ·æ­£å¸¸å·¥ä½œ
2. æ£€æŸ¥é‡‡æ ·åçš„æ•°æ®ç‚¹æ•°é‡
3. ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
4. å‡å°‘åŒæ—¶æ¸²æŸ“çš„å›¾è¡¨æ•°é‡

---

## ğŸ“š åäºŒã€å‚è€ƒèµ„æº

- [MySQLæ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://dev.mysql.com/doc/refman/8.0/en/optimization.html)
- [Node.jsæ€§èƒ½ç›‘æ§](https://nodejs.org/en/docs/guides/simple-profiling/)
- [Chrome DevToolsæ€§èƒ½åˆ†æ](https://developer.chrome.com/docs/devtools/performance/)

---

**ç¥ä½ æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰

