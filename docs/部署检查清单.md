# 📋 部署检查清单

使用此清单确保部署流程完整无误。

## 部署前准备

### 服务器环境

- [ ] 服务器操作系统已确认（推荐 Ubuntu 20.04+ 或 CentOS 7+）
- [ ] 服务器内存 >= 4GB
- [ ] 服务器存储 >= 20GB
- [ ] 服务器网络正常，可以访问外网
- [ ] 域名DNS解析已配置（如使用域名）

### 软件安装

- [ ] Node.js 18+ 已安装 (`node --version`)
- [ ] pnpm 已安装 (`pnpm --version`)
- [ ] Python 3.8+ 已安装 (`python3 --version`)
- [ ] MySQL 8.0+ 已安装并运行 (`mysql --version`)
- [ ] Nginx 已安装 (`nginx -v`)
- [ ] PM2 已安装 (`pm2 --version`)
- [ ] Docker 和 Docker Compose 已安装（如使用Docker部署）

---

## 数据库配置

- [ ] MySQL 服务已启动 (`sudo systemctl status mysql`)
- [ ] 数据库已创建 (`analytics_platform`)
- [ ] 数据库用户已创建并授权
- [ ] 数据库字符集为 `utf8mb4`
- [ ] 数据库表结构已初始化（执行 `init-db` 命令）
- [ ] 数据库连接测试通过

---

## 环境变量配置

### 后端环境变量 (`server/.env`)

- [ ] `PORT` 已设置（默认 3000）
- [ ] `NODE_ENV=production`
- [ ] `DB_HOST` 已配置
- [ ] `DB_PORT` 已配置（默认 3306）
- [ ] `DB_USER` 已配置
- [ ] `DB_PASSWORD` 已配置（强密码）
- [ ] `DB_NAME` 已配置
- [ ] `JWT_SECRET` 已设置（32字符以上强密钥）
- [ ] `OPENAI_API_KEY` 已配置（如使用AI功能）
- [ ] `ML_SERVICE_URL` 已配置
- [ ] 邮件服务配置已填写（如使用邮件功能）

### ML服务环境变量 (`ml-service/.env`)

- [ ] `ML_SERVICE_PORT` 已设置（默认 5000）
- [ ] `FLASK_DEBUG=False`

### 前端环境变量 (`.env.production`)

- [ ] `VITE_API_URL` 已配置（生产环境API地址）

---

## 代码构建

### 前端构建

- [ ] 前端依赖已安装 (`pnpm install`)
- [ ] 前端构建成功 (`pnpm run build`)
- [ ] `dist/` 目录已生成
- [ ] 构建产物无错误和警告

### 后端构建

- [ ] 后端依赖已安装 (`cd server && pnpm install`)
- [ ] 后端构建成功 (`pnpm run build`)
- [ ] `server/dist/` 目录已生成

### ML服务准备

- [ ] Python虚拟环境已创建
- [ ] ML服务依赖已安装 (`pip install -r requirements.txt`)
- [ ] 测试ML服务可以正常导入

---

## 服务启动

### 后端服务

- [ ] 后端服务已启动（PM2 或 Docker）
- [ ] 后端服务运行在正确端口（3000）
- [ ] PM2 服务已设置为开机自启（如使用PM2）
- [ ] 后端日志无错误

### ML服务

- [ ] ML服务已启动（PM2 或 Docker）
- [ ] ML服务运行在正确端口（5000）
- [ ] PM2 服务已设置为开机自启（如使用PM2）
- [ ] ML服务日志无错误

### 前端服务

- [ ] Nginx 配置已正确
- [ ] Nginx 配置测试通过 (`sudo nginx -t`)
- [ ] Nginx 服务已启动 (`sudo systemctl status nginx`)
- [ ] 静态文件路径正确

---

## Nginx配置

- [ ] 前端静态文件服务配置正确
- [ ] 后端API代理配置正确 (`/api` → `http://localhost:3000`)
- [ ] SPA路由支持已配置 (`try_files`)
- [ ] Gzip压缩已启用
- [ ] 静态资源缓存已配置
- [ ] 安全头已添加
- [ ] CORS配置正确（如需要）

### HTTPS配置（如使用）

- [ ] SSL证书已获取（Let's Encrypt 或其他）
- [ ] SSL证书已配置到Nginx
- [ ] HTTP到HTTPS重定向已配置
- [ ] SSL证书自动续期已配置

---

## 功能测试

### 基础功能

- [ ] 前端页面可以正常访问
- [ ] 前端路由跳转正常
- [ ] API接口可以正常调用
- [ ] 数据库读写正常
- [ ] 用户登录功能正常（如有）

### 高级功能

- [ ] AI总结功能正常（如使用）
- [ ] ML预测功能正常
- [ ] 邮件发送功能正常（如使用）
- [ ] 文件上传功能正常（如有）

---

## 安全配置

- [ ] 数据库密码已修改为强密码
- [ ] JWT密钥已修改为强密钥
- [ ] `.env` 文件权限已设置（600）
- [ ] 防火墙规则已配置
- [ ] 不必要的端口已关闭
- [ ] SSH密钥认证已配置（替代密码登录）
- [ ] 定期更新机制已配置

---

## 监控和日志

- [ ] 日志目录已创建
- [ ] 日志轮转已配置
- [ ] PM2日志已配置（如使用PM2）
- [ ] 错误告警已配置（可选）
- [ ] 性能监控已配置（可选）

---

## 备份策略

- [ ] 数据库备份脚本已创建
- [ ] 自动备份已配置（cron）
- [ ] 备份存储位置已确认
- [ ] 备份恢复流程已测试

---

## 性能优化

- [ ] 数据库索引已优化
- [ ] 静态资源CDN已配置（可选）
- [ ] 缓存策略已配置（可选）
- [ ] 图片已压缩优化

---

## 部署后验证

- [ ] 所有页面访问正常
- [ ] 所有API接口响应正常
- [ ] 数据库连接稳定
- [ ] 服务正常运行无报错
- [ ] 内存和CPU使用率正常
- [ ] 日志无异常错误

---

## 文档

- [ ] 部署文档已阅读并理解
- [ ] 环境变量说明已查看
- [ ] 常见问题文档已了解
- [ ] 联系方式已记录（技术支持）

---

## 快速检查命令

```bash
# 检查服务状态
pm2 status  # 或 docker-compose ps

# 检查端口
sudo netstat -tlnp | grep -E ':(3000|5000|80|443|3306)'

# 检查Nginx
sudo nginx -t && sudo systemctl status nginx

# 检查MySQL
sudo systemctl status mysql

# 测试API
curl http://localhost/api/health

# 查看日志
pm2 logs  # 或 docker-compose logs -f
```

---

## 紧急联系

如果部署过程中遇到问题：

1. 查看日志文件
2. 参考 `docs/项目部署指南.md` 中的"常见问题"部分
3. 检查服务状态和端口占用
4. 查看错误信息并搜索解决方案

---

✅ **完成所有检查项后，您的应用应该已成功部署！**






